<!DOCTYPE html>
<html lang="heb">

<head>
  <meta charset="UTF-8">
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-41JX3YK216"></script>
<script>
    
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-41JX3YK216');
  
</script>
    <meta property="og:title" content="פיננסי-נט">
    <meta property="og:description" content="אתר השוואה לנתוני קופות גמל, קרנות השתלמות, קרנות פנסיה ופוליסות חסכון ">
    <meta property="og:image" content="https://i.postimg.cc/L4YLr22D/logoxnew.png">
    <meta property="og:url" content="https://zamit00.github.io">
    <meta property="og:type" content="website">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="כאן תמצאו מידע מקיף על קופות גמל, קרנות השתלמות, קרנות פנסיה ופוליסות חסכון פרט, כולל השוואת נתונים, מחשבונים פיננסיים מתקדמים ותוכן מקצועי שיעזור לכם לקבל החלטות
	    חכמות בנוגע לחיסכון הפנסיוני שלכם.">
	<title> פיננסי-נט</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-3d@latest/dist/chartjs-chart-3d.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/ScrollToPlugin.min.js"></script>
    <script src="data.js"></script>
    <script src="kochavimscript.js"></script>
    <script src="PensiaScript.js"></script>
    <script src="mainscript.js"></script>
  
  <style>


    .choose-us-title{
        display: flex;
        justify-content: center;
        align-items: center;
        width: clamp(300px, 100%, 1400px);
        margin-bottom: 30px;
        background: white;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        border-radius: 20px;
        margin-right: auto;
        margin-left: auto;
       
    }
    .choose-us-title-text{
        font-size: 2rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        padding: 0.6rem;
        
    }
    .flex-container{
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width:clamp(300px, 100%, 1400px);
        margin-right: auto;
        margin-left: auto;
    }
    .flex-container-row{
        display: flex;
        flex-direction: row;
        align-items: stretch;
        justify-content: center;
        gap: 2rem;
        width: clamp(300px, 100%, 1400px);
        margin-right: auto;
        margin-left: auto;
        flex-wrap: wrap;
    }
    
    .flex-container-row > .feature-card {
        flex: 1;
        min-width: 300px;
        max-width: calc(33.333% - 1.5rem);
    }
     .tbl-button{
         background-color: #667eea;
         color: white;
         padding: 12px 24px;
         border: none;
         border-radius: 8px;
         cursor: pointer;
         transition: all 0.3s ease;
         font-size: 0.9rem;
         font-weight: bold;
         text-align: center;
         line-height: 1.2;
         min-width: 120px;
         height: auto;
         box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
     }
     
     .tbl-button:hover {
         background-color: #5a6fd8;
         transform: translateY(-2px);
         box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
     }
	.mainTitle,.secondTitle{

			text-align: right;
			margin: 10px 0;
			font-size: 1.5rem;
			color: #333;
			max-width: 1400px;
			display: flex;
            flex-direction: column;
            align-items: center;
			margin-right: auto;
			margin-left: auto;
			padding: 20px;
			 
		}
		
		#services{
			padding-bottom: 0%;
			padding-top: 0%;
		}
          .file-upload-section{
              display: none;
		}
		.secondTitle{
			margin-top: 10px;
		}
		.mainTitle .feature-card,.secondTitle .feature-card {
			display: flex;
			flex-direction: column;
            max-width:clamp(30%, 1400px, 1400px);
            gap: 10px;
		}

		.mainTitle .feature-title,.secondTitle .feature-title {
			text-align: center;
            font-size: 2.5rem;
            margin-bottom: 3rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
			line-height: 1.2;
		}

		.mainTitle .feature-description,.secondTitle .feature-description{
			font-size: 1.8rem;
			font-weight: lighter;
		}
		.mainTitle .cta-button,.secondTitle .cta-button{
			margin-top: 80px;
		}
	.feature-card {
		background: white;
		padding: 2rem;
		border-radius: 20px;
		box-shadow: 0 10px 30px rgba(0,0,0,0.1);
		text-align: right;
		transition: transform 0.3s ease, box-shadow 0.3s ease;
	}

	/* CSS for calculator dropdown */
	.calculator-dropdown {
		position: relative;
		display: inline-block;
		width: 100%;
		margin-top: 15px;
	}

	.calculator-dropdown button {
		width: 100%;
		padding: 15px 25px;
		font-size: 16px;
		font-weight: 600;
		border: none;
		border-radius: 25px;
		cursor: pointer;
		display: flex;
		align-items: center;
		justify-content: center;
		gap: 8px;
		transition: all 0.3s ease;
		background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		color: white;
	}

	.calculator-dropdown button:hover {
		transform: translateY(-2px);
		box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
	}

	.calculator-dropdown button.active {
		border-radius: 25px 25px 0 0;
		box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
	}

	.dropdown-content {
		display: none;
		position: absolute;
		min-width: 100%;
		top: calc(100% - 2px);
		left: 0;
		background: white;
		border: 1px solid rgba(102, 126, 234, 0.2);
		border-radius: 0 0 8px 8px;
		box-shadow: none;
		z-index: 1000;
		margin-top: 0;
		border-top: none;
	}

	.dropdown-content.show {
		display: block;
		animation: dropdownFadeIn 0.3s ease;
	}

	.dropdown-content a {
		color: #333;
		padding: 12px 16px;
		text-decoration: none;
		display: block;
		transition: background-color 0.3s ease;
		font-size: 14px;
		font-weight: 500;
		border-bottom: 1px solid rgba(102, 126, 234, 0.1);
	}

	.dropdown-content a:last-child {
		border-bottom: none;
	}

	.dropdown-content a:hover {
		background-color: #f8f9fa;
		color: #667eea;
	}

	@keyframes dropdownFadeIn {
		from {
			opacity: 0;
			transform: translateY(-10px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	/* CSS for tools dropdown - same styling as calculator dropdown */
	.tools-dropdown {
		position: relative;
		display: inline-block;
		width: 100%;
		margin-top: 15px;
	}

	.tools-dropdown button {
		width: 100%;
		padding: 15px 25px;
		font-size: 16px;
		font-weight: 600;
		border: none;
		border-radius: 25px;
		cursor: pointer;
		display: flex;
		align-items: center;
		justify-content: center;
		gap: 8px;
		transition: all 0.3s ease;
		background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		color: white;
	}

	.tools-dropdown button:hover {
		transform: translateY(-2px);
		box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
	}

	.tools-dropdown button.active {
		border-radius: 25px 25px 0 0;
		box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
	}

	.tools-dropdown .dropdown-content {
		display: none;
		position: absolute;
		min-width: 100%;
		top: calc(100% - 2px);
		left: 0;
		background: white;
		border: 1px solid rgba(102, 126, 234, 0.2);
		border-radius: 0 0 8px 8px;
		box-shadow: none;
		z-index: 1000;
		margin-top: 0;
		border-top: none;
	}

	.tools-dropdown .dropdown-content.show {
		display: block;
		animation: dropdownFadeIn 0.3s ease;
	}

	.tools-dropdown .dropdown-content a {
		color: #333;
		padding: 12px 16px;
		text-decoration: none;
		display: block;
		transition: background-color 0.3s ease;
		font-size: 14px;
		font-weight: 500;
		border-bottom: 1px solid rgba(102, 126, 234, 0.1);
	}

	.tools-dropdown .dropdown-content a:last-child {
		border-bottom: none;
	}

	.tools-dropdown .dropdown-content a:hover {
		background-color: #f8f9fa;
		color: #667eea;
	}
    

	.feature-card:hover {
		transform: translateY(-10px);
		box-shadow: 0 20px 40px rgba(0,0,0,0.15);
	}

	.feature-icon {
		font-size: 3rem;
		margin-bottom: 1rem;
		background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
        text-align: center;
       
	}

	.feature-title {
		font-size: 1.5rem;
		margin-bottom: 1rem;
		color: #333;
        text-align: center;
	}

	.feature-description {
		color: #666;
		margin-bottom: 1.5rem;
        text-align: center;
	}
	
    .logos {
            display: flex;
            overflow: hidden;
            white-space: nowrap;
            width: 100%;
			position: relative;
			bottom: 25px;
			margin: 25px 0px;
        }

        .logos-slide {
            display: flex;
            animation: scroll 20s linear infinite;
        }

        .logos-slide img {
            height: 100px; /* Adjust height as needed */
            margin: 0 20px; /* Space between logos */
            flex-shrink: 0;
        }

        @keyframes scroll {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(-50%); /* Move half the width for seamless loop */
            }
        }

        /* Optional: Pause animation on hover */
        .logos:hover .logos-slide {
            animation-play-state: paused;
        }
		

		.logos-slide img {
			width: 200px; /* Adjust width as needed */
			height: 60px; /* Maintain aspect ratio */
			margin: 10px 80px ; /* Space between logos */
			transition: transform 0.3s ease; /* Smooth scaling effect */
		}
		
		.logos-slide img:last-child {
			margin-right: 0; /* Remove margin from the last image */
		}
  
  
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            max-width: 100%;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            overflow-x: hidden;
			background: #f8fafc;
            margin: 0;
            padding: 0;
            width: 100%;
            max-width: 100vw;
        }
        
        html {
            scroll-behavior: smooth;
            overflow-x: hidden;
            width: 100%;
            max-width: 100vw;
        }
        
        /* וידוא שהדף תמיד מתחיל בחלק העליון */
        html, body {
            scroll-padding-top: 0;
        }

        /* Header */
        .header {
            position:sticky;
            top: 0;
            width: 100% !important;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            z-index: 1000;
            padding: 1rem 0;
            transition: all 0.3s ease;
            max-width: 1400px;
            margin-right: auto;
            margin-left: auto;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-menu {
            list-style: none;
            display: flex;
            gap: 2rem;
            align-items: center;
            
        }

        .nav-menu a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s ease;
            position: relative;
            font-size: 16px;
        }

        .nav-menu a:hover {
            color: #667eea;
        }

        .nav-menu a:hover::after {
            width: 100%;
        }

        .nav-menu a::after {
            content: '';
            position: absolute;
            bottom: -5px;
            right: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            
        }

        /* Navigation Dropdown */
        .nav-dropdown {
            position: relative;
        }

        .nav-dropdown .dropdown-content {
            display: flex;
            flex-direction: column;
            position: absolute;
            top: calc(100% - 2px);
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 0 0 8px 8px;
            box-shadow: none;
            min-width: 220px;
            z-index: 1001;
            margin-top: 0;
            border-top: none;
            max-height: 0;
            opacity: 0;
            visibility: hidden;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease, visibility 0.3s ease;
        }

        .nav-dropdown .dropdown-content a {
            color: #333;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            transition: background-color 0.3s ease;
            font-size: 14px;
            border-bottom: 1px solid #eee;
        }

        .nav-dropdown .dropdown-content a:hover {
            background-color: #f5f5f5;
            color: #667eea;
        }

        .nav-dropdown .dropdown-content a:last-child {
            border-bottom: none;
        }

        .nav-dropdown .dropdown-content.show {
            max-height: 500px;
            opacity: 1;
            visibility: visible;
        }
        
        /* Desktop hover behavior - only when not using JavaScript */
        @media (min-width: 769px) {
            .nav-dropdown:hover .dropdown-content:not(.show) {
                max-height: 500px;
                opacity: 1;
                visibility: visible;
            }
        }
        #gemelhashpolisa {
            text-align: center;
            font-size: 1.4rem;
            margin-bottom: 20px;
        }
        .cta-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 24px;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
			margin-bottom: 10px;
            margin-left: auto;
            margin-right: auto;
            min-width: 90%;
            text-align: center;
        }
        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        .hamburger {
            display: none;
            flex-direction: column;
            cursor: pointer;
            gap: 4px;
        }

        .hamburger span {
            width: 25px;
            height: 3px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: 0.3s;
            border-radius: 3px;
        }

        .hamburger.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }

        .hamburger.active span:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }

        /* Hero Section with Slider */
        .hero {
            height: 100vh;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
        }

        .slider-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .slide.active {
            opacity: 1;
        }

        .slide::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.8) 0%, rgba(118, 75, 162, 0.8) 100%);
        }

        /* Slide Backgrounds */
        .slide:nth-child(1) {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%), url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><rect fill="%23f0f2ff" width="1200" height="800"/><g fill="%23667eea" opacity="0.1"><circle cx="200" cy="200" r="80"/><circle cx="800" cy="300" r="60"/><circle cx="1000" cy="600" r="100"/></g></svg>');
        }

        .slide:nth-child(2) {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%), url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><rect fill="%23e6f7ff" width="1200" height="800"/><g fill="%234facfe" opacity="0.1"><rect x="100" y="100" width="100" height="100" rx="10"/><rect x="700" y="200" width="80" height="80" rx="10"/><rect x="900" y="500" width="120" height="120" rx="10"/></g></svg>');
        }

        .slide:nth-child(3) {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%), url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><rect fill="%23fff5e6" width="1200" height="800"/><g fill="%23fa709a" opacity="0.1"><polygon points="200,150 250,100 300,150 250,200"/><polygon points="800,250 850,200 900,250 850,300"/><polygon points="1000,550 1050,500 1100,550 1050,600"/></g></svg>');
        }

        .slide:nth-child(4) {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%), url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><rect fill="%23f0fff4" width="1200" height="800"/><g fill="%23a8edea" opacity="0.1"><ellipse cx="200" cy="200" rx="60" ry="40"/><ellipse cx="800" cy="300" rx="80" ry="50"/><ellipse cx="1000" cy="600" rx="70" ry="45"/></g></svg>');
        }

        .slide:nth-child(5) {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%), url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><rect fill="%23fff0f5" width="1200" height="800"/><g fill="%23ff9a9e" opacity="0.1"><path d="M200 200 L250 150 L300 200 L250 250 Z"/><path d="M800 300 L850 250 L900 300 L850 350 Z"/><path d="M1000 600 L1050 550 L1100 600 L1050 650 Z"/></g></svg>');
        }

        .hero-content {
            position: relative;
            z-index: 10;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            align-items: center;
            height: 100%;
        }

        .hero-text {
            color: white;
        }

        .hero-title {
            font-size: 3.5rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            line-height: 1.2;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .hero-subtitle {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            opacity: 0.95;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .hero-cta {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .hero-visual {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .hero-icon {
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8rem;
            color: white;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            animation: float 6s ease-in-out infinite;		
        }

      @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
	

        /* Slider Controls */
        .slider-nav {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 20;
        }

        .slider-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .slider-dot.active {
            background: white;
            transform: scale(1.2);
        }

        /* Slider Arrows */
        .slider-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 20;
            transition: all 0.3s ease;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .slider-arrow:hover {
            background: rgba(255, 255, 255, 0.5);
            transform: translateY(-50%) scale(1.1);
        }

        .slider-arrow.prev {
            left: 30px;
			display: flex;
			align-items: center;
			justify-content: center;
        }

        .slider-arrow.next {
            right: 30px;
			display: flex;
			align-items: center;
			justify-content: center;
        }

        /* Features Section */
        .features {
            padding: 6rem 0;
            background: #f8fafc;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 3%;
        }

        .section-title {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 3rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
        }

        .feature-card {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: right;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            height: 25%;
        }

        .feature-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #333;
             height: 15%;
        }

        .feature-description {
            color: #666;
            margin-bottom: 1.5rem;
             height: 30%;
        }

        /* CTA Section */
        .cta-section {
            padding: 4rem 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            margin: 4rem auto;
            width: clamp(300px, 100%, 1400px);
            max-width: 1400px;
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.3);
        }
        
        .cta-section .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            gap: 1.5rem;
        }

        .cta-title {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .cta-subtitle {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            opacity: 0.95;
            line-height: 1.6;
            max-width: 800px;
        }

        .cta-button-white {
            background: white;
            color: #667eea;
            padding: 18px 40px;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            font-size: 1.2rem;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            width: clamp(300px, 100%, 300px);
        }

        .cta-button-white:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.3);
            background: #f8f9fa;
        }
        
        /* Comparison Modal Styles */
        .comparison-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            backdrop-filter: blur(5px);
            overflow-y: auto;
            padding: 2rem 0;
        }
        
        .comparison-modal.show {
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }
        
        .comparison-card {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: right;
            line-height: 1.8;
            max-width: 900px;
            width: 90%;
            margin: 2rem auto;
            position: relative;
            animation: slideInFromTop 0.4s ease;
        }
        
        @keyframes slideInFromTop {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .comparison-card h2 {
            font-size: 2.2rem;
            margin-bottom: 2rem;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .comparison-card h3 {
            font-size: 1.8rem;
            margin: 2.5rem 0 1.5rem;
            color: #333;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .comparison-card h4 {
            font-size: 1.3rem;
            margin: 1.5rem 0 1rem;
            color: #667eea;
            font-weight: 600;
        }
        
        .comparison-card p {
            color: #555;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }
        
        .comparison-card ul {
            list-style: none;
            padding: 0;
            margin: 1rem 0 2rem 0;
        }
        
        .comparison-card li {
            margin-bottom: 1rem;
            padding-right: 1.5rem;
            position: relative;
            color: #555;
            font-size: 1.05rem;
        }
        
        .comparison-card li::before {
            content: '✓';
            position: absolute;
            right: 0;
            color: #28a745;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .comparison-card .cons-list li::before {
            content: '✗';
            color: #dc3545;
        }
        
        .comparison-card .summary-box {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            padding: 2rem;
            border-radius: 15px;
            margin-top: 2rem;
            border-right: 4px solid #667eea;
        }
        
        .comparison-card .summary-box h3 {
            margin-top: 0;
        }
        
        .comparison-card .summary-box p {
            margin-bottom: 0.5rem;
        }
        
        .close-comparison-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            margin-top: 2rem;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        
        .close-comparison-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }
        
        /* Top Performers Table */
        .top-performers-section {
            margin: 3rem 0;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
            border-radius: 15px;
            border: 2px solid rgba(102, 126, 234, 0.2);
        }
        
        .top-performers-section h3 {
            text-align: center;
            color: #667eea;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
        }
        
        .performers-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .performers-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .performers-table th {
            padding: 15px 12px;
            text-align: center;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .performers-table td {
            padding: 15px 12px;
            text-align: center;
            border-bottom: 1px solid #e2e8f0;
            background: white;
            color: #333;
        }
        
        .performers-table tbody tr:hover {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }
        
        .performers-table .rank-cell {
            font-weight: bold;
            font-size: 1.2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .performers-table .return-cell {
            font-weight: bold;
            color: #28a745;
            font-size: 1.1rem;
        }
        
        .performers-table .name-cell {
            text-align: right;
            font-weight: 500;
        }
        
        .performers-table .company-cell {
            text-align: right;
            color: #666;
            font-size: 0.9rem;
        }
        
        .loading-spinner {
            text-align: center;
            padding: 2rem;
            color: #667eea;
        }
        
        .loading-spinner i {
            font-size: 2rem;
            animation: spin 1s linear infinite;
        }
        
        /* Consultation Form Modal */
        #consultationFormModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 10000;
            backdrop-filter: blur(5px);
        }
        
        #consultationFormModal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #consultationFormModal > div {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideInFromTop 0.4s ease;
            position: relative;
        }
        
        #consultationFormModal .close-modal-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            background: #e74c3c;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
            z-index: 10;
        }
        
        #consultationFormModal .close-modal-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.5);
        }
	.logoimg{
                width: 200px;
                height: auto;
                
            }
	.slider-touch {display: none;}
        
        
        
        #dataDisplayContainer {
            max-width: 1200px;
            width: 100%;
            margin: 20px auto;
            display: none;
            background: #f8fafc;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            box-sizing: border-box;
        }
        
        .data-grid-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
            width: 100%;
        }
        
        .data-card {
            background: rgba(255,255,255,0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 100%;
        }
        
        /* כרטיסיות מובייל לטבלת סיכום מפורט */
        .cards-container-mobile {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
        }
        
        .product-card-mobile {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            width: 100%;
        }
        
        .card-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .card-row:last-child {
            border-bottom: none;
        }
        
        .card-label {
            font-weight: 600;
            color: #4a5568;
            font-size: 0.95rem;
        }
        
        .card-value {
            font-weight: bold;
            font-size: 1rem;
            text-align: left;
        }
         @media (max-width: 1400px) {
            .logoimg{
                width: 200px;
                height: auto;
                
            }
        
         }
        /* Mobile Responsive */
        @media (max-width: 768px) {
            #gemelhashpolisa {
                font-size: 1rem;
            }
            .flex-container-row{
                display: flex;
                flex-direction: column;
                gap: 1.5rem;
                width: calc(100% - 1rem);
                margin: 0 0.5rem;
            }
            
            .flex-container-row > .feature-card {
                flex: 1;
                min-width: 100%;
                max-width: 100%;
                margin: 0;
            }  
             /* רספונסיביות לרשימות הנפתחות */
             .calculator-dropdown button,
             .tools-dropdown button {
                 font-size: 14px !important;
                 padding: 12px 20px !important;
             }
             
             .data-card-table{
                width:clamp(300px, 100%, 1000px) !important;
             }
             .dropdown-content a,
             .tools-dropdown .dropdown-content a {
                 padding: 12px 18px !important;
                 font-size: 14px !important;
             }
             
             /* תיקון תצוגת קישורים ארוכים במסכים קטנים - מחשבונים */
             .calculator-dropdown .dropdown-content a {
                 white-space: normal !important;
                 overflow: visible !important;
                 text-overflow: unset !important;
                 line-height: 1.4 !important;
                 text-align: center !important;
             }

             /* תיקון תצוגת קישורים ארוכים במסכים קטנים */
             .tools-dropdown .dropdown-content a {
                 white-space: normal !important;
                 overflow: visible !important;
                 text-overflow: unset !important;
                 line-height: 1.4 !important;
                 text-align: center !important;
             }
             
                 /* עיצוב רספונסיבי לתצוגת הנתונים */
                 @media (max-width: 768px) {
                    .smallfont{
                        font-size: 0.8rem !important;
                    }
                     #dataDisplayContainer {
                         width: clamp(280px, 85vw,280px) !important;
                         margin-right: auto !important;
                         margin-left: auto !important;
                         padding: 15px !important;
                         box-sizing: border-box !important;
                         overflow-x: hidden !important;
                     }
                 
                 .data-grid-container {
                     display: flex !important;
                     flex-direction: column !important;
                     gap: 15px !important;
                     grid-template-columns: unset !important;
                     width: clamp(280px, 85vw,280px) !important;
                     margin-bottom: 15px !important;
                     align-items: center !important;
                 }
                 
                 .data-card {
                     width: 100% !important;
                     max-width: 100% !important;
                     padding: 15px !important;
                     box-sizing: border-box !important;
                     margin: 0 !important;
                 }
                 
                 .product-card-mobile {
                     width: 100% !important;
                     padding: 15px !important;
                     margin-bottom: 12px !important;
                     box-sizing: border-box !important;
                 }
                 
                 .cards-container-mobile {
                     width: 100% !important;
                 }
                 
                 .card-row {
                     padding: 8px 0 !important;
                     flex-wrap: wrap !important;
                 }
                 
                 .card-label {
                     font-size: 0.85rem !important;
                     flex: 1 !important;
                     min-width: 140px !important;
                 }
                 
                 .card-value {
                     font-size: 0.9rem !important;
                     text-align: right !important;
                 }
                 
                 #dataDisplayContainer h2 {
                     font-size: 1.2rem !important;
                     text-align: center !important;
                     line-height: 1.3 !important;
                     padding: 0 5px !important;
                 }
                 
                 #dataDisplayContainer h3 {
                     font-size: 0.9rem !important;
                     white-space: normal !important;
                     text-align: center !important;
                     line-height: 1.3 !important;
                     padding: 0 5px !important;
                 }
                 
                 #dataDisplayContainer p {
                     font-size: 0.85rem !important;
                     padding: 0 5px !important;
                     line-height: 1.4 !important;
                 }
                 
                 #dataDisplayContainer table {
                     font-size: 0.6rem !important;
                     width: 100% !important;
                     overflow-x: auto !important;
                 }
                 
                 #dataDisplayContainer #detailedSummary {
                     overflow-x: auto !important;
                     width: 100% !important;
                     -webkit-overflow-scrolling: touch !important;
                 }
                 
                 #dataDisplayContainer canvas {
                     max-width: 100% !important;
                     width: 100% !important;
                     height: auto !important;
                 }
                 
                 #dataDisplayContainer #pieChart {
                     max-height: 200px !important;
                     max-width: 100% !important;
                 }
                 
                 #dataDisplayContainer th,
                 #dataDisplayContainer td {
                     padding: 4px 2px !important;
                     font-size: 0.6rem !important;
                 }
                 
                 #dataDisplayContainer th {
                     font-size: 0.65rem !important;
                     line-height: 1.2 !important;
                 }
                 
                 /* עיצוב רספונסיבי לכרטיסיות */
                 .chart-actions {
                     flex-direction: column !important;
                     align-items: center !important;
                     gap: 10px !important;
                 }
                 
                 .chart-action-btn {
                     width: 90% !important;
                     max-width: 300px !important;
                     margin: 0 auto !important;
                 }
                 
                 /* עיצוב רספונסיבי לכפתורים בתצוגת הנתונים */
                 #dataDisplayContainer > div:last-child {
                     display: flex !important;
                     flex-direction: column !important;
                     align-items: center !important;
                     gap: 15px !important;
                 }
                 
                #dataDisplayContainer button {
                    width: 100% !important;
                    max-width: 100% !important;
                    margin: 5px auto !important;
                    padding: 12px 15px !important;
                    font-size: 0.9rem !important;
                    box-sizing: border-box !important;
                    white-space: normal !important;
                    line-height: 1.3 !important;
                }
                
                 /* תיקון עבור כרטיסיות שאינן בתוך dataDisplayContainer */
                 .flex-container-row > .feature-card {
                     width: 100% !important;
                     max-width: 100% !important;
                     
                 }
                 
                 /* עיצוב רספונסיבי לטופס ייעוץ פנסיוני */
                #consultationFormModal > div {
                    padding: 25px !important;
                    max-width: 95% !important;
                    width: 95% !important;
                    max-height: 70vh !important;
                    margin: 0 !important;
                }
                
            
                
                #consultationFormModal h3 {
                    font-size: 1.5rem !important;
                }
                
                #consultationFormModal p {
                    font-size: 0.95rem !important;
                }
                
                #consultationFormModal input,
                #consultationFormModal textarea {
                    font-size: 1rem !important;
                    padding: 12px !important;
                }
                
                #consultationFormModal button {
                    padding: 14px 24px !important;
                    font-size: 1rem !important;
                }
                 
                 /* עיצוב רספונסיבי ל-file-upload-section */
                 .file-upload-section {
                     max-width: 100% !important;
                     width: 100% !important;
                     margin: 0 !important;
                     padding: 2rem 0.5rem !important;
                     box-sizing: border-box !important;
                 }
                 
                 .file-upload-container {
                     max-width: 100% !important;
                     width: 100% !important;
                     padding: 0 0.5rem !important;
                     box-sizing: border-box !important;
                 }
             }
		.hero-text h1 {
            font-size: 1.5rem;
        }
        .slider-arrow.prev,.slider-arrow.next {
           display: none;
        }
		.mainTitle,.secondTitle {
			margin-left: 0.5rem;
			margin-right: 0.5rem;
			padding: 10px;
			width: calc(100% - 1rem);
		}
		.mainTitle .feature-card,.secondTitle .feature-card {
			flex-direction: column;
			align-items: center;
			gap: 2rem;
			width: 100%;
			margin: 0;
		}
		.mainTitle .cta-button,.secondTitle .cta-button{
			margin-top: -35px;
			font-size: 1rem;
			
		}
		.mainTitle .feature-title,.secondTitle .feature-title{
			font-size: 1.8rem;
			padding-bottom: 0%;
			margin-bottom: 0%;
            text-align: center;
            text-wrap: wrap;
		}
		.mainTitle .hero-icon,.secondTitle .hero-icon{
			margin-top: 40px;
		}
		.mainTitle .feature-description,.secondTitle .feature-description{
			display: flex;
			padding-bottom: 25px;
			font-size: 1.2rem;
			height: auto;
            text-align: right;
            text-wrap: wrap;
			
		}
            .feature-title {
               height: 25%;}

            .logoimg{
                width: 150px;
                height: auto;
            }
			
			.header {
				padding: 1rem 0;
                width: 100%;
                margin: 0%;
                padding: 0%;
			}

			.nav-container {
				padding: 1rem 1rem;
			}

		.nav-menu {
            position: fixed;
            top: 80px;
            right: 0;
            width: 100%;
            height: calc(100vh - 80px);
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            padding-top: 2rem;
            display: flex;
            opacity: 0;
            visibility: hidden;
            transform: translateX(100%);
            transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
		}

		.hamburger {
			display: flex;
		}

		.nav-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateX(0);
            margin-top: -25px; 
		}
        .nav-menu.active li,.nav-menu.active li a{
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-left: auto;
            margin-right: auto;
            width: 100%;
        }
            /* Mobile nav-dropdown adjustments */
            .nav-dropdown .dropdown-content {
                position: relative;
                display: flex;
                flex-direction: column;
                min-width: auto;
                width: clamp(200px, 100%, 270px);
                max-height: 0;
                opacity: 0;
                visibility: hidden;
                overflow: hidden;
                border: none;
                background:white;
                margin-top: 5px;
                top: auto;
                border-radius: 15px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                padding: 0;
                transition: max-height 0.3s ease, opacity 0.3s ease, visibility 0.3s ease, padding-top 0.3s ease;
                }

                .nav-dropdown .dropdown-content a {
                padding: 8px 16px;
                border-bottom: 1px solid rgba(255,255,255,0.1);
                font-size: 1rem;
                }

                .nav-dropdown .dropdown-content.show {
                max-height: 500px;
                opacity: 1;
                visibility: visible;
                padding-top: 15px;
                }

            .hamburger {
                display: flex;
                padding-left: 5%;
            }

            .hero-content {
                grid-template-columns: 1fr;
                text-align: right;
                gap: 2rem;
                padding: 2rem 1rem;
            }

            .hero-title {
                font-size: 2.5rem;
            }

            .hero-subtitle {
				display: flex;
				justify-content: center;
				align-items: center;
                font-size: 1.1rem;
				
            }

            .hero-icon {
                width: 120px;
                height: 120px;
                font-size: 3.5rem;
            }

            .hero-cta {
                justify-content: center;
            }

            .features-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
				margin-right: 0;
				margin-left: 0;
            }
            
            .feature-card {
                margin-right: 0;
                margin-left: 0;
                width: 100%;
            }
            
            .container {
                padding: 0 1rem;
            }
            
            .containerCards {
                margin: 0 0.5rem !important;
            }
            
            .comparison-modal {
                padding: 1rem 0;
            }
            
            .comparison-card {
                padding: 2rem 1.5rem;
                width: 95%;
                margin: 1rem auto;
            }
            
            .comparison-card h2 {
                font-size: 1.6rem;
                line-height: 1.3;
            }
            
            .comparison-card h3 {
                font-size: 1.4rem;
                flex-direction: column;
                align-items: flex-start;
            }
            
            .comparison-card h4 {
                font-size: 1.2rem;
            }
            
            .comparison-card p,
            .comparison-card li {
                font-size: 0.95rem;
                line-height: 1.6;
            }
            
            .comparison-card .summary-box {
                padding: 1.5rem;
            }
            
            .close-comparison-btn {
                padding: 12px 30px;
                font-size: 1rem;
            }
            
            .top-performers-section {
                padding: 1.5rem 1rem;
            }
            
            .top-performers-section h3 {
                font-size: 1.4rem;
            }
            
            .performers-table th,
            .performers-table td {
                padding: 10px 6px;
                font-size: 0.85rem;
            }
            
            .performers-table .rank-cell {
                font-size: 1rem;
            }
            
            .performers-table .return-cell {
                font-size: 0.95rem;
            }
            
            .performers-table .company-cell {
                font-size: 0.8rem;
            }
            
            /* הסתרת עמודת מ"ה במסכים קטנים */
            .performers-table .mh-column {
                display: none;
            }
            
            .performers-table {
                width: 100%;
                overflow-x: hidden;
            }
            
            .performers-table .name-cell,
            .performers-table .company-cell {
                text-align: right;
                padding: 10px 8px;
            }

            .section-title {
                font-size: 2rem;
                text-align: center;
                text-wrap: wrap;
            }

            .cta-title {
                font-size: 2rem;
            }

            .slider-arrow {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }

            .slider-arrow.prev {
                right: 15px;
            }

            .slider-arrow.next {
                left: 15px;
            }
			.slider-touch {
				width: 100%;
				font-size: 1.2rem;
				color: #fff;
				z-index: 1000;
				position: relative;
				top:10%;
				display: flex;
				justify-content: space-between;
				padding: 0 20px;

			}
			.cta-section{
				margin: 2rem 0.5rem;
				padding: 3rem 1.5rem;
				width: calc(100% - 1rem);
			}
			
			.cta-title {
				font-size: 2rem;
			}
			
			.cta-subtitle {
				font-size: 1.1rem;
			}
			
			.cta-button-white {
				padding: 15px 30px;
				font-size: 1rem;
			}
        .logos-slide img {
			width: 150px; /* Adjust width as needed */
			height: 45px; /* Maintain aspect ratio */
			margin: 10px 60px ; /* Space between logos */
			transition: transform 0.3s ease; /* Smooth scaling effect */
		}
		#altshuler-logo{
			width:70px; /* Adjust width as needed */
			height: 45px;	
		}
		}
		.container .feature-card{
			display: flex;
			flex-direction: column;
			align-items:space-between;
			justify-content: center;
			border-radius: 20px;
            width: 100%;
            padding: 0%;
            margin: 0%;
		}
        .hatid{
            white-space: nowrap;
        }
        
        /* File Upload Section Styles */
        .file-upload-section {
            padding: 6rem 0;
            background: #f8fafc;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .file-upload-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        
        .file-upload-area {
            border: 3px dashed #667eea;
            border-radius: 20px;
            padding: 3rem 2rem;
            text-align: right;
            background: white;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .file-upload-area:hover {
            border-color: #764ba2;
            background: #f8fafc;
            transform: translateY(-5px);
        }
        
        .file-upload-area.dragover {
            border-color: #764ba2;
            background: #f0f2ff;
            transform: scale(1.02);
        }
        
        .upload-icon {
            font-size: 4rem;
            color: #667eea;
            margin-bottom: 1rem;
        }
        
        .file-upload-area h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: #333;
        }
        
        .file-upload-area p {
            color: #666;
            margin-bottom: 2rem;
        }
        
        .uploaded-files {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .uploaded-files h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #333;
        }
        
        .files-list {
            margin-bottom: 2rem;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 10px;
            margin-bottom: 0.5rem;
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        
        .file-icon {
            font-size: 1.5rem;
            color: #667eea;
        }
        
        .file-name {
            font-weight: 500;
            color: #333;
        }
        
        .file-size {
            color: #666;
            font-size: 0.9rem;
        }
        
        .file-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .delete-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }
        
        .delete-btn:hover {
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.6);
        }
        
        .file-data-display {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .file-data-display h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #333;
        }
        
        .data-content {
            background: #f8fafc;
            border-radius: 10px;
            padding: 1.5rem;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .data-table th,
        .data-table td {
            padding: 0.75rem;
            text-align: right;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .data-table th {
            background: #667eea;
            color: white;
            font-weight: bold;
        }
        
        .data-table tr:hover {
            background: #f1f5f9;
        }
        
        .loading {
            text-align: right;
            padding: 2rem;
            color: #667eea;
        }
        
        .loading i {
            font-size: 2rem;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Chart Styles */
        .chart-container {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .chart-wrapper {
            position: relative;
            width: 80%;
            max-width: 400px;
        }
        
        #myDoughnutChart {
            width: 100% !important;
            height: auto !important;
        }
        
        .custom-legend {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background-color: #f9f9f9;
            text-align: right;
            width: 100%;
            max-width: 500px;
            box-sizing: border-box;
        }
        
        .custom-legend h3 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .legend-item {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            width: 100%;
            flex-wrap: wrap;
        }
        
        .legend-color-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .legend-label {
            font-size: 16px;
            color: #333;
            flex-grow: 1;
        }
        
        .legend-value {
            font-size: 16px;
            color: #667eea;
            font-weight: bold;
        }
        
        /* Advanced Analysis Styles */
        .advanced-analysis-section {
            padding: 6rem 0;
            background: #f8fafc;
        }
        
        /* עיצוב רספונסיבי לניתוח מתקדם */
        @media (max-width: 768px) {
            .advanced-analysis-section {
                padding: 3rem 0 !important;
            }
            
            .analysis-tabs {
                flex-direction: column !important;
                align-items: center !important;
                gap: 0.5rem !important;
                margin-bottom: 2rem !important;
            }
            
            .tab-button {
                width: 90% !important;
                max-width: 300px !important;
                margin: 0 auto !important;
                padding: 15px 20px !important;
                font-size: 0.9rem !important;
            }
            
            .analysis-content {
                padding: 0 1rem !important;
            }
            
            /* תיקון התצוגה במובייל - הכל אחד מעל השני */
            .analysis-grid {
                grid-template-columns: 1fr !important;
                gap: 1rem !important;
            }
            
            .summary-grid {
                grid-template-columns: 1fr !important;
                gap: 1rem !important;
            }
            
            /* תיקון התצוגה של הפרטים האישיים והגרף */
            div[style*="grid-template-columns: 1fr 1fr"] {
                grid-template-columns: 1fr !important;
                gap: 20px !important;
            }
            
            .analysis-content h3 {
                font-size: 1.2rem !important;
                text-align: center !important;
            }
            
            .analysis-content table {
                font-size: 0.7rem !important;
                overflow-x: auto !important;
            }
            
            .analysis-content th,
            .analysis-content td {
                padding: 8px 4px !important;
                white-space: nowrap !important;
            }
            
            .analysis-content .container {
                padding: 0 1rem !important;
            }
            
            /* עיצוב רספונסיבי לטבלת פיצויים */
            #pitzuimTable {
                min-width: 100% !important;
                width: 100% !important;
                display: block !important;
                overflow-x: auto !important;
            }
            #pitzuimTable thead,
            #pitzuimTable tbody,
            #pitzuimTable tr {
                display: table !important;
                width: 100% !important;
            }
            #pitzuimTable th,
            #pitzuimTable td {
                font-size: 0.55rem !important;
                padding: 4px 2px !important;
                min-width: auto !important;
                white-space: nowrap !important;
            }
            #pitzuimTable th {
                font-size: 0.55rem !important;
                line-height: 1.1 !important;
            }
        }
        
        .analysis-tabs {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 3rem;
            flex-wrap: wrap;
        }
        
        .tab-button {
            background: white;
            color: #667eea;
            padding: 12px 24px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .tab-button:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }
        
        .tab-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .tab-panel {
            display: none;
        }
        
        .tab-panel.active {
            display: block;
        }
        
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .analysis-card {
            background: #f8fafc;
            padding: 1.5rem;
            border-radius: 15px;
            border: 1px solid #e2e8f0;
        }
        
        .analysis-card h4 {
            color: #667eea;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        
        .chart-container-small {
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }
        
        .comparison-table {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            border: 1px solid #e2e8f0;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .summary-card {
            background: #f8fafc;
            padding: 2rem;
            border-radius: 15px;
            border: 1px solid #e2e8f0;
            text-align: right;
        }
        
        .score-display {
            font-size: 3rem;
            font-weight: bold;
            color: #28a745;
            margin: 1rem 0;
        }
        
        .recommendations {
            text-align: right;
            line-height: 1.6;
        }
        
        .recommendations-list {
            text-align: right;
            line-height: 1.8;
        }
        
        .analysis-actions {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 3rem;
            flex-wrap: wrap;
        }
        
        .retirement-analysis {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            border: 1px solid #e2e8f0;
            min-height: 200px;
        }
        
        .retirement-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .retirement-item:last-child {
            border-bottom: none;
        }
        
        .retirement-label {
            font-weight: 500;
            color: #4a5568;
        }
        
        .retirement-value {
            font-weight: bold;
            color: #2d3748;
        }
        
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 1.5rem;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .data-table th,
        .data-table td {
            padding: 16px 20px;
            text-align: right;
            border: none;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .data-table[dir="rtl"] {
            direction: rtl;
        }
        
        .data-table[dir="rtl"] th,
        .data-table[dir="rtl"] td {
            text-align: right;
        }
        
        .data-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            font-size: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
        }
        
        .data-table th:first-child {
            border-top-right-radius: 12px;
        }
        
        .data-table th:last-child {
            border-top-left-radius: 12px;
        }
        
        .data-table tbody tr {
            transition: all 0.3s ease;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .data-table tbody tr:hover {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .data-table tbody tr:nth-child(even) {
            background: #fafbfc;
        }
        
        .data-table tbody tr:nth-child(even):hover {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        }
        
        .data-table td {
            color: #2d3748;
            font-weight: 500;
        }
        
        .data-table tbody tr:last-child td:first-child {
            border-bottom-right-radius: 12px;
        }
        
        .data-table tbody tr:last-child td:last-child {
            border-bottom-left-radius: 12px;
        }
        
        .retirement-details {
            margin-top: 2rem;
        }
        
        .retirement-details h4 {
            color: #2d3748;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #667eea;
            display: inline-block;
        }
        
        .retirement-summary {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .retirement-summary h4 {
            color: #2d3748;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #667eea;
            display: inline-block;
        }
        
        .currency-value {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: #2d3748;
            background: linear-gradient(135deg, #e6fffa 0%, #f0fff4 100%);
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            display: inline-block;
            min-width: 120px;
            text-align: right;
        }
        
        .not-relevant {
            color: #a0aec0;
            font-style: italic;
            background: #f7fafc;
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            display: inline-block;
        }
        
        .product-type {
            font-weight: 600;
            color: #4a5568;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            padding: 6px 12px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            display: inline-block;
            min-width: 150px;
            text-align: right;
        }
        
        .retirement-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .retirement-item:hover {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding-left: 8px;
            padding-right: 8px;
            border-radius: 8px;
        }
        
        .retirement-item:last-child {
            border-bottom: none;
        }
        
        .retirement-label {
            font-weight: 500;
            color: #4a5568;
            font-size: 15px;
        }
        
        .retirement-value {
            font-weight: 600;
            color: #2d3748;
            font-size: 16px;
        }
        
        .data-table tr:nth-child(even) {
            background: #f8fafc;
        }
        
        .data-table tr:hover {
            background: #e2e8f0;
        }
        
        .close-section-btn:hover {
            background: #c82333 !important;
            transform: scale(1.1);
        }
        
        .section-header {
            position: relative;
        }
        
        .chart-action-btn {
            min-width: 120px;
            max-width: 150px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        @media screen and (max-width: 768px) {
            .chart-actions {
                flex-direction: column !important;
                align-items: center !important;
                gap: 0.5rem !important;
            }
            
            .chart-action-btn {
                width: 200px;
                max-width: 200px;
                
            }
        }
        
        @media screen and (max-width: 480px) {
            .hatid{
                white-space: normal;
                font-size: 1.5rem;
            }
            .choose-us-title-text{
                font-size: 1.5rem;
            }
            
            .file-upload-area {
                padding: 2rem 1rem;
            }
            
            #dataDisplayContainer {
                width:clamp(280px, 85vw,280px) !important;
                margin-left: auto !important;
                margin-right:  auto !important;
                padding: 10px !important;
            }
            
            .data-card {
                padding: 12px !important;
                width: 100% !important;
            }
            
            .product-card-mobile {
                padding: 12px !important;
                width: 100% !important;
            }
            
            .product-card-mobile h4 {
                font-size: 0.9rem !important;
            }
            
            .card-label {
                font-size: 0.75rem !important;
                min-width: 120px !important;
            }
            
            .card-value {
                font-size: 0.8rem !important;
            }
            
            #dataDisplayContainer h2 {
                font-size: 1rem !important;
                padding: 0 3px !important;
            }
            
            #dataDisplayContainer h3 {
                font-size: 0.8rem !important;
                padding: 0 3px !important;
            }
            
            #dataDisplayContainer p {
                font-size: 0.7rem !important;
            }
            
            #dataDisplayContainer button {
                font-size: 0.7rem !important;
                padding: 8px !important;
            }
            
            #dataDisplayContainer table {
                font-size: 0.5rem !important;
            }
            
            #dataDisplayContainer th,
            #dataDisplayContainer td {
                padding: 3px 1px !important;
            }
            
            /* תיקון נוסף למובייל קטן - תפריטים נפתחים */
            .calculator-dropdown .dropdown-content a,
            .tools-dropdown .dropdown-content a {
                padding: 15px 10px !important;
                font-size: 13px !important;
                line-height: 1.5 !important;
                text-align: center !important;
                white-space: normal !important;
                word-wrap: break-word !important;
            }
            
            .calculator-dropdown button,
            .tools-dropdown button {
                font-size: 13px !important;
                padding: 10px 15px !important;
            }
            
            /* תיקון נוסף למובייל קטן */
            .analysis-grid,
            .summary-grid {
                grid-template-columns: 1fr !important;
                gap: 0.5rem !important;
            }
            
            div[style*="grid-template-columns: 1fr 1fr"] {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }
            
            .upload-icon {
                font-size: 3rem;
            }
            
            .file-upload-area h3 {
                font-size: 1.2rem;
            }
            
            .file-actions {
                flex-direction: column;
            }
            
            .file-item {
                flex-direction: column;
                gap: 0.5rem;
                text-align: right;
            }
        }
        
    </style>
    
    <!-- External Modal Styles -->
    <link rel="stylesheet" href="about-modal.css">
    <link rel="stylesheet" href="consultation-form.css">
    <link rel="stylesheet" href="terms-modal.css">
    <link rel="stylesheet" href="terms-consent.css">
    <link rel="stylesheet" href="risk-quest-modal.css">
    
    <!-- Accessibility and Footer -->
    <link rel="stylesheet" href="mainStyle.css">
    <link rel="stylesheet" href="footer.css">
    
    <style>
        /* Scroll to Top Button - Mobile Only */
        #scrollToTopBtn {
            display: none;
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 999;
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }
        
        #scrollToTopBtn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.6);
        }
        
        #scrollToTopBtn.show {
            display: block;
        }
        
        @media (min-width: 769px) {
            #scrollToTopBtn {
                display: none !important;
            }
        }
        
        /* Pension Clearance Tooltip */
        .pension-clearance-link {
            position: relative;
            display: inline-block;
            color: #667eea;
            font-weight: bold;
            cursor: pointer;
            text-decoration: underline;
            text-decoration-style: dotted;
            text-underline-offset: 3px;
        }
        
        .pension-tooltip {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            bottom: 140%;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            color: #333;
            padding: 16px 20px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            line-height: 1.6;
            max-width: 320px;
            width: max-content;
            z-index: 9999;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            border: 2px solid #667eea;
            transition: all 0.3s ease;
            pointer-events: none;
            white-space: normal;
            text-align: center;
        }
        
        .pension-tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -10px;
            border-width: 10px;
            border-style: solid;
            border-color: white transparent transparent transparent;
        }
        
        .pension-tooltip::before {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -12px;
            border-width: 12px;
            border-style: solid;
            border-color: #667eea transparent transparent transparent;
            z-index: -1;
        }
        
        .pension-clearance-link:hover .pension-tooltip {
            visibility: visible;
            opacity: 1;
            bottom: 150%;
            pointer-events: auto;
        }
        
        .pension-tooltip strong {
            color: #667eea;
            text-decoration: underline;
            font-weight: 700;
            transition: opacity 0.2s ease;
            cursor: pointer;
        }
        
        .pension-tooltip strong:hover {
            opacity: 0.7;
        }
        
        .pension-tooltip i {
            margin-left: 8px;
            color: #667eea;
            font-size: 16px;
        }
        
        /* Responsive - Mobile & Tablet */
        @media (max-width: 1024px) {
            .pension-tooltip {
                font-size: 14px;
                padding: 14px 18px;
                max-width: 280px;
                left: auto;
                right: 0;
                transform: none;
            }
            
            .pension-tooltip::after {
                left: auto;
                right: 20px;
            }
            
            .pension-tooltip::before {
                left: auto;
                right: 18px;
            }
        }
        
        @media (max-width: 480px) {
            .pension-tooltip {
                font-size: 13px;
                padding: 12px 14px;
                max-width: 240px;
            }
        }
    </style>
</head>

<body dir="rtl">
    
    
    <!-- Scroll to Top Button (Mobile Only) -->
    <button id="scrollToTopBtn" onclick="scrollToTop()" title="חזור למעלה">
        <i class="fas fa-arrow-up"></i>
    </button>
    <header class="header" dir="rtl">
        <div class="nav-container">   
            <nav class="nav-menu" id="navMenu">
                <li class="nav-dropdown">
                    <a href="#" onclick="toggleNavProductsDropdown(event)">מוצרים ותשואות ▼</a>
                    <div class="dropdown-content" id="navProductsDropdown">
                        <a href="mozarim.html?product=hishtalmut">קרנות השתלמות</a>
                        <a href="mozarim.html?product=gemel">קופות גמל</a>
                        <a href="mozarim.html?product=gemelHashkaa">קופות גמל להשקעה</a>
                        <a href="mozarim.html?product=yeled">חסכון לילד</a>
                        <a href="mozarim.html?product=polisot">פוליסות חסכון</a>
                        <a href="mozarim.html?product=pensia">קרנות פנסיה חדשות</a>
                    </div>
                </li>
                <li class="nav-dropdown">
                    <a href="#" onclick="toggleNavCalculatorDropdown(event)">מחשבונים ▼</a>
                    <div class="dropdown-content" id="navCalculatorDropdown">
                        <a href="prisatMaanak.html">פריסת מענק פרישה</a>
                        <a href="ribitderibit.html">חישוב ערך עתידי</a>
                        <a href="loan.html">סימולטור הלוואה</a>
                        <a href="hafkada.html">מחשבון הפקדה לסכום מטרה</a>
                        <a href="hashDmeyNihul.html">השוואת דמי ניהול</a>
                    </div>
                </li>
                <li class="nav-dropdown">
                    <a href="#" onclick="toggleNavToolsDropdown(event)">כלי השוואה ▼</a>
                    <div class="dropdown-content" id="navToolsDropdown">
                        <a href="hashMenahalot.html">השוואת חברות מנהלות</a>
                        <a href="hasifotMeshulav.html">מחולל חשיפות</a>
                        <a href="VirtualInvest.html">השוואת תיק משולב מסלולים</a>
                        <a href="#">ציון משקל תשואה לשארפ</a>
                    </div>
                </li>
                <li><a href="#" onclick="openAboutModal(); return false;">אודות</a></li>
                <li><a href="#contact" onclick="openConsultationForm(); return false;">צור קשר</a></li>
                <li class="whatsapp-desktop"><a href="https://wa.me/972545287184?text=שלום, אני מעוניין בייעוץ פנסיוני" target="_blank" title="צור קשר בוואטסאפ"><i class="fab fa-whatsapp" style="font-size:2rem; color:#25D366;"></i></a></li>
            </nav>
            <div class="whatsapp-mobile">
                <a href="https://wa.me/972545287184?text=שלום, אני מעוניין בייעוץ פנסיוני" target="_blank" title="צור קשר בוואטסאפ">
                    <i class="fab fa-whatsapp" style="font-size:2rem; color:#25D366;"></i>
                </a>
            </div>
            <div class="logo"> <img class="logoimg" src="logoxnew.png" onclick="navigateToHome();" 
                style="cursor: pointer;"/></div>
            <div class="hamburger" id="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </header>


<div class="mainTitle" dir="rtl">
	<div class="feature-card">
		<div dir="rtl" class="flex-container">
            
			<h1  class="feature-title hatid">העתיד הפיננסי שלך מתחיל כאן!</h1>
            <img class="hero-icon" src="savemoney.png" alt="Graph Icon" style="width: 300px;
             height: 300px;margin-left: auto;margin-right: auto;animation: none !important;"/>           

			<h1 class="feature-description"> כל מה שלא סיפרו לך על הכסף הפנסיוני שלך – עכשיו נחשף.
            בניתי פלטפורמה שמרכזת עבורך את כל המידע, ההשוואות והניתוחים החשובים – בצורה חכמה, פשוטה ושקופה.
            כך תוכל להבין באמת איפה אתה עומד, לקבל החלטות טובות יותר ולגרום לכסף שלך לעבוד בשבילך.</h1>           
            <a href="#fileUpload" class="cta-button bigscreen smallfont" style="margin-left: auto;margin-right: auto;"
            onclick="letStart()">לתהליך - חינם*</a>
            <div style="font-size: 20px;font-weight: bold;text-align: right;color: #666; margin-top: 15px;">
                *נדרש להעלות קובצי xml של 
                <a href="https://www.swiftness.co.il/?gad_source=1" target="_blank" rel="noopener noreferrer" class="pension-clearance-link" style="text-decoration: none;">
                    המסלקה הפנסיונית
                    <span class="pension-tooltip">
                        <i class="fas fa-info-circle"></i>
                        הזמנת קובצי מסלקה דרך 
                        <strong style="text-decoration: underline;">
                            האתר הרשמי של המסלקה הפנסיונית
                        </strong>
                    </span>
                </a>
            </div>
   
        </div> 
	</div>
    	
</div>
    <!-- File Upload Section -->
    <section class="file-upload-section" id="fileUpload">
        <div class="container">
            <i id="closeFileUploadSection" class="fas fa-times" style="font-size: 2rem; cursor: pointer; color: #dc3545; margin-bottom: 2rem;"></i> 
            <div id='sectionHeader' class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2 class="section-title" dir="rtl">העלאת קבצי XML מהמסלקה הפנסיונית</h2>
                
            </div>
            <div class="file-upload-container">
	
                <div class="file-upload-area" id="fileUploadArea">
                    <div class="upload-icon">
                        <i class="fas fa-file-code"></i>
                    </div>
                    <h3 dir="rtl">גרור ושחרר קבצי מסלקה כאן או לחץ לבחירה</h3>
                    <p dir="rtl">העלה את קבצי המסלקה מסוג XML</p>
                    <input type="file" id="fileInput" multiple accept=".xml" style="display: none;">
                    <button class="cta-button" id="selectFilesBtn" dir="rtl">בחר קבצי XML</button>
</div>
                <div class="uploaded-files" id="uploadedFiles" style="display: none;">
                    <div class="file-actions">
                        <button class="cta-button" id="processFiles" style="display: none;">קרא נתונים</button>
                        <button class="cta-button delete-btn" id="deleteFiles">🗑️ סגור תצוגה ומחק נתונים</button>
                        <button class="cta-button" id="advancedAnalysisBtnMain2" onclick="sessionStorage.removeItem('riskProfile'); sessionStorage.removeItem('riskScore'); sessionStorage.removeItem('riskSource'); window.location.href='advancedAnalysis.html';" 
                         disabled
                         style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                          color: white; border: none; padding: 15px 40px; border-radius: 25px;
                          font-size: 1.1rem; cursor: not-allowed; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                           transition: all 0.3s ease; max-width: 400px; width: 100%; opacity: 0.5;">📊 ניתוח מתקדם</button>
                    </div>
                    <h3 dir="rtl" id="uploadedFilesTitle">קבצים שהועלו - מיד יוצגו נתונים:</h3>
                    <div class="files-list" id="filesList"></div>  
                </div>
                
                <div class="file-data-display" id="fileDataDisplay" style="display: none;">
                    <h3 style="text-align:center;">נתונים מהקבצים:</h3>
                    <div class="data-content" id="dataContent"></div>
                </div>
                
                <!-- תצוגת נתונים יפה -->
                <div id="dataDisplayContainer">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h2 style="color: #333; font-size: 2.5rem; margin-bottom: 10px;">📊 סיכום הנתונים שלך</h2>
                        <p style="color: #666; font-size: 1.2rem;">כל המידע החשוב במקום אחד</p>
                    </div>
                    
                    <div class="data-grid-container">
                        <!-- פרטים אישיים -->
                        <div class="data-card">
                            <h3 style="text-align:center;color: #333; margin-bottom: 20px; font-size: 1.5rem; border-bottom: 3px solid #667eea; padding-bottom: 10px;">👤 פרטים אישיים</h3>
                            <div id="personalInfo" style="color: #555; line-height: 1.8;">
                                <!-- כאן יוצגו הפרטים האישיים -->
                            </div>
                        </div>
                        
                        <!-- גרף עוגה -->
                        <div class="data-card">
                            <h3 style="color: #333; margin-bottom: 20px; font-size: 1rem; border-bottom: 3px solid #667eea; padding-bottom: 10px;">🥧 חלוקת הצבירה לפי מוצרים</h3>
                            <canvas id="pieChart" style="max-height: 350px;"></canvas>
                        </div>
                    </div>
                    
                      <!-- טבלת סיכום מפורטת -->
                      <div class="data-card-table" style="background: rgba(255,255,255,0.95); padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                              <h3 style="color: #333; margin: 0; font-size: 1.5rem; border-bottom: 3px solid #667eea; padding-bottom: 10px; text-align: right;">📋 סיכום מפורט לפי מוצרים</h3>
                              <button type="button" class="tbl-button" id="closeDetailedTable" onclick="closeDetailedTableDisplay()">סגור</button>
                          </div>
                          <div id="detailedSummary" style="overflow-x: auto;">
                              <!-- כאן תוצג הטבלה המפורטת -->
                          </div>
                    </div>
                    
                    
                </div>
                
                <!-- תצוגת נתונים יפה -->
                <div id="dataDisplayContainer">
                    <div style="text-align: right; margin-bottom: 30px;">
                        <h2 style="color: white; font-size: 2.5rem; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">📊 סיכום הנתונים שלך</h2>
                        <p style="color: rgba(255,255,255,0.9); font-size: 1.2rem;">כל המידע החשוב במקום אחד</p>
                    </div>
                    
                    <div class="data-grid-container">
                        <!-- פרטים אישיים -->
                        <div class="data-card">
                            <h3 style="color: #333; margin-bottom: 20px; font-size: 1.5rem; border-bottom: 3px solid #667eea; padding-bottom: 10px;">👤 פרטים אישיים</h3>
                            <div id="personalInfo" dir="rtl" style="color: #555; line-height: 1.8;">
                                <!-- כאן יוצגו הפרטים האישיים -->
                            </div>
                        </div>
                        
                        <!-- גרף עוגה -->
                        <div dir="rtl" class="data-card">
                             <h3 style="color: #333; margin-bottom: 20px; font-size: 1.5rem; border-bottom: 3px solid #667eea; padding-bottom: 10px; text-align:center;">🥧 חלוקת הצבירה לפי מוצרים</h3>
                            <canvas id="pieChart" style="max-height: 300px;"></canvas>
                        </div>
                    </div>
                    
                    <!-- טבלת סיכום מפורטת -->
                    <div dir="rtl" class="data-card">
                        <h3 style="color: #333; margin-bottom: 20px; font-size: 1.5rem; border-bottom: 3px solid #667eea; padding-bottom: 10px;">📋 סיכום מפורט לפי מוצרים</h3>
                        <div dir="rtl" id="detailedSummary" style="overflow-x: auto;">
                            <!-- כאן תוצג הטבלה המפורטת -->
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px; display: flex; flex-direction: column; align-items: center; gap: 15px;"> 
                        <button class="cta-button" id="advancedAnalysisBtnMain2" onclick="sessionStorage.removeItem('riskProfile'); sessionStorage.removeItem('riskScore'); sessionStorage.removeItem('riskSource'); window.location.href='advancedAnalysis.html';" 
                         disabled
                         style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                          color: white; border: none; padding: 15px 40px; border-radius: 25px;
                          font-size: 1.1rem; cursor: not-allowed; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                           transition: all 0.3s ease; max-width: 400px; width: 100%; opacity: 0.5;">📊 ניתוח מתקדם</button>
                    </div>
                </div>
                
                <div class="chart-container" id="chartContainer" style="display: none;">
                    <h3>תצוגת גרף סכומי יתרות</h3>
                    <div class="chart-wrapper">
                        <canvas id="myDoughnutChart"></canvas>
                    </div>
                    <div id="customLegend" class="custom-legend">
                        <h3>מקרא:</h3>
                    </div>
                    <div class="chart-actions" style="display: flex; justify-content: center; gap: 0.5rem; margin-top: 2rem; flex-wrap: wrap; width: 100%;">
                        <button class="cta-button chart-action-btn" id="closeChartBtn" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4); padding: 10px 20px; font-size: 14px;">סגור</button>
                        <button class="cta-button chart-action-btn" id="advancedAnalysisBtn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); padding: 10px 20px; font-size: 14px;">ניתוח מתקדם</button>
                        <button class="cta-button chart-action-btn delete-btn" id="closeAndDeleteBtn" style="padding: 10px 20px; font-size: 14px;">סגור ומחק קבצים</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- טופס ייעוץ פנסיוני -->
   <!-- Advanced Analysis Section -->
   <section class="advanced-analysis-section" id="advancedAnalysis" style="display: none;">
    <div class="container">
        <h2 class="section-title" dir="rtl">ניתוח נתונים מתקדם</h2>
        
            <div class="analysis-tabs">
                <button class="tab-button active" data-tab="returns">השוואת תשואות</button>
                <button class="tab-button" data-tab="fees">דמי ניהול</button>
                <button class="tab-button" data-tab="liquidity">נזילות</button>
                <button class="tab-button" data-tab="pathways">מסלולי פנסיה</button>
                <button class="tab-button" data-tab="retirement">גיל פרישה</button>
                <button class="tab-button" data-tab="summary">סיכום כללי</button>
            </div>

        <div class="tab-content">
            <!-- Returns Comparison Tab -->
            <div class="tab-panel active" id="returns-tab">
                <h3>השוואת תשואות למתחרים</h3>
                <div class="analysis-grid">
                    <div class="analysis-card">
                        <h4>תשואות לפי מוצר</h4>
                        <div id="returnsChart" class="chart-container-small"></div>
                    </div>
                    <div class="analysis-card">
                        <h4>השוואה לממוצע השוק</h4>
                        <div id="marketComparison" class="comparison-table"></div>
                    </div>
                </div>
            </div>

            <!-- Management Fees Tab -->
            <div class="tab-panel" id="fees-tab">
                <h3>השוואת שיעורי דמי ניהול</h3>
                <div class="analysis-grid">
                    <div class="analysis-card">
                        <h4>דמי ניהול שנתיים</h4>
                        <div id="feesChart" class="chart-container-small"></div>
                    </div>
                    <div class="analysis-card">
                        <h4>השפעה על התשואה</h4>
                        <div id="feesImpact" class="impact-analysis"></div>
                    </div>
                </div>
            </div>

            <!-- Liquidity Analysis Tab -->
            <div class="tab-panel" id="liquidity-tab">
                <h3>בחינת כספים נזילים ולא נזילים</h3>
                <div class="analysis-grid">
                    <div class="analysis-card">
                        <h4>פילוח נזילות</h4>
                        <div id="liquidityChart" class="chart-container-small"></div>
                    </div>
                    <div class="analysis-card">
                        <h4>זמינות כספים</h4>
                        <div id="availabilityTable" class="availability-table"></div>
                    </div>
                </div>
            </div>

            <!-- Pension Pathways Tab -->
            <div class="tab-panel" id="pathways-tab">
                <h3>ניתוח מסלולי פנסיה</h3>
                <div class="analysis-grid">
                    <div class="analysis-card">
                        <h4>מסלולי השקעה</h4>
                        <div id="pathwaysChart" class="chart-container-small"></div>
                    </div>
                    <div class="analysis-card">
                        <h4>המלצות אופטימיזציה</h4>
                        <div id="optimizationRecommendations" class="recommendations"></div>
                    </div>
                </div>
            </div>

            <!-- Retirement Analysis Tab -->
            <div class="tab-panel" id="retirement-tab">
                <h3>ניתוח נתונים לגיל פרישה</h3>
                <div class="analysis-grid">
                    <div class="analysis-card">
                        <h4>צבירת כספים צפויה</h4>
                        <div id="retirementAccumulation" class="retirement-analysis">
                            <div style="text-align: right; padding: 2rem; color: #666;">
                                <i class="fas fa-spinner fa-spin"></i><br>
                                טוען נתונים...
                            </div>
                        </div>
                    </div>
                    <div class="analysis-card">
                        <h4>הקצבאות הצפויות</h4>
                        <div id="retirementPensions" class="retirement-analysis">
                            <div style="text-align: right; padding: 2rem; color: #666;">
                                <i class="fas fa-spinner fa-spin"></i><br>
                                טוען נתונים...
                            </div>
                        </div>
                    </div>
                    <div class="analysis-card">
                        <h4>חישוב גיל פרישה</h4>
                        <div id="retirementAgeCalculation" class="retirement-analysis">
                            <div style="text-align: right; padding: 2rem; color: #666;">
                                <i class="fas fa-spinner fa-spin"></i><br>
                                טוען נתונים...
                            </div>
                        </div>
                    </div>
                    <div class="analysis-card">
                        <h4>המלצות לפרישה</h4>
                        <div id="retirementRecommendations" class="retirement-analysis">
                            <div style="text-align: right; padding: 2rem; color: #666;">
                                <i class="fas fa-spinner fa-spin"></i><br>
                                טוען נתונים...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Summary Tab -->
            <div class="tab-panel" id="summary-tab">
                <h3>סיכום כללי והמלצות</h3>
                <div class="summary-grid">
                    <div class="summary-card">
                        <h4>ציון כללי</h4>
                        <div id="overallScore" class="score-display"></div>
                    </div>
                    <div class="summary-card">
                        <h4>המלצות עיקריות</h4>
                        <div id="mainRecommendations" class="recommendations-list"></div>
                    </div>
                    <div class="summary-card">
                        <h4>דוח מפורט</h4>
                        <button id="generateReport" class="cta-button">יצירת דוח PDF</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="analysis-actions">
            <button class="cta-button" id="backToUpload">חזרה להעלאת קבצים</button>
            <button class="cta-button" id="exportData">ייצוא נתונים</button>
        </div>
    </div>
</section>

    <section class="features" id="services">
        <div class="containerCards" style="margin: 0 25px;">
        <div class="choose-us-title">
            <h2 class="choose-us-title-text">הכלים והשירותים שלנו</h2>
        </div>
        <div class="flex-container-row feature-card-container" style="margin-bottom: 30px;">
           
                <div class="feature-card">
                    <div class="feature-icon"><img src="advicing.png" width="120" height="auto"/></div>
                    <h3 class="feature-title">יעוץ פנסיוני אישי ומקצועי</h3>
                    <p class="feature-description"> אני אבנה עבורך אסטרטגיה פנסיונית מותאמת למטרות ולמצב הכלכלי הייחודי שלך</p>
                    <a href="#consultation" class="cta-button smallfont" onclick="openConsultationForm()">קבל יעוץ</a>
                </div>
                <div class="feature-card">
                    <div class="feature-icon"><img src="tesuot.png" width="100" height="auto"/></div>
                    <h3 class="feature-title">ניתוח תשואות מתקדם</h3>
                    <p class="feature-description">בכלים של האתר תוכל לבצע ניתוחים  בצורה מקצועית וייחודית</p>
                    <div class="tools-dropdown">
                        <button class="cta-button" id="toolsDropdownBtn"  onclick="toggleToolsDropdown()">השתמש בכלים ▼</button>
                        <div class="dropdown-content" id="toolsDropdown">
                            <a href="hashMenahalot.html">השוואת חברות מנהלות</a>
                            <a href="hasifotMeshulav.html">מחולל חשיפות</a>
                            <a href="VirtualInvest.html">השוואת תיק משולב מסלולים</a>
                            <a href="#">ציון משקל תשואה לשארפ</a>
                        </div>
                    </div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon"><img src="manwithcomputure.png" width="100" height="auto"/></i></div>
                    <h3 class="feature-title">מחשבונים  מגוונים</h3>
                    <p class="feature-description">במחשבונים של האתר תוכל לחשב ערך עתידי, הפקדה נדרשת לסכום מטרה והחזרי הלוואה חודשיים</p>
                    <div class="calculator-dropdown">
                        <button class="cta-button" id="calculatorDropdownBtn" onclick="toggleCalculatorDropdown()">בחר מחשבון ▼</button>
                        <div class="dropdown-content" id="calculatorDropdown">
                            <a href="prisatMaanak.html">פריסת מענק פרישה</a>
                            <a href="ribitderibit.html">חישוב ערך עתידי</a>
                            <a href="loan.html">סימולטור הלוואה</a>
                            <a href="hafkada.html">מחשבון הפקדה לסכום מטרה</a>
                            <a href="hashDmeyNihul.html">השוואת דמי ניהול</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex-container-row feature-card-container" style="margin-bottom: 30px;">
                
                <div class="feature-card">
                    <div class="feature-icon"><img src="ofisikon.png" width="100" height="auto"/></div>
                    <h3 class="feature-title">התאמה  לאופי סיכון</h3>
                    <p class="feature-description">באמצעות שאלון סיכון קצר אוכל לאפיין את רמת הסיכון שלך ולבדוק את התאמת מסלולי ההשקעה שלך לרמת הסיכון.</p>
                    <a href="#" onclick="openRiskQuestModal(); return false;" class="cta-button smallfont">עבור לשאלון סיכון 🎯</a>
                </div>
                <div class="feature-card">
                    <div class="feature-icon"><img src="sherut.png" width="100" height="auto"/></div>
                    <h3 class="feature-title">ייעוץ פרישה</h3>
                    <p class="feature-description">תכנון פרישה נכון ימקסם את ההכנסות נטו שלך בתקופת הפנסיה תוך ניצול מקסימלי של הטבות המס</p>
                    <a href="#contact" class="cta-button smallfont" onclick="openConsultationForm()">צור קשר</a>
                </div>
                <div class="feature-card">
                    <div class="feature-icon"><img src="gemelorpolisa.png" width="100" height="auto"/></div>
                    <h3 class="feature-title">חסכון פרטי</h3>
                    <p class="feature-description"><span style="font-weight: bold;">קופת גמל להשקעה</span> או <span style="font-weight: bold;">פוליסת חסכון?</span> שתיהן מאפשרות להשקיע באופן פשוט, ליהנות מניהול מקצועי וממגוון מסלולי השקעה – אך יש ביניהן הבדלים מהותיים שכדאי להכיר.</p>
                    <a href="#contact" class="cta-button smallfont" onclick="openConsultationForm()">להשוואה</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Products Tables Section -->
    <section id="products" style="display: none; padding: 20px 0;">
        <div class="container" style="max-width: 1400px; margin: 0 auto;">
            <div id="allTheTables" class="allTheTables"></div>
        </div>
    </section>



<!-- Modal להשוואה -->
<div class="comparison-modal" id="comparisonModal">
	<div class="comparison-card">
		<h2>קופת גמל להשקעה או פוליסת חיסכון – במה לבחור?</h2>
		
		<p>
			עולם ההשקעות הפרטיות מציע שתי אפשרויות מרכזיות לחיסכון נזיל ולטווח ארוך:
			<strong>קופת גמל להשקעה</strong> ו־<strong>פוליסת חיסכון</strong>.
			שתיהן מאפשרות להשקיע באופן פשוט, ליהנות מניהול מקצועי וממגוון מסלולי השקעה – אך יש ביניהן הבדלים מהותיים שכדאי להכיר.
		</p>
		
		<h3>⚖️ קופת גמל להשקעה – חיסכון עם יתרון מס</h3>
		
		<h4>יתרונות</h4>
		<ul>
			<li><strong>פטור ממס על רווחים ריאליים בגיל פרישה:</strong> ניתן להמיר את הכסף לקצבה חודשית פטורה ממס.</li>
			<li><strong>ניתן לנייד בין גופים מוסדיים</strong> – ללא אירוע מס.</li>
			<li><strong>דמי ניהול נמוכים יותר מפוליסת חסכון</strong> – ניתן למשוך את הכסף בכל עת (מס בשיעור של 25% על הרווח הריאלי).</li>
		</ul>
		
		<h4>חסרונות</h4>
		<ul class="cons-list">
			<li><strong>תקרת הפקדה שנתית מוגבלת</strong> (כ - 81 אלף ש"ח לשנת 2025).</li>
		</ul>
		
		<h3>🏦 פוליסת חיסכון – ניהול ללא תקרת הפקדה</h3>
		
		<h4>יתרונות</h4>
		<ul>
			<li><strong>אין תקרת הפקדה:</strong> ניתן להשקיע כל סכום.</li>
		</ul>
		
		<h4>חסרונות</h4>
		<ul class="cons-list">
			<li><strong>אין פטור ממס בגיל פרישה.</strong></li>
			<li><strong>דמי ניהול לרוב גבוהים יותר</strong> מקופת גמל להשקעה.</li>
			<li><strong>לא ניתן לנייד בין חברות הביטוח.</strong></li>
		</ul>
		
		<div class="summary-box">
			<h3>🧭 אז מה מתאים לך?</h3>
			<p><strong>מחפש חיסכון לטווח ארוך עם יתרון מס בפרישה?</strong> → קופת גמל להשקעה.</p>
			<p><strong>רוצה להשקיע סכום גדול?</strong> → פוליסת חסכון או שילוב בין המוצרים.</p>
			<p style="margin-top: 1.5rem; font-style: italic; color: #667eea;">
				שתי האופציות חכמות – הבחירה הנכונה תלויה בצרכים ובסכום ההשקעה.
			</p>
		</div>
		
		<!-- טבלת 5 המסלולים המובילים -->
		<div class="top-performers-section">
			<h3>🏆 5 המסלולים המובילים בקופות גמל להשקעה</h3>
			<div id="topPerformersContainer">
				<div class="loading-spinner">
					<i class="fas fa-spinner fa-spin"></i>
					<p>טוען נתונים...</p>
				</div>
			</div>
		</div>
		
		<button class="close-comparison-btn" onclick="closeComparisonModal()">חזרה</button>
	</div>
</div>

 

    <section class="cta-section">
        <div class="container">
            <h2 dir="rtl" class="cta-title">מוכן להתחיל לתכנן את עתידך הפנסיוני?</h2>
            <p class="cta-subtitle">קבל יעוץ מקצועי ותתחיל לנהל את הכספים שלך בדרך הנכונה והרווחית</p>
            <a href="#consultation" class="cta-button-white" onclick="openConsultationForm()"> יעוץ אישי</a>
        </div>
    </section>	
	
<div class="logos">
        <div class="logos-slide">
    <img src="altshuler-logo.png" id="altshuler-logo" alt="Altshuler Logo">
    <img src="yalin-logo.png" class="yalin-logo" alt="Yalin Logo">
    <img src="migdal-logo.png" class="migdal-logo" alt="Migdal Logo">
    <img src="meitav-logo.png" class="meitav-logo" alt="Meitav Logo">
    <img src="menora-logo.png" class="menora-logo" alt="Menora Logo">
    <img src="mor-logo.png" class="mor-logo" alt="Mor Logo">
    <img src="clal-logo.png" class="clal-logo" alt="Clal Logo">
    <img src="fenix-logo.png" class="fenix-logo" alt="Fenix Logo">
    <img src="analist-logo.png" class="analist-logo" alt="Analist Logo">
    <img src="ayalon-logo.png" class="ayalon-logo" alt="Ayalon Logo">
    <img src="hachshara-logo.png" class="hachshara-logo" alt="Hachshara Logo">
    <img src="harel-logo.png" class="harel-logo" alt="Harel Logo">

    <!-- Duplicate logos for seamless scrolling -->
    <img src="altshuler-logo.png" class="altshuler-logo" alt="Altshuler Logo">
    <img src="yalin-logo.png" class="yalin-logo" alt="Yalin Logo">
    <img src="migdal-logo.png" class="migdal-logo" alt="Migdal Logo">
    <img src="meitav-logo.png" class="meitav-logo" alt="Meitav Logo">
    <img src="menora-logo.png" class="menora-logo" alt="Menora Logo">
    <img src="mor-logo.png" class="mor-logo" alt="Mor Logo">
    <img src="clal-logo.png" class="clal-logo" alt="Clal Logo">
    <img src="fenix-logo.png" class="fenix-logo" alt="Fenix Logo">
    <img src="analist-logo.png" class="analist-logo" alt="Analist Logo">
    <img src="ayalon-logo.png" class="ayalon-logo" alt="Ayalon Logo">
    <img src="hachshara-logo.png" class="hachshara-logo" alt="Hachshara Logo">
    <img src="harel-logo.png" class="harel-logo" alt="Harel Logo">
</div>

    </div>

<script>
    // משתנים לניתוח מתקדם - נשמרים רק ב-sessionStorage
    var alreadyShown;
        function letStart(){
            if(window.innerWidth>768){
                document.getElementById('fileUpload').style.display = 'flex';   
            }else{
                document.getElementById('fileUpload').style.display = 'block';
            }
            
            document.getElementById('fileUploadArea').style.display = 'block';
            document.getElementById('sectionHeader').style.display = 'flex';    
        }

        // Function to show product tables
        async function showProductTables(productType) {
            // Hide other sections
            const productsSection = document.getElementById('products');
            if (!productsSection) return;
            
            // Show products section
            productsSection.style.display = 'block';
            
            // Scroll to products section
            productsSection.scrollIntoView({ behavior: 'smooth' });
            
            // Map product type to internal name and call appropriate function
            const productMap = {
                'קרנות השתלמות': 'קרנות השתלמות',
                'קופות גמל': 'תגמולים ואישית לפיצויים',
                'קופות גמל להשקעה': 'קופת גמל להשקעה',
                'חסכון לילד': 'קופת גמל להשקעה - חסכון לילד',
                'פוליסות חסכון': 'פוליסות חסכון',
                'קרנות פנסיה חדשות': 'קרנות חדשות'
            };
            
            const internalName = productMap[productType];
            
            if (productType === 'קרנות פנסיה חדשות') {
                // Call pension function
                if (typeof maslulimP === 'function') {
                    await maslulimP(1, internalName, 0);
                }
            } else {
                // Call regular products function
                if (typeof maslulim === 'function') {
                    await maslulim(1, internalName, 0);
                }
            }
            
            // Close mobile menu if open
            const navMenu = document.getElementById('navMenu');
            const hamburger = document.getElementById('hamburger');
            if (navMenu && hamburger) {
                navMenu.classList.remove('active');
                hamburger.classList.remove('active');
            }
        }

        // פונקציה לפתיחה/סגירה של הרשימה הנפתחת בתפריט הניווט
        function toggleNavProductsDropdown(event) {
            event.preventDefault();
            event.stopPropagation();
            if (window.innerWidth > 768) {return;}
            const dropdown = document.getElementById('navProductsDropdown');
            const link = event.target;
            
            // Close other dropdowns and reset their text
            document.querySelectorAll('.dropdown-content.show').forEach(d => {
                if (d !== dropdown) {
                    d.classList.remove('show');
                    const parentLi = d.closest('.nav-dropdown');
                    const parentLink = parentLi?.querySelector('a');
                    if (parentLink) {
                        if (d.id === 'navCalculatorDropdown') {
                            parentLink.innerHTML = 'מחשבונים ▼';
                        } else if (d.id === 'navToolsDropdown') {
                            parentLink.innerHTML = 'כלי השוואה ▼';
                        }
                    }
                }
            });
            
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
                link.innerHTML = 'מוצרים ותשואות ▼';
            } else {
                dropdown.classList.add('show');
                link.innerHTML = 'מוצרים ותשואות ▲';
            }
            
            return false;
        }

        function toggleNavCalculatorDropdown(event) {
            event.preventDefault();
            event.stopPropagation();
            if (window.innerWidth > 768) {return;}
            const dropdown = document.getElementById('navCalculatorDropdown');
            const link = event.target;
            
            // Close other dropdowns and reset their text
            document.querySelectorAll('.dropdown-content.show').forEach(d => {
                if (d !== dropdown) {
                    d.classList.remove('show');
                    const parentLi = d.closest('.nav-dropdown');
                    const parentLink = parentLi?.querySelector('a');
                    if (parentLink) {
                        if (d.id === 'navProductsDropdown') {
                            parentLink.innerHTML = 'מוצרים ותשואות ▼';
                        } else if (d.id === 'navToolsDropdown') {
                            parentLink.innerHTML = 'כלי השוואה ▼';
                        }
                    }
                }
            });
            
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
                link.innerHTML = 'מחשבונים ▼';
            } else {
                dropdown.classList.add('show');
                link.innerHTML = 'מחשבונים ▲';
            }
            
            // Prevent any default behavior
            return false;
        }
        
        // פונקציה לפתיחה/סגירה של הרשימה הנפתחת בתפריט הניווט - כלי השוואה
        function toggleNavToolsDropdown(event) {
            event.preventDefault();
            event.stopPropagation();
            if (window.innerWidth > 768) {return;}
            const dropdown = document.getElementById('navToolsDropdown');
            const link = event.target;
            
            // Close other dropdowns and reset their text
            document.querySelectorAll('.dropdown-content.show').forEach(d => {
                if (d !== dropdown) {
                    d.classList.remove('show');
                    const parentLi = d.closest('.nav-dropdown');
                    const parentLink = parentLi?.querySelector('a');
                    if (parentLink) {
                        if (d.id === 'navProductsDropdown') {
                            parentLink.innerHTML = 'מוצרים ותשואות ▼';
                        } else if (d.id === 'navCalculatorDropdown') {
                            parentLink.innerHTML = 'מחשבונים ▼';
                        }
                    }
                }
            });
            
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
                link.innerHTML = 'כלי השוואה ▼';
            } else {
                dropdown.classList.add('show');
                link.innerHTML = 'כלי השוואה ▲';
            }
            
            return false;
        }

        // פונקציה לפתיחה/סגירה של הרשימה הנפתחת
        function toggleCalculatorDropdown() {
            const dropdown = document.getElementById('calculatorDropdown');
            const button = document.getElementById('calculatorDropdownBtn');
            
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
                button.classList.remove('active');
                button.innerHTML = 'בחר מחשבון ▼';
            } else {
                dropdown.classList.add('show');
                button.classList.add('active');
                button.innerHTML = 'בחר מחשבון ▲';
            }
        }

        // סגירת הרשימה הנפתחת כשלוחצים מחוץ לה
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('calculatorDropdown');
            const button = document.getElementById('calculatorDropdownBtn');
            
            if (!dropdown.contains(event.target) && !button.contains(event.target)) {
                dropdown.classList.remove('show');
                button.classList.remove('active');
                button.innerHTML = 'בחר מחשבון ▼';
            }
            
            // Close nav dropdowns when clicking outside
            document.querySelectorAll('.dropdown-content.show').forEach(d => {
                if (!d.contains(event.target)) {
                    const parentLi = d.closest('.nav-dropdown');
                    const parentLink = parentLi?.querySelector('a');
                    if (parentLink && !parentLink.contains(event.target)) {
                        d.classList.remove('show');
                        if (d.id === 'navProductsDropdown') {
                            parentLink.innerHTML = 'מוצרים ותשואות ▼';
                        } else if (d.id === 'navCalculatorDropdown') {
                            parentLink.innerHTML = 'מחשבונים ▼';
                        } else if (d.id === 'navToolsDropdown') {
                            parentLink.innerHTML = 'כלי השוואה ▼';
                        }
                    }
                }
            });
        });

        // סגירת הרשימה הנפתחת כשלוחצים על קישור
        document.addEventListener('click', function(event) {
            if (event.target.closest('.dropdown-content a')) {
                const dropdown = document.getElementById('calculatorDropdown');
                const button = document.getElementById('calculatorDropdownBtn');
                
                dropdown.classList.remove('show');
                button.classList.remove('active');
                button.innerHTML = 'בחר מחשבון ▼';
            }
            
            // Close nav dropdown when clicking on links
            if (event.target.closest('#navCalculatorDropdown a')) {
                const navDropdown = document.getElementById('navCalculatorDropdown');
                const navLink = navDropdown.closest('.nav-dropdown')?.querySelector('a');
                
                if (navDropdown) navDropdown.classList.remove('show');
                if (navLink) navLink.innerHTML = 'מחשבונים ▼';
            }
            
            // Close other nav dropdowns when clicking on their links
            if (event.target.closest('#navProductsDropdown a')) {
                const navDropdown = document.getElementById('navProductsDropdown');
                const navLink = navDropdown.closest('.nav-dropdown')?.querySelector('a');
                
                if (navDropdown) navDropdown.classList.remove('show');
                if (navLink) navLink.innerHTML = 'מוצרים ותשואות ▼';
            }
            
            if (event.target.closest('#navToolsDropdown a')) {
                const navDropdown = document.getElementById('navToolsDropdown');
                const navLink = navDropdown.closest('.nav-dropdown')?.querySelector('a');
                
                if (navDropdown) navDropdown.classList.remove('show');
                if (navLink) navLink.innerHTML = 'כלי השוואה ▼';
            }
        });

        // Ensure nav dropdown links work properly
        document.querySelectorAll('#navCalculatorDropdown a').forEach(link => {
            link.addEventListener('click', function(e) {
                // Don't prevent default - let the link work normally
                e.stopPropagation();
                
                // Close dropdown after a short delay to allow navigation
                setTimeout(() => {
                    const dropdown = document.getElementById('navCalculatorDropdown');
                    const dropdownLink = dropdown?.closest('.nav-dropdown')?.querySelector('a');
                    
                    if (dropdown) {
                        dropdown.classList.remove('show');
                    }
                    if (dropdownLink) {
                        dropdownLink.innerHTML = 'מחשבונים ▼';
                    }
                }, 100);
            });
        });
        
        

        // פונקציה לפתיחה/סגירה של רשימת הכלים
        function toggleToolsDropdown() {
            const dropdown = document.getElementById('toolsDropdown');
            const button = document.getElementById('toolsDropdownBtn');
            
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
                button.classList.remove('active');
                button.innerHTML = 'השתמש בכלים ▼';
            } else {
                dropdown.classList.add('show');
                button.classList.add('active');
                button.innerHTML = 'השתמש בכלים ▲';
            }
        }

        // סגירת רשימת הכלים כשלוחצים מחוץ לה
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('toolsDropdown');
            const button = document.getElementById('toolsDropdownBtn');
            
            if (!dropdown.contains(event.target) && !button.contains(event.target)) {
                dropdown.classList.remove('show');
                button.classList.remove('active');
                button.innerHTML = 'השתמש בכלים ▼';
            }
        });

        // סגירת רשימת הכלים כשלוחצים על קישור
        document.addEventListener('click', function(event) {
            if (event.target.closest('.tools-dropdown .dropdown-content a')) {
                const dropdown = document.getElementById('toolsDropdown');
                const button = document.getElementById('toolsDropdownBtn');
                
                dropdown.classList.remove('show');
                button.classList.remove('active');
                button.innerHTML = 'השתמש בכלים ▼';
            }
        });
        // וידוא שהדף תמיד מתחיל בחלק העליון
        window.addEventListener('load', function() {
            window.scrollTo(0, 0);
        });
        
        window.addEventListener('beforeunload', function() {
            window.scrollTo(0, 0);
        });
        
        // וידוא שהדף תמיד בחלק העליון כשמרעננים
        if (window.history.scrollRestoration) {
            window.history.scrollRestoration = 'manual';
        }
        let sumSugMutzar = {
                    '1': [0, 0,0,0,0], '2': [0, 0,0,0,0], '2_1': [0, 0,0,0,0], '2_2': [0, 0,0,0,0], '3': [0, 0,0,0,0],
                    '4': [0, 0,0,0,0], '5': [0, 0,0,0,0], '6': [0, 0,0,0,0], '7': [0, 0,0,0,0], '8': [0, 0,0,0,0],
                    '9': [0, 0,0,0,0], '10': [0, 0,0,0,0]
                };
        
        let taarichLeyda = '';let DataAll=[];  
        let kodMaslulSet = new Set();let yitrotKaspeyPizoyim=[];
        let pratimIshim;let yitrotLefiMutzar;let yitrotLeGilPrisha;
        let masluleiHashkaa=[];let sheabudIkulHalvaa=[];let pirteiHeshbon=[];
        // Mobile menu toggle
        const hamburger = document.getElementById('hamburger');
        const navMenu = document.getElementById('navMenu');

        hamburger.addEventListener('click', () => {
            hamburger.classList.toggle('active');
            navMenu.classList.toggle('active');
        });

        // Close menu when clicking on a link
        navMenu.addEventListener('click', (e) => {
            if (e.target.tagName === 'A') {
                hamburger.classList.remove('active');
                navMenu.classList.remove('active');
            }
        });

        // File Upload Functionality
        let uploadedFiles = [];
        let myChart = null;
        let dataMislaka = null;
        
        // Product type descriptions
        const sugTochnitOHeshbon = {
            '1': 'פוליסת ביטוח חיים משולב חיסכון',
            '2': 'קרן פנסיה',
            '2_1': 'קרן פנסיה ותיקה',
            '2_2': 'קרן פנסיה חדשה',
            '3': 'קופת גמל',
            '4': 'קרן השתלמות',
            '5': 'פוליסת חיסכון טהור',
            '6': 'פוליסת סיכון טהור (ריסק מוות ו/או פוליסת אכ"ע SA)',
            '7': 'ביטוח חיים משכנתא',
            '8': 'פוליסת סיכון טהור קולקטיב',
            '9': 'קופת גמל להשקעה',
            '10': 'חיסכון לכל ילד'
        };
        
        const chartColors = ['#F37253','#0A2540','#4CAF50','#2196F3','#FFC107','#9C27B0','#FF5722','#607D8B','#795548','#E91E63'];
        
        // Chart.js plugin for center text
        const totalAmountPlugin = {
            id: 'totalAmountPlugin',
            beforeDraw(chart) {
                if (chart.config.options.plugins && chart.config.options.plugins.centerText) {
                    const ctx = chart.ctx;
                    const centerConfig = chart.config.options.plugins.centerText;
                    const txt = centerConfig.text;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.font = `bold 30px ${centerConfig.fontStyle || 'Arial'}`;
                    ctx.fillStyle = centerConfig.color || '#000';
                    ctx.fillText(txt, (chart.chartArea.left + chart.chartArea.right)/2, (chart.chartArea.top + chart.chartArea.bottom)/2);
                }
            }
        };
        Chart.register(totalAmountPlugin);
        
        const fileInput = document.getElementById('fileInput');
        const fileUploadArea = document.getElementById('fileUploadArea');
        const fileUpload = document.getElementById('fileUpload');
        const selectFilesBtn = document.getElementById('selectFilesBtn');
        const uploadedFilesDiv = document.getElementById('uploadedFiles');
        const filesList = document.getElementById('filesList');
        const processFilesBtn = document.getElementById('processFiles');
        const deleteFilesBtn = document.getElementById('deleteFiles');
        const fileDataDisplay = document.getElementById('fileDataDisplay');
        const dataContent = document.getElementById('dataContent');
        const closeChartBtn = document.getElementById('closeChartBtn');
        const closeAndDeleteBtn = document.getElementById('closeAndDeleteBtn');
        const advancedAnalysisBtn = document.getElementById('advancedAnalysisBtn');
        const backToUploadBtn = document.getElementById('backToUpload');
        const exportDataBtn = document.getElementById('exportData');
        const generateReportBtn = document.getElementById('generateReport');
        const closeFileUploadSectionBtn = document.getElementById('closeFileUploadSection');

        function cleanVal(val, def = null) {
            if (val === undefined || val === null || typeof val === 'object') return def;
            return val;
        }

        // הופך ערך ל-array תמיד (undefined/null → [], אובייקט יחיד → [obj], מערך → 그대로)
        function toArray(val) {
            if (!val) return [];
            return Array.isArray(val) ? val : [val];
        }

        function getElementText(parent, tag) {
            let isNil
            const el = parent?.getElementsByTagName?.(tag)?.[0];
            if (!el) return null;
            isNil = el.getAttribute?.('xsi:nil') === 'true';
             if (isNil) return null;
            //  אם יש צורך להחזיר ערך מיוחד עבור אלמנטים עם xsi
            let pnil={
                2:'p2:nil',
                3:'p3:nil', 
                4:'p4:nil',
                5:'p5:nil',
                6:'p6:nil',
                7:'p7:nil', 
                8:'p8:nil'
            }
            for(const k in pnil){
                 if(el.getAttribute?.(pnil[k])==='true') return null;
            }
            return (el.textContent ?? '').trim() || null;
        }

        // חיתוך תאריך מהכותרת בפורמט YYYYMMDD
        function sliceDate8(v) {
            const s = cleanVal(v, null);
            if (!s) return null;
            return String(s).slice(6, 8)+"/"+String(s).slice(4, 6)+"/"+String(s).slice(0, 4);
        }

        // שמירת 9 הספרות האחרונות של ת"ז/מזהה לקוח
        function last9Digits(v) {
            const s = cleanVal(v, null);
            if (!s) return null;
            const onlyDigits = String(s).replace(/\D+/g, '');
            if (!onlyDigits) return null;
            return onlyDigits.slice(-9);
        }
        function num(val) {
            if (val == null || val === '') return null;
            const n = Number(val);
            return Number.isFinite(n) ? n : val;
        }
        function parseDateYYYYMMDD(val) {
            if (!val || String(val).length < 8) return val ?? null;
            const s = String(val);
            return `${s.slice(6,8)}/${s.slice(4,6)}/${s.slice(0,4)}`;
        }

        // Drag and drop functionality
        fileUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploadArea.classList.add('dragover');
        });

        fileUploadArea.addEventListener('dragleave', () => {
            fileUploadArea.classList.remove('dragover');
        });

        fileUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploadArea.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        // העלאת קבצים
        fileUploadArea.addEventListener('click', (e) => {
            // Prevent double triggering
            if (e.target === fileUploadArea || e.target.closest('.file-upload-area')) {
                fileInput.click();
            }
        });

        // טיפול בקבצים שהועלו
        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        // Button click handler
        selectFilesBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            fileInput.click();
            
        });

         // שמירת הקבצים ב אוסף uploadedFiles
        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (isValidFile(file)) {
                    uploadedFiles.push(file);
                }
            });
            displayUploadedFiles();
            if(uploadedFiles.length > 0) {
            setTimeout(() => {
                    processFilesBtn.click();
                }, 3500);
            }
        }

        function isValidFile(file) {
            const validTypes = [
                'text/xml',
                'application/xml',
                'application/xml-external-parsed-entity'
            ];
            return validTypes.includes(file.type) || 
                   file.name.toLowerCase().endsWith('.xml');
        }

        function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = reject;
                reader.readAsText(file);
            });
        }

    // הצגת הקבצים שהועלו   
        function displayUploadedFiles() {
            if (uploadedFiles.length === 0) {
                uploadedFilesDiv.style.display = 'none';
                fileUploadArea.style.display = 'block';
                return;
            }

            uploadedFilesDiv.style.display = 'block';
            fileUploadArea.style.display = 'none';
            filesList.innerHTML = '';
            let gemelFiles =0;let pensiaHfiles =0;let pensiaVfiles =0;let bituachfiles=0;
                const fileItem = document.createElement('div');
            const fileIcon = getFileIcon(uploadedFiles[0].type);
                fileItem.className = 'file-item';
            uploadedFiles.forEach((file, index) => {
                if(file.name.includes('KGM')){gemelFiles++;}
                if(file.name.includes('PNN')){pensiaHfiles++;}
                if(file.name.includes('PNO')){pensiaVfiles++;}
                if(file.name.includes('ING') || file.name.includes('INP') || file.name.includes('INK')
            || file.name.includes('INM')){bituachfiles++;}
            });

            let parts = [];

            if (gemelFiles > 0) parts.push(`${gemelFiles} קבצי גמל`);
            if (pensiaHfiles > 0) parts.push(`${pensiaHfiles} קבצי פנסיה חדשה`);
            if (pensiaVfiles > 0) parts.push(`${pensiaVfiles} קבצי פנסיה ותיקה`);
            if (bituachfiles > 0) parts.push(`${bituachfiles} קבצי ביטוח`);

            const fileSentence = "הועלו " + parts.join(", ");
                fileItem.innerHTML = `
                    <div dir="rtl" class="file-info" style="text-align: right;">
                        <i class="file-icon ${fileIcon}"></i>
                        <div style="display:flex;justify-content:right;">
                            <div class="file-name" >${fileSentence}</div>
                        </div>
                    </div>
                `;
                filesList.appendChild(fileItem);

        }

        function getFileIcon(fileType) {
            if (fileType.includes('xml')) {
                return 'fas fa-file-code';
            } else {
                return 'fas fa-file';
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Process files button
        processFilesBtn.addEventListener('click', async () => {
            uploadedFilesTitle.style.display = 'none';
            filesList.style.display = 'none';
            if (uploadedFiles.length === 0) return;    
           
            fileDataDisplay.style.display = 'none';
            try {
                const groupedSums = {};
                let overallTotalSum = 0;
                let shemPrati = '';
                let shemMishpacha = '';
                let misparCellulari = '';
                let eMail = '';
                let misparZihuyLakoach = '';
                let taarichNechnut = '';
                let gilPrishaValue = '';
                let gil = '';
                
                let sumSugMutzarGilPrishaTzafuy = {};
                let sumSugMutzarGilPrishaLeloPremiyot = {};
                let kitzvaSugMutzarGilPrishaTzafuy = {};
                let kitzvaSugMutzarGilPrishaLeloPremiyot = {};
                
                for (const file of uploadedFiles) {
                    const xmlString = await readFileAsText(file);
                    const result = new DOMParser().parseFromString(xmlString, "text/xml");
                    let pensiaVatikaOHadasha = '';
                    
                    try {
                        // Helper function to get element text content
                        //const getElementText = (parent, tagName) => {
                       //     const element = parent.getElementsByTagName(tagName)[0];
                       //     return element ? element.textContent.trim() : '';
                       // };

                        const mimshak = result.getElementsByTagName('Mimshak')[0];
                        if (!mimshak) {
                            throw new Error('לא נמצא אלמנט Mimshak בקובץ XML');
                        }
                        const yeshutYatzran = mimshak.getElementsByTagName('YeshutYatzran')[0];
                        if (!yeshutYatzran) {
                                throw new Error('לא נמצא אלמנט YeshutYatzran בקובץ XML');
                        }
                        const mutzarim = yeshutYatzran.getElementsByTagName('Mutzarim')[0];
                        const mutzar = mutzarim ? mutzarim.getElementsByTagName('Mutzar')[0] : null;
                        if (!mutzar) {
                            console.warn('לא נמצאו נתוני מוצר בקובץ זה—דילוג.');
                            await connection.commit();
                            return;
                        }
                        const netuneiMutzar = mutzar.getElementsByTagName('NetuneiMutzar')[0];
                        const sugMutzar = cleanVal(getElementText(netuneiMutzar, 'SUG-MUTZAR'));
                        const yeshutLakoach = netuneiMutzar ? netuneiMutzar.getElementsByTagName('YeshutLakoach')[0] : null;
                    
                        /*פרטים אישיים*/
                        if(shemPrati===''){shemPrati = cleanVal(yeshutLakoach ? getElementText(yeshutLakoach, 'SHEM-PRATI') : '')};
                        if(shemMishpacha===''){shemMishpacha = cleanVal(yeshutLakoach ? getElementText(yeshutLakoach, 'SHEM-MISHPACHA') : '')};
                        if(misparCellulari===''){misparCellulari = cleanVal(yeshutLakoach ? getElementText(yeshutLakoach, 'MISPAR-CELLULARI') : '') || ''};
                        if(eMail===''){eMail = cleanVal(yeshutLakoach ? getElementText(yeshutLakoach, 'E-MAIL') : '') || ''};
                        if(misparZihuyLakoach===''){ misparZihuyLakoach = last9Digits(yeshutLakoach ? getElementText(yeshutLakoach, 'MISPAR-ZIHUY-LAKOACH') : '')};
                        if(taarichLeyda===''){ taarichLeyda = cleanVal(yeshutLakoach ? getElementText(yeshutLakoach, 'TAARICH-LEYDA') : '');
                            const birthYear = parseInt(taarichLeyda.slice(0,4));
                            const currentYear = new Date().getFullYear();
                            gil = currentYear - birthYear;
                            
                            // שמירה ב-sessionStorage לשימוש בעמוד הניתוח המתקדם
                            sessionStorage.setItem('gilForAdvancedAnalysis', gil);
                            sessionStorage.setItem('ageToRetirementForAdvancedAnalysis', 67-Number(gil));
                        };
                        
                        pratimIshim={shemPrati,shemMishpacha,misparCellulari,eMail,misparZihuyLakoach,taarichLeyda,gil};
                       
                        /*יתרות מוצרים*/
                        const heshbonotOPolisot = mutzar.getElementsByTagName('HeshbonotOPolisot')[0];
                        const heshbonotElements = heshbonotOPolisot ? heshbonotOPolisot.getElementsByTagName('HeshbonOPolisa') : [];
                        const heshbonot = Array.from(heshbonotElements);
                        for (const heshbon of heshbonot) {
                            let mekademGilPrishaTzafuy = '';
                            if(taarichNechnut==='') {taarichNechnut = sliceDate8(cleanVal(getElementText(heshbon, 'TAARICH-NECHONUT')))};
                            if(sugMutzar==='2') {pensiaVatikaOHadasha = cleanVal(getElementText(heshbon, 'PENSIA-VATIKA-O-HADASHA'))};
                            
                            const taarichHitztarfutMutzar = cleanVal(getElementText(heshbon, 'TAARICH-HITZTARFUT-MUTZAR'));
                            const maslulBituach = heshbon.getElementsByTagName('MaslulBituach')[0];
                            const shemMaslulHabituah = cleanVal(maslulBituach ? getElementText(maslulBituach, 'SHEM-MASLUL-HABITUAH') : '') || '';

                            const prtTakzivElements = heshbon.getElementsByTagName('PirteiTaktziv');
                            const prtTakziv = Array.from(prtTakzivElements);
                            for (const p of prtTakziv) {
                                const blockItrot = p.getElementsByTagName('BlockItrot')[0];
                                const yitrotElement = blockItrot ? blockItrot.getElementsByTagName('Yitrot')[0] : null;
                                const perutYitrotElements = yitrotElement ? yitrotElement.getElementsByTagName('PerutYitrot') : [];
                                const yitrot = Array.from(perutYitrotElements);
                                for (const yitra of yitrot) {
                                    const totalChisachonMtzbr = cleanVal(getElementText(yitra, 'TOTAL-CHISACHON-MTZBR')) || 0;
                                    const totalErkeiPidion = cleanVal(getElementText(yitra, 'TOTAL-ERKEI-PIDION')) || 0;
                                    if(sugMutzar!=='2'){
                                        sumSugMutzar[sugMutzar][0] = (sumSugMutzar[sugMutzar][0] || 0) + parseFloat(totalErkeiPidion);    
                                        // סכומים נשמרים רק ב-sessionStorage בסוף התהליך
                                    }
                                    else{
                                        if(pensiaVatikaOHadasha==='1'){
                                            sumSugMutzar[sugMutzar+'_1'][0] = (sumSugMutzar[sugMutzar+'_1'][0] || 0) + parseFloat(totalErkeiPidion);    
                                        }
                                        else{
                                            sumSugMutzar[sugMutzar+'_2'][0] = (sumSugMutzar[sugMutzar+'_2'][0] || 0) + parseFloat(totalErkeiPidion);    
                                        }

                                    }
                                }
                               
                            }
                          
                            /*יתרות לגיל פרישה*/
                            if(sugMutzar==='1' || (sugMutzar==='2' && pensiaVatikaOHadasha==='2')) {
                                const yitraLefiGilPrisha = heshbon.getElementsByTagName('YitraLefiGilPrisha')[0];
                                if(yitraLefiGilPrisha) {
                                    const kupot = yitraLefiGilPrisha.getElementsByTagName('Kupot')[0];
                                    const kupa = kupot ? kupot.getElementsByTagName('Kupa')[0] : null;
                                    
                                    const tzviratLeloPremiyot = parseFloat(cleanVal(getElementText(yitraLefiGilPrisha, 'TZVIRAT-CHISACHON-CHAZUYA-LELO-PREMIYOT')) || 0);
                                    const totalMitztaberTzafuy = parseFloat(cleanVal(getElementText(yitraLefiGilPrisha, 'TOTAL-CHISACHON-MITZTABER-TZAFUY')) || 0);
                                    const kitzvaTzfuya = parseFloat(cleanVal(getElementText(yitraLefiGilPrisha, 'KITZVAT-HODSHIT-TZFUYA')) || 0);
                                    const schumKitzvat = parseFloat(cleanVal(kupa ? getElementText(kupa, 'SCHUM-KITZVAT-ZIKNA') : '') || 0);
                                    const gilPrisha = cleanVal(getElementText(yitraLefiGilPrisha, 'GIL-PRISHA')) || '';
                                    mekademGilPrishaTzafuy=cleanVal(getElementText(yitraLefiGilPrisha, 'MEKADEM-MOVTACH-LEPRISHA')) || '';
                                    // הוספת הערכים לאובייקטים המתאימים
                                    const mutzarKey = sugMutzar === '2' ? sugMutzar + '_' + pensiaVatikaOHadasha : sugMutzar;
                                    sumSugMutzar[mutzarKey][1] = sumSugMutzar[mutzarKey][1] + tzviratLeloPremiyot;
                                    sumSugMutzar[mutzarKey][2] = sumSugMutzar[mutzarKey][2] + totalMitztaberTzafuy;
                                    sumSugMutzar[mutzarKey][3] = sumSugMutzar[mutzarKey][3] + kitzvaTzfuya;
                                    sumSugMutzar[mutzarKey][4] = sumSugMutzar[mutzarKey][4] + schumKitzvat;
                                    
                                    if(!gilPrishaValue && gilPrisha) {
                                        gilPrishaValue = gilPrisha;
                                    }
                                }
                            }
                            
                            /*פירוט חשבונות ברמת החשבון*/
                            let shemMaasik='';

                            var maasikimSet = new Set();
                            const shemYatzran = getElementText(yeshutYatzran, 'SHEM-YATZRAN');
                            const yeshutMaasikElements = netuneiMutzar ? netuneiMutzar.getElementsByTagName('YeshutMaasik') : [];
                            const yeshutMaasikArray = Array.from(yeshutMaasikElements);
                            for (const yeshutMaasik of yeshutMaasikArray) { 
                                const mprMaasikBeYatzran = cleanVal(getElementText(yeshutMaasik, 'MPR-MAASIK-BE-YATZRAN'));
                                const shemMaasik = cleanVal(getElementText(yeshutMaasik, 'SHEM-MAASIK')) || 'לא ידוע';
                                const misparMezaheMaasik = cleanVal(getElementText(yeshutMaasik, 'MISPAR-MEZAHE-MAASIK')) || '';
                                const sugMezaheMaasik = cleanVal(getElementText(yeshutMaasik, 'SUG-MEZAHE-MAASIK')) || ''; 
                            
                                maasikimSet.add(`${sugMezaheMaasik}-${misparMezaheMaasik}-${mprMaasikBeYatzran}-${shemMaasik}`)   
                            }
                    
                            const misparPolisaOHeshbon = cleanVal(getElementText(heshbon, 'MISPAR-POLISA-O-HESHBON'), 0);
                            const shemTochnit = cleanVal(getElementText(heshbon, 'SHEM-TOCHNIT'));
                            const tsua = heshbon.getElementsByTagName('Tsua')[0];
                            const sheurTesuaNetoH = cleanVal(tsua ? getElementText(tsua, 'SHEUR-TSUA-NETO') : '', '');

                            const perutShiabudIkul = heshbon.getElementsByTagName('PerutShiabudIkul')[0];
                            const hutalSHiabud = cleanVal(perutShiabudIkul ? getElementText(perutShiabudIkul, 'HUTAL-SHIABUD') : '');
                            const hutalIkul = cleanVal(perutShiabudIkul ? getElementText(perutShiabudIkul, 'HUTAL-IKUL') : '');
                            
                            const halvaa = heshbon.getElementsByTagName('Halvaa')[0];
                            const yeshHalvaaBamutzar = cleanVal(halvaa ? getElementText(halvaa, 'YESH-HALVAA-BAMUTZAR') : '');
                            
                            const pirteyTvia = heshbon.getElementsByTagName('PirteyTvia')[0];
                            const yeshTvia = cleanVal(pirteyTvia ? getElementText(pirteyTvia, 'YESH-TVIA') : '');
                            sheabudIkulHalvaa.push({
                                sugMutzar:sugMutzar,
                                pensiaVatikaOHadasha:pensiaVatikaOHadasha,
                                misparPolisaOHeshbon:misparPolisaOHeshbon,
                                hutalSHiabud:hutalSHiabud,
                                hutalIkul:hutalIkul,
                                yeshHalvaaBamutzar:yeshHalvaaBamutzar,
                                yeshTvia:yeshTvia
                            });
                            

                            for (const p of prtTakziv) {
                                const blockItrot = p.getElementsByTagName('BlockItrot')[0];
                                const yitrotElement = blockItrot ? blockItrot.getElementsByTagName('Yitrot')[0] : null;
                                const perutYitrot =yitrotElement? yitrotElement.getElementsByTagName('PerutYitrot') : "";
                                const pirteiOved = p.getElementsByTagName('PirteiOved')[0];
                                const sugTochnitOhHeshbon = cleanVal(pirteiOved ? getElementText(pirteiOved, 'SUG-TOCHNIT-O-CHESHBON') : '');
                                const mprMaasikBeYatzran = cleanVal(pirteiOved ? getElementText(pirteiOved, 'MPR-MAASIK-BE-YATZRAN') : '');
                                
                                if(mprMaasikBeYatzran){
                                    maasikimSet=Array.from(maasikimSet);
                                    for(const maasikim of maasikimSet){
                                        if(maasikim.split('-')[2]===mprMaasikBeYatzran && Number(maasikim.split('-')[0])!==6){
                                            shemMaasik=maasikim.split('-')[3];
                                            break;
                                        }
                                        else{
                                            shemMaasik='לא ידוע';
                                        }
                                    }

                                }
                                let yitratKaspeyTagmulimValue = 0;
                                const nesilutTag = yitrotElement ? yitrotElement.getElementsByTagName('NesilutTag') : null;
                                if (nesilutTag) {
                                    const nesilutTagArray = Array.from(nesilutTag);
                                    for (const nesilut of nesilutTagArray) {
                                        const yitratKaspeyTagmulim = cleanVal(getElementText(nesilut, 'YITRAT-KASPEY-TAGMULIM')) || 0;
                                        yitratKaspeyTagmulimValue = yitratKaspeyTagmulimValue + parseFloat(yitratKaspeyTagmulim);
                                    }
                                }
                                let pitzuimPturimMaavidimKodmim=0;
                                let erechPidionPitzuimLeKitzbaMaavidimKodmim=0;
                                let tzviratPitzuimMaavidimKodmimBeretzefKitzba=0;
                                let tzviratPitzuimMaavidimKodmimBeretzefZechuyot=0;
                                let tzviratPitzuim31121999LeKitzba=0;
                                let erechPidionPitzuimMaasikNochechi=0;
                                let erechPidionMarkivPitzuimLemasNochechi=0;
                                let erechPidionPitzuimMaavidimKodmimRetzefZehuyut=0;
                                let erechPidionPitzuimLeHonMaavidimKodmim=0;
                                let yitratPitzuimLeLoHitchashbenot=0;
                                let kayamRetzefPitzuimKitzba=0;
                                let kayamRetzefPitzuimZechuyot=0;

                                const kaspeyPizoyimElements = yitrotElement ? yitrotElement.getElementsByTagName('YitrotShonot') : null;
                                if (kaspeyPizoyimElements && kaspeyPizoyimElements.length > 0) {
                                    const kaspeyPizoyim = kaspeyPizoyimElements[0];
                                    pitzuimPturimMaavidimKodmim = cleanVal(getElementText(kaspeyPizoyim, 'TZVIRAT-PITZUIM-PTURIM-MAAVIDIM-KODMIM')) || 0;
                                    erechPidionPitzuimLeKitzbaMaavidimKodmim = cleanVal(getElementText(kaspeyPizoyim, 'ERECH-PIDION-PITZUIM-LEKITZBA-MAAVIDIM-KODMIM')) || 0;
                                    tzviratPitzuimMaavidimKodmimBeretzefKitzba = cleanVal(getElementText(kaspeyPizoyim, 'TZVIRAT-PITZUIM-MAAVIDIM-KODMIM-BERETZEF-KITZBA')) || 0;
                                    tzviratPitzuimMaavidimKodmimBeretzefZechuyot = cleanVal(getElementText(kaspeyPizoyim, 'TZVIRAT-PITZUIM-MAAVIDIM-KODMIM-BERETZEF-ZECHUYOT')) || 0;
                                    tzviratPitzuim31121999LeKitzba = cleanVal(getElementText(kaspeyPizoyim, 'TZVIRAT-PITZUIM-31-12-1999-LEKITZBA')) || 0;
                                    erechPidionPitzuimMaasikNochechi = cleanVal(getElementText(kaspeyPizoyim, 'ERECH-PIDION-PITZUIM-MAASIK-NOCHECHI')) || 0;
                                    erechPidionMarkivPitzuimLemasNochechi = cleanVal(getElementText(kaspeyPizoyim, 'ERECH-PIDION-MARKIV-PITZUIM-LEMAS-NOCHECHI')) || 0;
                                    erechPidionPitzuimMaavidimKodmimRetzefZehuyut = cleanVal(getElementText(kaspeyPizoyim, 'ERECH-PIDION-PITZUIM-MAAVIDIM-KODMIM-RETZEF-ZEHUYUT')) || 0;
                                    erechPidionPitzuimLeHonMaavidimKodmim = cleanVal(getElementText(kaspeyPizoyim, 'ERECH-PIDION-PITZUIM-LEHON-MAAVIDIM-KODMIM')) || 0;
                                    yitratPitzuimLeLoHitchashbenot = cleanVal(getElementText(kaspeyPizoyim, 'YITRAT-PITZUIM-LELO-HITCHASHBENOT')) || 0;
                                    kayamRetzefPitzuimKitzba = cleanVal(getElementText(kaspeyPizoyim, 'KAYAM-RETZEF-PITZUIM-KITZBA')) || 0;
                                    kayamRetzefPitzuimZechuyot = cleanVal(getElementText(kaspeyPizoyim, 'KAYAM-RETZEF-ZECHUYOT-PITZUIM')) || 0;
                                    if(pitzuimPturimMaavidimKodmim>0 || erechPidionPitzuimLeKitzbaMaavidimKodmim>0 
                                    || tzviratPitzuimMaavidimKodmimBeretzefKitzba>0 || tzviratPitzuimMaavidimKodmimBeretzefZechuyot>0
                                    || tzviratPitzuim31121999LeKitzba>0 || erechPidionPitzuimMaasikNochechi>0 ||
                                    erechPidionMarkivPitzuimLemasNochechi>0 || erechPidionPitzuimMaavidimKodmimRetzefZehuyut>0
                                    || erechPidionPitzuimLeHonMaavidimKodmim>0 || yitratPitzuimLeLoHitchashbenot>0){
                                    yitrotKaspeyPizoyim.push({
                                        sugMutzar: sugMutzar,
                                        misparPolisaOHeshbon: misparPolisaOHeshbon,
                                        pitzuimPturimMaavidimKodmim: parseFloat(pitzuimPturimMaavidimKodmim),
                                        erechPidionPitzuimLeKitzbaMaavidimKodmim: parseFloat(erechPidionPitzuimLeKitzbaMaavidimKodmim),
                                        tzviratPitzuimMaavidimKodmimBeretzefKitzba: parseFloat(tzviratPitzuimMaavidimKodmimBeretzefKitzba),
                                        tzviratPitzuimMaavidimKodmimBeretzefZechuyot: parseFloat(tzviratPitzuimMaavidimKodmimBeretzefZechuyot),
                                        tzviratPitzuim31121999LeKitzba: parseFloat(tzviratPitzuim31121999LeKitzba),
                                        erechPidionPitzuimMaasikNochechi: parseFloat(erechPidionPitzuimMaasikNochechi),
                                        erechPidionMarkivPitzuimLemasNochechi: parseFloat(erechPidionMarkivPitzuimLemasNochechi),
                                        erechPidionPitzuimMaavidimKodmimRetzefZehuyut: parseFloat(erechPidionPitzuimMaavidimKodmimRetzefZehuyut),
                                        erechPidionPitzuimLeHonMaavidimKodmim: parseFloat(erechPidionPitzuimLeHonMaavidimKodmim),
                                        yitratPitzuimLeLoHitchashbenot: parseFloat(yitratPitzuimLeLoHitchashbenot),
                                        kayamRetzefPitzuimKitzba: kayamRetzefPitzuimKitzba,
                                        kayamRetzefPitzuimZechuyot: kayamRetzefPitzuimZechuyot
                                    });
                                    }
                                    

                                }
                         
                                let totalChisachon = 0;
                                const perutYitrotArray = Array.from(perutYitrot);
                                if (perutYitrotArray) {
                                
                                    for (const yitra of perutYitrotArray) {
                                        const totalChisachonMtzbr = cleanVal(getElementText(yitra, 'TOTAL-CHISACHON-MTZBR')) || 0;
                                        const totalErkeiPidion = cleanVal(getElementText(yitra, 'TOTAL-ERKEI-PIDION')) || 0;
                                        totalChisachon = totalChisachon + parseFloat(totalErkeiPidion);
                                    }
                                }

                                // ----- דמי ניהול (ריבוי רשומות) -----
                                let dmeyNihulSet = new Set();
                                let actualFeeFromDeposit = 0;
                                let actualFeeFromBalance = 0;
                                
                                const perutHotzaot = p.getElementsByTagName('PerutHotzaot')[0];
                                const mivneDmeiNihul = perutHotzaot ? perutHotzaot.getElementsByTagName('MivneDmeiNihul')[0] : null;
                                const dmeyElements = mivneDmeiNihul ? mivneDmeiNihul.getElementsByTagName('PerutMivneDmeiNihul') : [];
                                const dmey = Array.from(dmeyElements);
                                
                                for (const d of dmey) {
                                    const sugHotzaa = cleanVal(getElementText(d, 'SUG-HOTZAA')) || 0;
                                    const sheurDmeiNihul = cleanVal(getElementText(d, 'SHEUR-DMEI-NIHUL')) || '';
                                    const dmeiNihulAchidim = cleanVal(getElementText(d, 'DMEI-NIHUL-ACHIDIM'));
                                
                                    const kayemetHatava = cleanVal(getElementText(d, 'KAYEMET-HATAVA')) || '';
                                    const sugHatava = cleanVal(getElementText(d, 'SUG-HATAVA')) || '';
                                    const achozHatava = cleanVal(getElementText(d, 'ACHOZ-HATAVA')) || '';
                                    dmeyNihulSet.add(`${sugHotzaa}-${dmeiNihulAchidim}-${sheurDmeiNihul}`);
                                    
                                    // אם dmeiNihulAchidim = 1 (באחוזים)
                                    if (dmeiNihulAchidim === '1' || dmeiNihulAchidim === 1) {
                                        if (sugHotzaa === '1' || sugHotzaa === 1) {
                                            // דמי ניהול מצבירה
                                            actualFeeFromBalance = parseFloat(sheurDmeiNihul) || 0;
                                        } else if (sugHotzaa === '2' || sugHotzaa === 2) {
                                            // דמי ניהול מהפקדה
                                            actualFeeFromDeposit = parseFloat(sheurDmeiNihul) || 0;
                                        }
                                    }
                                }


                                const perutMasluleiHashkaaElements = p.getElementsByTagName('PerutMasluleiHashkaa');
                                const maslulim = Array.from(perutMasluleiHashkaaElements);
                                
                                // ריכוז מסלולים תחת מספר החשבון - כל מסלול פעם אחת עם סכום מצטבר
                                let maslulMap = new Map(); // מפה לקבץ מסלולים לפי קוד
                                
                                for (const maslul of maslulim) {
                                    const kodMaslolHashkaa = cleanVal(getElementText(maslul,'KOD-MASLUL-HASHKAA')) || '';
                                    pensiaVatikaOHadasha !=='' && pensiaVatikaOHadasha !=='null' ? kodMaslulSet.add(`${kodMaslolHashkaa}-${sugMutzar}-${pensiaVatikaOHadasha}`):
                                    kodMaslolHashkaa !=='' && kodMaslolHashkaa !=='null' ? kodMaslulSet.add(`${kodMaslolHashkaa}-${sugMutzar}-0`):'';
                                    const shemMaslulHashkaa = cleanVal(getElementText(maslul,'SHEM-MASLUL-HASHKAA')) || '';
                                    const schumTzvira = parseFloat(cleanVal(getElementText(maslul,'SCHUM-TZVIRA-BAMASLUL')) || 0);
                                    if(schumTzvira==0){continue;}
                                    
                                    // דמי ניהול - אחידים לכל המסלולים באותו חשבון מ-PerutMivneDmeiNihul
                                    // רק אם אין שם נתונים, ניקח מהמסלול עצמו
                                    const sheurDmeyNihulHafkadMivne = actualFeeFromDeposit || 
                                        parseFloat(cleanVal(getElementText(maslul,'SHEUR-DMEI-NIHUL-HAFKADA-MIVNE')) || 0);
                                    const sheurDmeyNihulHisachonMivne = actualFeeFromBalance || 
                                        parseFloat(cleanVal(getElementText(maslul,'SHEUR-DMEI-NIHUL-HISACHON-MIVNE')) || 0);
                                    
                                    const tesuaNeto = cleanVal(getElementText(maslul,'TSUA-NETO')) || '';
                                    const shiurAlotShnatitZpuiaLmslulHashkah = cleanVal(getElementText(maslul,'SHIUR-ALUT-SHNATIT-ZPUIA-LMSLUL-HASHKAH')) || '';
                                    const kodSugMaslul = cleanVal(getElementText(maslul,'KOD-SUG-MASLUL')) || '';
                                    
                                    // אם המסלול כבר קיים במפה, הוסף את הסכום
                                    if (maslulMap.has(kodMaslolHashkaa)) {
                                        const existingMaslul = maslulMap.get(kodMaslolHashkaa);
                                        existingMaslul.schumTzvira += schumTzvira;
                                        existingMaslul.count += 1; // ספירת מופעים
                                    } else {
                                        // מסלול חדש - הוסף למפה
                                       if(totalChisachon>0){
                                            maslulMap.set(kodMaslolHashkaa,{
                                                kodMaslolHashkaa,
                                                shemMaslulHashkaa,
                                                schumTzvira,
                                                sheurDmeyNihulHafkadMivne,
                                                sheurDmeyNihulHisachonMivne,
                                                tesuaNeto,
                                                shiurAlotShnatitZpuiaLmslulHashkah,
                                                kodSugMaslul,
                                                pensiaVatikaOHadasha, 
                                                count: 1
                                            });
                                              
                                        }
                                    }
                                }
                                
                                // המרת המפה למערך לסיכום
                                const maslulDetails = Array.from(maslulMap.values());
                                const totalSchumTzviraBamaslul = maslulDetails.reduce((sum, maslul) => sum + maslul.schumTzvira, 0);
                             
                                
                                const mafyenMaslulim='maslulim-'+misparPolisaOHeshbon;
                                pirteiHeshbon.push(
                                 {
                                  misparPolisaOHeshbon:misparPolisaOHeshbon,
                                  mekademGilPrishaTzafuy:mekademGilPrishaTzafuy,
                                  sugMutzar:sugMutzar,
                                  shemTochnit:shemTochnit,
                                  taarichHitztarfutMutzar:taarichHitztarfutMutzar,
                                  shemMaslulHabituah:shemMaslulHabituah,
                                  shemMaasik:shemMaasik,
                                  totalChisachon:totalChisachon.toLocaleString('he-IL', {maximumFractionDigits: 0})+""+"שח",
                                  totalChisachonV:parseFloat(totalChisachon),
                                  yitratKaspeyTagmulimValue:yitratKaspeyTagmulimValue?Math.round(yitratKaspeyTagmulimValue):0,
                                  mafyenMaslulim:maslulDetails,
                                  yitrotKaspeyPizoyim:yitrotKaspeyPizoyim?yitrotKaspeyPizoyim:0,
                                }
                                
                               );
                               
                               yitrotKaspeyPizoyim=[];
                            }
                           
                        }
                          
                    } catch (err) {
                        console.error(`❌ Error in file ${file.name}:`, err);
                    }
                } // סגירת הלולאה for (const file of uploadedFiles)
                 DataAll.push(pratimIshim);
                 DataAll.push(sumSugMutzar);
                 DataAll.push(pirteiHeshbon.filter(item=>Number(item.totalChisachonV)>0));
                 
                 // איסוף נתוני פיצויים מכל החשבונות
                 let allPitzuimData = [];
                 pirteiHeshbon.forEach(item => {
                     if (item.yitrotKaspeyPizoyim && item.yitrotKaspeyPizoyim.length > 0) {
                         allPitzuimData = allPitzuimData.concat(item.yitrotKaspeyPizoyim);
                     }
                 });
                 DataAll.push(allPitzuimData);

                 const kaspeyTagmulimData=DataAll[2].filter(item=>item.yitratKaspeyTagmulimValue>0);
                let kaspeyTagmulimSum=0;
                 kaspeyTagmulimData.forEach(item=>{
                    if(item.yitratKaspeyTagmulimValue && item.yitratKaspeyTagmulimValue>0){
                        kaspeyTagmulimSum+=item.yitratKaspeyTagmulimValue;  
                    } 
                 });
                 
                
                
                

                 
               
                
                
                const kodMaslulDetails=DataAll[2]
                let summary = {};
                kodMaslulDetails.forEach(product => {
                    product.mafyenMaslulim.forEach(mslul => {
                        const key = `${product.sugMutzar}__${mslul.shemMaslulHashkaa}`;

                        if (!summary[key]) {
                        summary[key] = {
                            sugMutzar:product.sugMutzar,
                            shemMaslulHashkaa: mslul.shemMaslulHashkaa,
                            totalSchumTzvira: 0
                        };
                        }

                        summary[key].totalSchumTzvira += mslul.schumTzvira || 0;
                    });
                                    
                });
                const result = Object.values(summary);
                result.forEach(item => {
                    item.sugMutzar=sugTochnitOHeshbon[item.sugMutzar];
                });
                
                // הצגת הנתונים על המסך
                displayDataOnScreen(pratimIshim, sumSugMutzar, result, sheabudIkulHalvaa, DataAll[3]);
                
                // הדפסת סיכום הנתונים שנאספו מכל הקבצים
            

            } catch (error) {
                dataContent.innerHTML = `<div style="color: #ff6b6b; text-align: right; padding: 2rem;">
                    <i class="fas fa-exclamation-triangle"></i><br>
                    שגיאה בקריאת הקבצים: ${error.message}
                </div>`;
            }
        });

        /*
                        // ----- דמי ניהול (ריבוי רשומות) -----
                        const perutHotzaot = p.getElementsByTagName('PerutHotzaot')[0];
                        const mivneDmeiNihul = perutHotzaot ? perutHotzaot.getElementsByTagName('MivneDmeiNihul')[0] : null;
                        const dmeyElements = mivneDmeiNihul ? mivneDmeiNihul.getElementsByTagName('PerutMivneDmeiNihul') : [];
                        const dmey = Array.from(dmeyElements);
                        for (const d of dmey) {
                            const sugHotzaa = cleanVal(getElementText(d, 'SUG-HOTZAA')) || 0;
                            const sheurDmeiNihul = cleanVal(getElementText(d, 'SHEUR-DMEI-NIHUL')) || '';
                            const dmeiNihulAchidim = cleanVal(getElementText(d, 'DMEI-NIHUL-ACHIDIM'));
                            const kayemetHatava = cleanVal(getElementText(d, 'KAYEMET-HATAVA')) || '';
                            const sugHatava = cleanVal(getElementText(d, 'SUG-HATAVA')) || '';
                            const achozHatava = cleanVal(getElementText(d, 'ACHOZ-HATAVA')) || '';
                        }

                              
                        const perutYitrotElements = yitrotElement ? yitrotElement.getElementsByTagName('PerutYitrot') : [];
                        const yitrot = Array.from(perutYitrotElements);
                        
                        
                        
                            
                    }
                        


                       
                        const koteret = mimshak.getElementsByTagName('KoteretKovetz')[0];
                        const kodMezaheYatzran = getElementText(yeshutYatzran, 'KOD-MEZAHE-YATZRAN');
                        const shemYatzran = getElementText(yeshutYatzran, 'SHEM-YATZRAN');
                        const taarichBitzua = sliceDate8(getElementText(koteret, 'TAARICH-BITZUA'));
                        const sugMezaheLakoach = yeshutLakoach ? getElementText(yeshutLakoach, 'SUG-MEZAHE-LAKOACH') : '';
                        
                        const taarichLeyda = cleanVal(yeshutLakoach ? getElementText(yeshutLakoach, 'TAARICH-LEYDA') : '');
                        const min = cleanVal(yeshutLakoach ? getElementText(yeshutLakoach, 'MIN') : '');

                        
            
                        // לכל חשבון יכולים להיות כמה מסלולים/יתרות/דמי ניהול
                        

                        for (const heshbon of heshbonot) {
                            // ----- שורת חשבון אחת -----
                            
                            const kidodAchid = cleanVal(getElementText(heshbon, 'KIDOD-ACHID'));
                            const taarichNechnut = cleanVal(getElementText(heshbon, 'TAARICH-NECHONUT'));
                            const sugKerenPensia = cleanVal(getElementText(heshbon, 'SUG-KEREN-PENSIA'));
                            const pensiaVatikaOHadasha = cleanVal(getElementText(heshbon, 'PENSIA-VATIKA-O-HADASHA'));
                            const statusPolisaOCheshbon = cleanVal(getElementText(heshbon, 'STATUS-POLISA-O-CHESHBON'));
                            const taarichHitztarfutMutzar = cleanVal(getElementText(heshbon, 'TAARICH-HITZTARFUT-MUTZAR'));
                            const maslulBituach = heshbon.getElementsByTagName('MaslulBituach')[0];
                            const shemMaslulHabituah = cleanVal(maslulBituach ? getElementText(maslulBituach, 'SHEM-MASLUL-HABITUAH') : '') || '';
                            
                            
                            
                                            
                            const yitraLefiGilPrisha = heshbon.getElementsByTagName('YitraLefiGilPrisha')[0];
                            const tzviratChisachonChzuyaLeloPremiyot = cleanVal(yitraLefiGilPrisha ? getElementText(yitraLefiGilPrisha, 'TZVIRAT-CHISACHON-CHAZUYA-LELO-PREMIYOT') : '','') || '';
                            const totalChisachonMitztaberTzafuy = cleanVal(yitraLefiGilPrisha ? getElementText(yitraLefiGilPrisha, 'TOTAL-CHISACHON-MITZTABER-TZAFUY') : '', '') || '';
                            const gilPrisha = cleanVal(yitraLefiGilPrisha ? getElementText(yitraLefiGilPrisha, 'GIL-PRISHA') : '', '') || '';
                
                        
                            heshbonotColl.push({
                                misparZihuyLakoach:misparZihuyLakoach,sugMezaheLakoach:sugMezaheLakoach,
                                misparPolisaOHeshbon:misparPolisaOHeshbon,shemSugTochnit:shemSugTochnit,
                                shemTochnit:shemTochnit,kidodAchid:kidodAchid,taarichNechnut:taarichNechnut,
                                taarichHitztarfutMutzar:taarichHitztarfutMutzar, sugKerenPensia:sugKerenPensia,
                                pensiaVatikaOHadasha:pensiaVatikaOHadasha,statusPolisaOCheshbon:statusPolisaOCheshbon,
                                shemMaslulHabituah:shemMaslulHabituah,hutalSHiabud:hutalSHiabud,hutalIkul:hutalIkul,
                                yeshHalvaaBamutzar:yeshHalvaaBamutzar,yeshTvia:yeshTvia,sheurTesuaNetoH:sheurTesuaNetoH,
                                tzviratChisachonChzuyaLeloPremiyot:tzviratChisachonChzuyaLeloPremiyot,
                                totalChisachonMitztaberTzafuy:totalChisachonMitztaberTzafuy,gilPrisha:gilPrisha
                            }) 
            
            
            
                
                            // ----- מסלולים (ריבוי רשומות) -----
                            const prtTakzivElements = heshbon.getElementsByTagName('PirteiTaktziv');
                            const prtTakziv = Array.from(prtTakzivElements);

                
                            for (const p of prtTakziv) {
                                                                const statusMaasik = cleanVal(pirteiOved ? getElementText(pirteiOved, 'STATUS-MAASIK') : '');
                                netuneimutzarmaasikColl.push({
                                    misparPolisaOHeshbon:misparPolisaOHeshbon,misparZihuyLakoach:misparZihuyLakoach,
                                    sugMutzar:sugMutzar,sugTochnitOhHeshbon:sugTochnitOhHeshbon,
                                    mprMaasikBeYatzran:mprMaasikBeYatzran, statusMaasik:statusMaasik 
                                }) 
                                heshbonotColl.push({netuneimutzarmaasik:netuneimutzarmaasikColl[0]});netuneimutzarmaasikColl=[];  
                        
                                const perutMasluleiHashkaaElements = p.getElementsByTagName('PerutMasluleiHashkaa');
                                const maslulim = Array.from(perutMasluleiHashkaaElements);
                        
                                for (const maslul of maslulim) {
                                    const kodMaslulHafrash = cleanVal(getElementText(maslul, 'KOD-SUG-HAFRASHA')) || '';
                                    const kodSugMaslul = cleanVal(getElementText(maslul, 'KOD-SUG-MASLUL')) || '';
                                    const schumTzviraBamaslul = cleanVal(getElementText(maslul, 'SCHUM-TZVIRA-BAMASLUL')) || '';
                                    const shemMaslulHashkaa = cleanVal(getElementText(maslul, 'SHEM-MASLUL-HASHKAA')) || '';
                                    const sheurDmeyNihulHafkadMivne = cleanVal(getElementText(maslul, 'SHEUR-DMEI-NIHUL-HAFKADA-MIVNE')) || '';
                                    const sheurDmeyNihulHisachonMivne = cleanVal(getElementText(maslul, 'SHEUR-DMEI-NIHUL-HISACHON-MIVNE')) || '';
                                    const tesuaNeto = cleanVal(getElementText(maslul, 'TSUA-NETO')) || '';
                                    const shiurAlotShnatitZpuiaLmslulHashkah = cleanVal(getElementText(maslul, 'SHIUR-ALUT-SHNATIT-ZPUIA-LMSLUL-HASHKAH')) || '';
 
                                    maslulimColl.push({
                                        misparPolisaOHeshbon:misparPolisaOHeshbon,misparZihuyLakoach:misparZihuyLakoach,
                                        sugMutzar:sugMutzar,kodMaslulHafrash:kodMaslulHafrash,kodSugMaslul:kodSugMaslul,
                                        schumTzviraBamaslul:schumTzviraBamaslul,shemMaslulHashkaa:shemMaslulHashkaa,
                                        sheurDmeyNihulHafkadMivne:sheurDmeyNihulHafkadMivne,
                                        sheurDmeyNihulHisachonMivne:sheurDmeyNihulHisachonMivne,tesuaNeto:tesuaNeto,
                                        shiurAlotShnatitZpuiaLmslulHashkah:shiurAlotShnatitZpuiaLmslulHashkah
                                    })
                                    heshbonotColl.push({maslul:maslulimColl[0]});
                                }

                                // ----- דמי ניהול (ריבוי רשומות) -----
                                const perutHotzaot = p.getElementsByTagName('PerutHotzaot')[0];
                                const mivneDmeiNihul = perutHotzaot ? perutHotzaot.getElementsByTagName('MivneDmeiNihul')[0] : null;
                                const dmeyElements = mivneDmeiNihul ? mivneDmeiNihul.getElementsByTagName('PerutMivneDmeiNihul') : [];
                                const dmey = Array.from(dmeyElements);
                                for (const d of dmey) {
                                    const sugHotzaa = cleanVal(getElementText(d, 'SUG-HOTZAA')) || 0;
                                    const sheurDmeiNihul = cleanVal(getElementText(d, 'SHEUR-DMEI-NIHUL')) || '';
                                    const dmeiNihulAchidim = cleanVal(getElementText(d, 'DMEI-NIHUL-ACHIDIM'));
                                    const kayemetHatava = cleanVal(getElementText(d, 'KAYEMET-HATAVA')) || '';
                                    const sugHatava = cleanVal(getElementText(d, 'SUG-HATAVA')) || '';
                                    const achozHatava = cleanVal(getElementText(d, 'ACHOZ-HATAVA')) || '';
                                    dmeinihulColl.push({
                                        misparPolisaOHeshbon:misparPolisaOHeshbon,misparZihuyLakoach:misparZihuyLakoach,
                                        sugMutzar:sugMutzar,sugHotzaa:sugHotzaa,sheurDmeiNihul:sheurDmeiNihul,
                                        dmeiNihulAchidim:dmeiNihulAchidim,kayemetHatava:kayemetHatava,sugHatava:sugHatava,
                                        achozHatava:achozHatava

                                    })

                                    heshbonotColl.push({dmeinihul:dmeinihulColl[0]});dmeinihulColl=[];
                                }
                            
                                //const sheurTesuaNeto=heshbon.Tesua['SHEUR-TESUA-NETO'];
                                //heshbonotColl.push(sheurTesuaNeto);
                                const blockItrot = p.getElementsByTagName('BlockItrot')[0];
                                const yitrotElement = blockItrot ? blockItrot.getElementsByTagName('Yitrot')[0] : null;
                                const taarichErechTzvirot = cleanVal(yitrotElement ? getElementText(yitrotElement, 'TAARICH-ERECH-TZVIROT') : '');

                                // ----- יתרות (ריבוי רשומות) -----
                                const perutYitrotElements = yitrotElement ? yitrotElement.getElementsByTagName('PerutYitrot') : [];
                                const yitrot = Array.from(perutYitrotElements);
                                for (const yitra of yitrot) {
                                    const kodSugItra = cleanVal(getElementText(yitra, 'KOD-SUG-ITRA'));
                                    const totalChisachonMtzbr = cleanVal(getElementText(yitra, 'TOTAL-CHISACHON-MTZBR')) || '';
                                    const totalErkeiPidion = cleanVal(getElementText(yitra, 'TOTAL-ERKEI-PIDION'));
                                    
                                    const nesilutTag = yitrotElement ? yitrotElement.getElementsByTagName('NesilutTag')[0] : null;
                                    const moedNezilutTagmulim = cleanVal(nesilutTag ? getElementText(nesilutTag, 'MOED-NEZILUT-TAGMULIM') : '') || '';
                                    const yitratKaspeyTagmulim = cleanVal(nesilutTag ? getElementText(nesilutTag, 'YITRAT-KASPEY-TAGMULIM') : '') || '';
                                     
                                    yitrotColl.push({
                                        taarichErechTzvirot:taarichErechTzvirot,
                                        misparPolisaOHeshbon:misparPolisaOHeshbon,misparZihuyLakoach:misparZihuyLakoach,
                                        sugMutzar:sugMutzar,kodSugItra:kodSugItra,totalChisachonMtzbr:totalChisachonMtzbr,
                                        totalErkeiPidion:totalErkeiPidion,moedNezilutTagmulim:moedNezilutTagmulim,
                                        yitratKaspeyTagmulim:yitratKaspeyTagmulim
                                    })
                                    heshbonotColl.push({yitrot:yitrotColl[0]});yitrotColl=[];
                                }
                            }                            
                        };
                        */
                       
                        


        



        function parseXML(content) {
            try {
                const parser = new DOMParser();
                const result = parser.parseFromString(content, 'text/xml');
                
                // Check for parsing errors
                const parserError = result.querySelector('parsererror');
                if (parserError) {
                    throw new Error('שגיאה בניתוח קובץ ה-XML: ' + parserError.textContent);
                }
                
                // Extract pension fund data
                const pensionData = extractPensionData(result);
                
                return {
                    type: 'xml',
                    data: pensionData,
                    rawContent: content.substring(0, 1000) + (content.length > 1000 ? '...' : '')
                };
            } catch (error) {
                return {
                    type: 'xml',
                    error: error.message,
                    rawContent: content.substring(0, 500) + '...'
                };
            }
        }

        function extractPensionData(result) {
            const data = {
                participantInfo: {},
                accounts: [],
                summary: {}
            };

            // Extract Mimshak root
            const mimshak = result.getElementsByTagName('Mimshak')[0];
            if (!mimshak) return data;

            // Extract YeshutYatzran info
            const yeshutYatzran = mimshak.getElementsByTagName('YeshutYatzran')[0];
            if (yeshutYatzran) {
                data.participantInfo = {
                    kodMezaheYatzran: getElementText(yeshutYatzran, 'KOD-MEZAHE-YATZRAN'),
                    shemYatzran: getElementText(yeshutYatzran, 'SHEM-YATZRAN')
                };
            }

            // Extract Mutzarim
            const mutzarim = yeshutYatzran ? yeshutYatzran.getElementsByTagName('Mutzarim')[0] : null;
            if (!mutzarim) return data;

            const mutzarElements = mutzarim.getElementsByTagName('Mutzar');
            
            for (let i = 0; i < mutzarElements.length; i++) {
                const mutzar = mutzarElements[i];
                
                // Extract NetuneiMutzar
                const netuneiMutzar = mutzar.getElementsByTagName('NetuneiMutzar')[0];
                if (!netuneiMutzar) continue;

                const sugMutzar = getElementText(netuneiMutzar, 'SUG-MUTZAR');
                const misparZihuyLakoach = getElementText(netuneiMutzar, 'MISPAR-ZIHUY-LAKOACH');
                
                // Extract YeshutLakoach
                const yeshutLakoach = netuneiMutzar.getElementsByTagName('YeshutLakoach')[0];
                if (yeshutLakoach) {
                    data.participantInfo = {
                        ...data.participantInfo,
                        misparZihuyLakoach: misparZihuyLakoach,
                        shemPrati: getElementText(yeshutLakoach, 'SHEM-PRATI'),
                        shemMishpacha: getElementText(yeshutLakoach, 'SHEM-MISHPACHA'),
                        misparCellulari: getElementText(yeshutLakoach, 'MISPAR-CELLULARI'),
                        eMail: getElementText(yeshutLakoach, 'E-MAIL'),
                        taarichLeyda: getElementText(yeshutLakoach, 'TAARICH-LEYDA')
                    };
                }

                // Extract YeshutMaasik (Employer Information)
                const yeshutMaasikElements = netuneiMutzar.getElementsByTagName('YeshutMaasik');
                const employers = [];
                
                for (let empIndex = 0; empIndex < yeshutMaasikElements.length; empIndex++) {
                    const yeshutMaasik = yeshutMaasikElements[empIndex];
                    const employerData = {
                        mprMaasikBeYatzran: getElementText(yeshutMaasik, 'MPR-MAASIK-BE-YATZRAN'),
                        shemMaasik: getElementText(yeshutMaasik, 'SHEM-MAASIK'),
                        misparMezaheMaasik: getElementText(yeshutMaasik, 'MISPAR-MEZAHE-MAASIK'),
                        sugMezaheMaasik: getElementText(yeshutMaasik, 'SUG-MEZAHE-MAASIK')
                    };
                    employers.push(employerData);
                }
                
                // Add employers to participant info
                if (employers.length > 0) {
                    data.participantInfo.employers = employers;
                }

                // Extract HeshbonotOPolisot
                const heshbonotOPolisot = mutzar.getElementsByTagName('HeshbonotOPolisot')[0];
                if (!heshbonotOPolisot) continue;

                const heshbonOPolisaElements = heshbonotOPolisot.getElementsByTagName('HeshbonOPolisa');
                
                for (let j = 0; j < heshbonOPolisaElements.length; j++) {
                    const heshbonOPolisa = heshbonOPolisaElements[j];
                    
                    const accountData = {
                        // Account basic info
                        misparPolisaOHeshbon: getElementText(heshbonOPolisa, 'MISPAR-POLISA-O-HESHBON'),
                        shemTochnit: getElementText(heshbonOPolisa, 'SHEM-TOCHNIT'),
                        kidodAchid: getElementText(heshbonOPolisa, 'KIDOD-ACHID'),
                        taarichNechnut: sliceDate8(getElementText(heshbonOPolisa, 'TAARICH-NECHONUT')),
                        taarichHitztarfutMutzar: getElementText(heshbonOPolisa, 'TAARICH-HITZTARFUT-MUTZAR'),
                        sugKerenPensia: getElementText(heshbonOPolisa, 'SUG-KEREN-PENSIA'),
                        pensiaVatikaOHadasha: getElementText(heshbonOPolisa, 'PENSIA-VATIKA-O-HADASHA'),
                        statusPolisaOCheshbon: getElementText(heshbonOPolisa, 'STATUS-POLISA-O-CHESHBON'),
                        
                        // Product type info
                        sugMutzar: sugMutzar,
                        sugMutzarDescription: sugMutzarDescriptions[sugMutzar] || 'לא ידוע',
                        
                        // Financial details
                        pathways: [],
                        balances: [],
                        managementFees: []
                    };

                    // Extract PirteiTaktziv (Pathways and Fees)
                    const pirteiTaktzivElements = heshbonOPolisa.getElementsByTagName('PirteiTaktziv');
                    
                    for (let k = 0; k < pirteiTaktzivElements.length; k++) {
                        const pirteiTaktziv = pirteiTaktzivElements[k];
                        
                        // Extract PerutMasluleiHashkaa (Investment Pathways)
                        const perutMasluleiHashkaa = pirteiTaktziv.getElementsByTagName('PerutMasluleiHashkaa')[0];
                        if (perutMasluleiHashkaa) {
                            const maslulElements = perutMasluleiHashkaa.getElementsByTagName('Maslul');
                            
                            for (let l = 0; l < maslulElements.length; l++) {
                                const maslul = maslulElements[l];
                                const pathwayData = {
                                    kodMaslulHafrash: getElementText(maslul, 'KOD-SUG-HAFRASHA'),
                                    kodSugMaslul: getElementText(maslul, 'KOD-SUG-MASLUL'),
                                    schumTzviraBamaslul: parseFloat(getElementText(maslul, 'SCHUM-TZVIRA-BAMASLUL')) || 0,
                                    shemMaslulHashkaa: getElementText(maslul, 'SHEM-MASLUL-HASHKAA'),
                                    sheurDmeyNihulHafkadMivne: parseFloat(getElementText(maslul, 'SHEUR-DMEI-NIHUL-HAFKADA-MIVNE')) || 0,
                                    sheurDmeyNihulHisachonMivne: parseFloat(getElementText(maslul, 'SHEUR-DMEI-NIHUL-HISACHON-MIVNE')) || 0,
                                    tesuaNeto: parseFloat(getElementText(maslul, 'TSUA-NETO')) || 0,
                                    shiurAlotShnatitZpuiaLmslulHashkah: parseFloat(getElementText(maslul, 'SHIUR-ALUT-SHNATIT-ZPUIA-LMSLUL-HASHKAH')) || 0
                                };
                                accountData.pathways.push(pathwayData);
                            }
                        }

                        // Extract PerutHotzaot (Management Fees)
                        const perutHotzaot = pirteiTaktziv.getElementsByTagName('PerutHotzaot')[0];
                        if (perutHotzaot) {
                            const mivneDmeiNihul = perutHotzaot.getElementsByTagName('MivneDmeiNihul')[0];
                            if (mivneDmeiNihul) {
                                const perutMivneDmeiNihulElements = mivneDmeiNihul.getElementsByTagName('PerutMivneDmeiNihul');
                                
                                for (let m = 0; m < perutMivneDmeiNihulElements.length; m++) {
                                    const perutMivneDmeiNihul = perutMivneDmeiNihulElements[m];
                                    const feeData = {
                                        sugHotzaa: getElementText(perutMivneDmeiNihul, 'SUG-HOTZAA'),
                                        sheurDmeiNihul: parseFloat(getElementText(perutMivneDmeiNihul, 'SHEUR-DMEI-NIHUL')) || 0,
                                        dmeiNihulAchidim: parseFloat(getElementText(perutMivneDmeiNihul, 'DMEI-NIHUL-ACHIDIM')) || 0,
                                        kayemetHatava: getElementText(perutMivneDmeiNihul, 'KAYEMET-HATAVA'),
                                        sugHatava: getElementText(perutMivneDmeiNihul, 'SUG-HATAVA'),
                                        achozHatava: getElementText(perutMivneDmeiNihul, 'ACHOZ-HATAVA')
                                    };
                                    accountData.managementFees.push(feeData);
                                }
                            }
                        }

                        // Extract BlockItrot (Balances)
                        const blockItrot = pirteiTaktziv.getElementsByTagName('BlockItrot')[0];
                        if (blockItrot) {
                            const yitrot = blockItrot.getElementsByTagName('Yitrot')[0];
                            if (yitrot) {
                                const perutYitrotElements = yitrot.getElementsByTagName('PerutYitrot');
                                
                                for (let n = 0; n < perutYitrotElements.length; n++) {
                                    const perutYitrot = perutYitrotElements[n];
                                    const balanceData = {
                                        taarichErechTzvirot: getElementText(yitrot, 'TAARICH-ERECH-TZVIROT'),
                                        kodSugItra: getElementText(perutYitrot, 'KOD-SUG-ITRA'),
                                        totalChisachonMtzbr: parseFloat(getElementText(perutYitrot, 'TOTAL-CHISACHON-MTZBR')) || 0,
                                        totalErkeiPidion: parseFloat(getElementText(perutYitrot, 'TOTAL-ERKEI-PIDION')) || 0,
                                        moedNezilutTagmulim: getElementText(yitrot, 'MOED-NEZILUT-TAGMULIM'),
                                        yitratKaspeyTagmulim: parseFloat(getElementText(yitrot, 'YITRAT-KASPEY-TAGMULIM')) || 0
                                    };
                                    accountData.balances.push(balanceData);
                                }
                            }
                        }
                        
                        // Extract YitraLefiGilPrisha (Retirement Projections)
                        const yitraLefiGilPrisha = pirteiTaktziv.getElementsByTagName('YitraLefiGilPrisha')[0];
                        if (yitraLefiGilPrisha) {
                            const yitraData = {
                                gilPrisha: getElementText(yitraLefiGilPrisha, 'GIL-PRISHA'),
                                totalChisachonMitztaberTzafuy: parseFloat(getElementText(yitraLefiGilPrisha, 'TOTAL-CHISACHON-MITZTABER-TZAFUY')) || 0,
                                tzviratChisachonChzuyaLeloPremiyot: parseFloat(getElementText(yitraLefiGilPrisha, 'TZVIRAT-CHISACHON-CHAZUYA-LELO-PREMIYOT')) || 0,
                                mekademMovtachLeprisha: getElementText(yitraLefiGilPrisha, 'MEKADEM-MOVTACH-LEPRISHA'),
                                mekademHavtachstTochelet: getElementText(yitraLefiGilPrisha, 'MEKADEM-HAVTACHST-TOCHELET'),
                                mekademHavtachstTocheletprisha: getElementText(yitraLefiGilPrisha, 'MEKADEM-HAVTACHST-TOCHELETPRISHA'),
                                shemMaslol: getElementText(yitraLefiGilPrisha, 'SHEM-MASLOL'),
                                mekademHavtachatTsua: getElementText(yitraLefiGilPrisha, 'MEKADEM-HAVTACHAT-TSUA'),
                                mekademHavtachatTsuatkufa: getElementText(yitraLefiGilPrisha, 'MEKADEM-HAVTACHAT-TSUATKUFA'),
                                tkufatHagbalaBeshanim: getElementText(yitraLefiGilPrisha, 'TKUFAT-HAGBALA-BESHANIM'),
                                tocheletMashpiaKitzba: getElementText(yitraLefiGilPrisha, 'TOCHELET-MASHPIA-KITZBA'),
                                tsuaMashpiaKitzba: getElementText(yitraLefiGilPrisha, 'TSUA-MASHPIA-KITZBA'),
                                sheurPnsZiknaTzfuya: getElementText(yitraLefiGilPrisha, 'SHEUR-PNS-ZIKNA-TZFUYA'),
                                kupot: []
                            };
                            
                            // Extract Kupot data
                            const kupot = yitraLefiGilPrisha.getElementsByTagName('Kupot')[0];
                            if (kupot) {
                                const kupaElements = kupot.getElementsByTagName('Kupa');
                                for (let k = 0; k < kupaElements.length; k++) {
                                    const kupa = kupaElements[k];
                                    const kupaData = {
                                        sugKupa: getElementText(kupa, 'SUG-KUPA'),
                                        schumKitzvatZikna: parseFloat(getElementText(kupa, 'SCHUM-KITZVAT-ZIKNA')) || 0,
                                        kitzvatHodshitTzfuya: parseFloat(getElementText(kupa, 'KITZVAT-HODSHIT-TZFUYA')) || 0,
                                        achuzTsuaBatachazit: parseFloat(getElementText(kupa, 'ACHUZ-TSUA-BATACHAZIT')) || 0,
                                        totalItraTzfuyaMechushavLehonImPremiot: getElementText(kupa, 'TOTAL-ITRA-TZFUYA-MECHUSHAV-LEHON-IM-PREMIOT'),
                                        tzviratChisachonTzfuyaLehonLeloPremiyot: parseFloat(getElementText(kupa, 'TZVIRAT-CHISACHON-TZFUYA-LEHON-LELO-PREMIYOT')) || 0,
                                        totalSchumMtzbrTzafuyLegilPrishaMechushavLekitzbaImPremiyot: parseFloat(getElementText(kupa, 'TOTAL-SCHUM-MTZBR-TZAFUY-LEGIL-PRISHA-MECHUSHAV-LEKITZBA-IM-PREMIYOT')) || 0,
                                        totalSchumMitzvtaberTzfuyLegilPrishaMechushavHameyoadLekitzbaLeloPremiyot: parseFloat(getElementText(kupa, 'TOTAL-SCHUM-MITZVTABER-TZFUY-LEGIL-PRISHA-MECHUSHAV-HAMEYOAD-LEKITZBA-LELO-PREMIYOT')) || 0
                                    };
                                    yitraData.kupot.push(kupaData);
                                }
                            }
                            
                            accountData.yitraLefiGilPrisha = yitraData;
                        }
                    }
                    
                    data.accounts.push(accountData);
                }
            }

            // Calculate summary
            data.summary = calculateSummaryAdvanced(data.accounts);

            return data;
        }

        function getElementText(parent, tagName) {
            const element = parent.getElementsByTagName(tagName)[0];
            return element ? element.textContent.trim() : '';
        }

        function calculateSummaryAdvanced(accounts) {
            let totalBalance = 0;
            let totalContributions = 0;
            let totalManagementFees = 0;
            const productTypes = {};
            const pathwayTypes = {};
            const feeTypes = {};

            accounts.forEach(account => {
                // Calculate balances
                account.balances.forEach(balance => {
                    totalBalance += balance.totalErkeiPidion;
                    totalContributions += balance.totalChisachonMtzbr;
                });

                // Count product types
                const productType = account.sugMutzarDescription;
                productTypes[productType] = (productTypes[productType] || 0) + 1;

                // Count pathway types
                account.pathways.forEach(pathway => {
                    const pathwayType = pathway.shemMaslulHashkaa || 'לא ידוע';
                    pathwayTypes[pathwayType] = (pathwayTypes[pathwayType] || 0) + 1;
                });

                // Calculate management fees
                account.managementFees.forEach(fee => {
                    totalManagementFees += fee.dmeiNihulAchidim;
                    const feeType = fee.sugHotzaa || 'לא ידוע';
                    feeTypes[feeType] = (feeTypes[feeType] || 0) + fee.sheurDmeiNihul;
                });
            });

            return {
                totalBalance,
                totalContributions,
                totalManagementFees,
                accountsCount: accounts.length,
                pathwaysCount: accounts.reduce((sum, acc) => sum + acc.pathways.length, 0),
                balancesCount: accounts.reduce((sum, acc) => sum + acc.balances.length, 0),
                feesCount: accounts.reduce((sum, acc) => sum + acc.managementFees.length, 0),
                productTypes,
                pathwayTypes,
                feeTypes
            };
        }

        function calculateSummary(mutzarim) {
            let totalBalance = 0;
            let totalContributions = 0;
            let totalManagementFees = 0;
            const productTypes = {};

            mutzarim.forEach(mutzar => {
                mutzar.heshbonotOPolisot.forEach(heshbon => {
                    heshbon.perutYitrot.forEach(yitra => {
                        totalBalance += yitra.totalErkeiPidion;
                        totalContributions += yitra.totalHafkadot;
                        totalManagementFees += yitra.dmeiNihulShnatiim;
                        
                        const productType = mutzar.sugMutzarDescription;
                        if (!productTypes[productType]) {
                            productTypes[productType] = 0;
                        }
                        productTypes[productType] += yitra.totalErkeiPidion;
                    });
                });
            });

            return {
                totalBalance,
                totalContributions,
                totalManagementFees,
                productTypes,
                totalProducts: mutzarim.length
            };
        }

        function displayFileData(allData) {
            let html = '';
            
            allData.forEach(fileData => {
                html += `<div style="margin-bottom: 2rem;">`;
                html += `<h4 style="color: #667eea; margin-bottom: 1rem;">${fileData.fileName}</h4>`;
                
                if (fileData.data.error) {
                    html += `<div style="background: #f8d7da; padding: 1rem; border-radius: 8px; border: 1px solid #f5c6cb; color: #721c24;">
                        <i class="fas fa-exclamation-triangle"></i> ${fileData.data.error}
                    </div>`;
                } else if (fileData.data.type === 'xml') {
                    const pensionData = fileData.data.data;
                    
                    // Participant Information
                    if (Object.keys(pensionData.participantInfo).length > 0) {
                        html += '<div style="background: white; padding: 1rem; border-radius: 8px; border: 1px solid #e2e8f0; margin-bottom: 1rem;">';
                        html += '<h5 style="color: #667eea; margin-bottom: 0.5rem;"><i class="fas fa-user"></i> פרטי המשתתף</h5>';
                        html += '<table class="data-table">';
                        Object.entries(pensionData.participantInfo).forEach(([key, value]) => {
                            if (value) {
                                html += `<tr><td><strong>${key}:</strong></td><td>${value}</td></tr>`;
                            }
                        });
                        html += '</table></div>';
                    }
                    
                    // Summary Information
                    if (Object.keys(pensionData.summary).length > 0) {
                        html += '<div style="background: #e8f5e8; padding: 1rem; border-radius: 8px; border: 1px solid #c3e6c3; margin-bottom: 1rem;">';
                        html += '<h5 style="color: #28a745; margin-bottom: 0.5rem;"><i class="fas fa-chart-line"></i> סיכום כללי</h5>';
                        html += '<table class="data-table">';
                        Object.entries(pensionData.summary).forEach(([key, value]) => {
                            if (value) {
                                html += `<tr><td><strong>${key}:</strong></td><td>${value}</td></tr>`;
                            }
                        });
                        html += '</table></div>';
                    }
                    
                    // Balances
                    if (Object.keys(pensionData.balances).length > 0) {
                        html += '<div style="background: white; padding: 1rem; border-radius: 8px; border: 1px solid #e2e8f0; margin-bottom: 1rem;">';
                        html += '<h5 style="color: #667eea; margin-bottom: 0.5rem;"><i class="fas fa-wallet"></i> יתרות</h5>';
                        html += '<table class="data-table">';
                        Object.entries(pensionData.balances).forEach(([type, balance]) => {
                            html += `<tr><td><strong>${type}:</strong></td><td>${balance.amount || 'לא זמין'} ${balance.currency || ''}</td></tr>`;
                        });
                        html += '</table></div>';
                    }
                    
                    // Contributions
                    if (pensionData.contributions.length > 0) {
                        html += '<div style="background: white; padding: 1rem; border-radius: 8px; border: 1px solid #e2e8f0; margin-bottom: 1rem;">';
                        html += '<h5 style="color: #667eea; margin-bottom: 0.5rem;"><i class="fas fa-coins"></i> הפקדות</h5>';
                        html += '<table class="data-table">';
                        html += '<thead><tr><th>תאריך</th><th>סכום</th><th>סוג</th><th>מעסיק</th></tr></thead><tbody>';
                        
                        pensionData.contributions.slice(0, 10).forEach(contrib => {
                            html += '<tr>';
                            html += `<td>${contrib.date || ''}</td>`;
                            html += `<td>${contrib.amount || ''}</td>`;
                            html += `<td>${contrib.type || ''}</td>`;
                            html += `<td>${contrib.employer || ''}</td>`;
                            html += '</tr>';
                        });
                        html += '</tbody></table>';
                        
                        if (pensionData.contributions.length > 10) {
                            html += `<p style="text-align: right; color: #666; margin-top: 1rem;">
                                מציג 10 הפקדות ראשונות מתוך ${pensionData.contributions.length} הפקדות
                            </p>`;
                        }
                        html += '</div>';
                    }
                    
                    // Raw XML preview
                    html += '<div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; border: 1px solid #dee2e6;">';
                    html += '<h5 style="color: #6c757d; margin-bottom: 0.5rem;"><i class="fas fa-code"></i> תצוגת XML (חלקית)</h5>';
                    html += `<pre style="background: #2d3748; color: #e2e8f0; padding: 1rem; border-radius: 4px; overflow-x: auto; font-size: 0.8rem;">${fileData.data.rawContent}</pre>`;
                    html += '</div>';
                }
                
                html += '</div>';
            });
            
            dataContent.innerHTML = html;
        }

        // Delete files button
        deleteFilesBtn.addEventListener('click', () => {
            /*if (confirm('האם אתה בטוח שברצונך למחוק את כל הקבצים?')) {
                uploadedFiles = [];
                fileInput.value = '';
                uploadedFilesDiv.style.display = 'none';
                fileDataDisplay.style.display = 'none';
                document.getElementById('chartContainer').style.display = 'none';
                fileUploadArea.style.display = 'none';
                dataMislaka = null; // Clear data variable
                if (myChart) {
                    myChart.destroy();
                    myChart = null;
                }
                console.log('נתוני המסלקה נוקו:', dataMislaka);
            }*/
            closeDataDisplay();
            document.getElementById('sectionHeader').style.display = 'none';
        });

        // Close chart button
        closeChartBtn.addEventListener('click', () => {
            document.getElementById('chartContainer').style.display = 'none';
            uploadedFilesDiv.style.display = 'none';
            fileDataDisplay.style.display = 'none';
            fileUploadArea.style.display = 'none';
            fileUpload.style.display = 'none';

        });

        // Close and delete button
        closeAndDeleteBtn.addEventListener('click', () => {
                uploadedFiles = [];
                fileInput.value = '';
                uploadedFilesDiv.style.display = 'none';
                fileDataDisplay.style.display = 'none';
                document.getElementById('chartContainer').style.display = 'none';
                dataMislaka = null; // Clear data variable
                if (myChart) {
                    myChart.destroy();
                    myChart = null;
                }
                console.log('נתוני המסלקה נוקו:', dataMislaka);
        });

        // Smooth scroll to file upload section
        document.querySelectorAll('a[href="#fileUpload"]').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                
                // Check if process is active - only check if containers are visible (not none)
                const isProcessActive = (uploadedFilesDiv.style.display === 'block' || uploadedFilesDiv.style.display === 'flex') || 
                                     (fileDataDisplay.style.display === 'block' || fileDataDisplay.style.display === 'flex') || 
                                     (document.getElementById('chartContainer').style.display === 'block' || document.getElementById('chartContainer').style.display === 'flex');
                
                if (isProcessActive) {
                    closeDataDisplay(); 
                    
                }
                
                const fileUploadSection = document.getElementById('fileUpload');
                if (fileUploadSection) {
                    fileUploadSection.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                    
                    // Add a subtle highlight effect
                    fileUploadSection.style.transition = 'box-shadow 0.3s ease';
                    fileUploadSection.style.boxShadow = '0 0 30px rgba(102, 126, 234, 0.3)';
                    
                    setTimeout(() => {
                        fileUploadSection.style.boxShadow = '';
                    }, 2000);
                }
            });
        });
        
        // Advanced Analysis functionality
        advancedAnalysisBtn.addEventListener('click', () => {
            // ניקוי רמת סיכון לפני מעבר לניתוח מתקדם
            sessionStorage.removeItem('riskProfile');
            sessionStorage.removeItem('riskScore');
            sessionStorage.removeItem('riskSource');
            console.log('🧹 ניקוי רמת סיכון לפני מעבר לניתוח מתקדם');
           
            window.location.href = 'advancedAnalysis.html';
        });

        backToUploadBtn.addEventListener('click', () => {
            document.getElementById('advancedAnalysis').style.display = 'none';
            document.getElementById('fileUpload').scrollIntoView({ behavior: 'smooth' });
        });

        exportDataBtn.addEventListener('click', () => {
            exportAnalysisData();
        });

        generateReportBtn.addEventListener('click', () => {
            generatePDFReport();
        });

        // Close file upload section button
        closeFileUploadSectionBtn.addEventListener('click', () => {
            //console.log('כפתור סגירה נלחץ');
            closeDataDisplay();
        });
        function closeDataDisplay(){ 
            //console.log('closeDataDisplay נקרא');
            Swal.fire({
                title: '<span style="color: #333; font-size: 1.5rem;">האם אתה בטוח?</span>',
                html: '<p style="color: #666; font-size: 1.1rem;">כל הנתונים והקבצים שהועלו יימחקו</p>',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#dc3545',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'כן, מחק הכל',
                cancelButtonText: 'ביטול',
                width: 'clamp(300px, 90vw, 500px)',
                customClass: {
                    confirmButton: 'swal-confirm-btn',
                    cancelButton: 'swal-cancel-btn'
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    // Clear all data
                    uploadedFiles = [];
                    fileInput.value = '';
                    sumSugMutzar = sumSugMutzar = {
                        '1': [0, 0,0,0,0], '2': [0, 0,0,0,0], '2_1': [0, 0,0,0,0], '2_2': [0, 0,0,0,0], '3': [0, 0,0,0,0],
                        '4': [0, 0,0,0,0], '5': [0, 0,0,0,0], '6': [0, 0,0,0,0], '7': [0, 0,0,0,0], '8': [0, 0,0,0,0],
                        '9': [0, 0,0,0,0], '10': [0, 0,0,0,0]
                    };
                    pirteiHeshbon=[];DataAll=[];kodMaslulSet=new Set();yitrotKaspeyPizoyim=[];
                    pratimIshim='';yitrotLefiMutzar='';yitrotLeGilPrisha='';
                    masluleiHashkaa=[];sheabudIkulHalvaa=[];
                    dataMislaka = null;myChart = null;
                    
                    // ניקוי sessionStorage של נתוני ניתוח מתקדם
                    sessionStorage.removeItem('gilForAdvancedAnalysis');
                    sessionStorage.removeItem('ageToRetirementForAdvancedAnalysis');
                    sessionStorage.removeItem('sumHonForAdvancedAnalysis');
                    sessionStorage.removeItem('sumKitzvaForAdvancedAnalysis');
                    sessionStorage.removeItem('riskProfile');
                    sessionStorage.removeItem('riskScore');
                    sessionStorage.removeItem('riskSource');
                    sessionStorage.removeItem('advancedAnalysisData');
                    console.log('🗑️ נתוני ניתוח מתקדם נמחקו מ-sessionStorage');
                    
                    // השבת את כפתור הניתוח המתקדם
                    const advBtns = document.querySelectorAll('#advancedAnalysisBtnMain2, #advancedAnalysisBtn');
                    advBtns.forEach(btn => {
                        if (btn) {
                            btn.disabled = true;
                            btn.style.opacity = '0.5';
                            btn.style.cursor = 'not-allowed';
                        }
                    });
                    document.getElementById('sectionHeader').style.display = 'none';
                    document.getElementById('dataDisplayContainer').style.display = 'none';
                    // Hide all containers
                    document.getElementById('uploadedFiles').style.display = 'none';
                    document.getElementById('fileDataDisplay').style.display = 'none';
                    document.getElementById('chartContainer').style.display = 'none';
                    document.getElementById('advancedAnalysis').style.display = 'none';
                    document.getElementById('fileUploadArea').style.display = 'none';
                    
                    document.getElementById('filesList').innerHTML = '';
                    document.getElementById('dataContent').innerHTML = '';
                    
                    // Destroy chart if exists
                    if (myChart) {
                        myChart.destroy();
                        myChart = null;
                    }
                    
                    // Hide the file upload section
                    document.getElementById('fileUpload').style.display = 'none';
                    
                    // Scroll back to top
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    
                    // הצגת הודעת הצלחה
                    Swal.fire({
                        title: '<span style="color: #28a745;">הנתונים נמחקו בהצלחה!</span>',
                        icon: 'success',
                        timer: 2000,
                        showConfirmButton: false,
                        width: 'clamp(300px, 90vw, 400px)'
                    });
                    
                    console.log('סקציית העלאת הקבצים נסגרה וכל הנתונים נוקו');
                }
            });
        }

        // Tab switching functionality
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                const tabName = button.getAttribute('data-tab');
                switchTab(tabName);
            });
        });

        function performAdvancedAnalysis() {
            if (!dataMislaka) {
                document.getElementById('advancedAnalysis').style.display = 'none';
                alert('אין נתונים זמינים לניתוח');
                return;
            }

            // Perform different types of analysis
            analyzeReturns();
            analyzeFees();
            analyzeLiquidity();
            analyzePathways();
            analyzeRetirement();
            generateSummary();
        }

        function analyzePathways() {
            const pathwaysData = calculatePathwaysAnalysis();
            displayPathwaysChart(pathwaysData);
            displayOptimizationRecommendations(pathwaysData);
        }

        function calculatePathwaysAnalysis() {
            if (!dataMislaka || !dataMislaka.data) {
                return {
                    totalPathways: 0,
                    pathwayTypes: {},
                    averageReturn: 0,
                    recommendations: []
                };
            }

            let totalPathways = 0;
            let pathwayTypes = {};
            let totalReturn = 0;
            let returnCount = 0;

            for (const fileData of dataMislaka.data) {
                if (fileData.data && fileData.data.accounts) {
                    for (const account of fileData.data.accounts) {
                        if (account.pathways) {
                            for (const pathway of account.pathways) {
                                totalPathways++;
                                const pathwayName = pathway.shemMasulHashkaa || 'לא ידוע';
                                pathwayTypes[pathwayName] = (pathwayTypes[pathwayName] || 0) + 1;
                                
                                if (pathway.tsuaNeto) {
                                    totalReturn += pathway.tsuaNeto;
                                    returnCount++;
                                }
                            }
                        }
                    }
                }
            }

            const averageReturn = returnCount > 0 ? totalReturn / returnCount : 0;

            return {
                totalPathways,
                pathwayTypes,
                averageReturn,
                recommendations: generatePathwayRecommendations(pathwayTypes, averageReturn)
            };
        }

        function displayPathwaysChart(data) {
            const ctx = document.getElementById('pathwaysChart');
            if (!ctx) return;

            const labels = Object.keys(data.pathwayTypes);
            const values = Object.values(data.pathwayTypes);

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: [
                            '#FF6384',
                            '#36A2EB',
                            '#FFCE56',
                            '#4BC0C0',
                            '#9966FF',
                            '#FF9F40'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function displayOptimizationRecommendations(data) {
            const container = document.getElementById('optimizationRecommendations');
            if (!container) return;

            container.innerHTML = data.recommendations.map(rec => 
                `<div class="recommendation-item">${rec}</div>`
            ).join('');
        }

        function generatePathwayRecommendations(pathwayTypes, averageReturn) {
            const recommendations = [];
            
            if (Object.keys(pathwayTypes).length > 5) {
                recommendations.push('יש לך יותר מדי מסלולי השקעה - שקול לאחד מסלולים דומים');
            }
            
            if (averageReturn < 3) {
                recommendations.push('התשואות נמוכות - שקול להעביר למסלולים עם פוטנציאל תשואה גבוה יותר');
            }
            
            if (Object.keys(pathwayTypes).length < 2) {
                recommendations.push('יש לך מעט מדי מסלולי השקעה - שקול לגוון את התיק');
            }
            
            return recommendations.length > 0 ? recommendations : ['התיק שלך מאוזן ומגוון'];
        }

        function analyzeReturns() {
            const returnsData = calculateReturnsAnalysis();
            displayReturnsChart(returnsData);
            displayMarketComparison(returnsData);
        }

        function analyzeFees() {
            const feesData = calculateFeesAnalysis();
            displayFeesChart(feesData);
            displayFeesImpact(feesData);
        }

        function analyzeLiquidity() {
            const liquidityData = calculateLiquidityAnalysis();
            displayLiquidityChart(liquidityData);
            displayAvailabilityTable(liquidityData);
        }

        function analyzeRetirement() {
            console.log('Starting retirement analysis...');
            console.log('dataMislaka:', dataMislaka);
            
            const retirementData = calculateRetirementAnalysis();
            console.log('Retirement data calculated:', retirementData);
            
            displayRetirementAccumulation(retirementData);
            displayRetirementPensions(retirementData);
            displayRetirementAgeCalculation(retirementData);
            displayRetirementRecommendations(retirementData);
            
            console.log('Retirement analysis completed');
        }

        function calculateRetirementAnalysis() {
            if (!dataMislaka || !dataMislaka.data) {
                console.log('No dataMislaka or data found');
                return {
                    currentAge: 0,
                    retirementAge: 0,
                    yearsToRetirement: 0,
                    currentBalance: 0,
                    projectedBalance: 0,
                    monthlyPension: 0,
                    annualPension: 0,
                    pensionReplacementRate: 0
                };
            }

            console.log('dataMislaka found:', dataMislaka);
            console.log('dataMislaka.data:', dataMislaka.data);

            // Extract participant info from all files
            let participantInfo = null;
            let birthDate = null;
            let currentAge = 35; // Default age
            
            // Search through all files for participant info
            for (const fileData of dataMislaka.data) {
                console.log('Processing file:', fileData.fileName);
                console.log('File data:', fileData.data);
                
                if (fileData.data && fileData.data.participantInfo) {
                    participantInfo = fileData.data.participantInfo;
                    birthDate = participantInfo.taarichLeyda;
                    console.log('Found participant info:', participantInfo);
                    console.log('Found birth date:', birthDate);
                    if (birthDate) break; // Found birth date, stop searching
                }
            }
            
            // Calculate current age
            if (birthDate && birthDate.length >= 8) {
                const year = parseInt(birthDate.substring(0, 4));
                const month = parseInt(birthDate.substring(4, 6));
                const day = parseInt(birthDate.substring(6, 8));
                const birthDateObj = new Date(year, month - 1, day);
                const today = new Date();
                currentAge = today.getFullYear() - birthDateObj.getFullYear();
                if (today.getMonth() < birthDateObj.getMonth() || 
                    (today.getMonth() === birthDateObj.getMonth() && today.getDate() < birthDateObj.getDate())) {
                    currentAge--;
                }
                console.log('Calculated age from birth date:', currentAge);
            } else {
                console.log('No birth date found, using default age:', currentAge);
            }

            // Default retirement age (67 for men, 62 for women - simplified)
            const retirementAge = 67;
            const yearsToRetirement = Math.max(0, retirementAge - currentAge);

            // Calculate current balance
            const currentBalance = dataMislaka.summary ? dataMislaka.summary.totalBalance : 0;
            console.log('Current balance:', currentBalance);

            // Project future balance based on product types
            let projectedBalanceWithContributions = 0;
            let projectedBalanceWithoutContributions = 0;
            let monthlyPensionWithContributions = 0;
            let monthlyPensionWithoutContributions = 0;
            
            // Calculate based on actual data from PDF
            let productDetails = [];
            
            if (dataMislaka.data && dataMislaka.data.length > 0) {
                console.log('Processing financial data...');
                
                // Group by product type
                let productGroups = {};
                
                for (const fileData of dataMislaka.data) {
                    console.log('Processing file for retirement:', fileData.fileName);
                    
                    if (fileData.data && fileData.data.accounts && fileData.data.accounts.length > 0) {
                        console.log('Found accounts:', fileData.data.accounts.length);
                        
                        for (const account of fileData.data.accounts) {
                            const sugMutzar = account.sugMutzar;
                            const sugMutzarDescription = account.sugMutzarDescription;
                            
                            console.log('Processing account:', sugMutzarDescription);
                            
                            // Calculate current balance for this account
                            let accountBalance = 0;
                            if (account.balances && account.balances.length > 0) {
                                account.balances.forEach(balance => {
                                    accountBalance += balance.totalErkeiPidion || 0;
                                });
                            }
                            
                            console.log('Account balance:', accountBalance);
                            
                            // Group by product type
                            if (!productGroups[sugMutzarDescription]) {
                                productGroups[sugMutzarDescription] = {
                                    productType: sugMutzarDescription,
                                    currentBalance: 0,
                                    projectedWithoutContributions: 0,
                                    projectedWithContributions: 0,
                                    monthlyPensionWithoutContributions: 0,
                                    monthlyPensionWithContributions: 0,
                                    pensionRelevant: true,
                                    hasYitraLefiGilPrisha: false
                                };
                            }
                            
                            productGroups[sugMutzarDescription].currentBalance += accountBalance;
                            
                            // Check if has YitraLefiGilPrisha block
                            let hasYitraBlock = false;
                            let yitraData = null;
                            
                            // Search for YitraLefiGilPrisha in the account data
                            if (account.yitraLefiGilPrisha) {
                                hasYitraBlock = true;
                                yitraData = account.yitraLefiGilPrisha;
                                productGroups[sugMutzarDescription].hasYitraLefiGilPrisha = true;
                                console.log('Found YitraLefiGilPrisha data:', yitraData);
                                console.log('TOTAL-CHISACHON-MITZTABER-TZAFUY:', yitraData.totalChisachonMitztaberTzafuy);
                                console.log('TZVIRAT-CHISACHON-CHAZUYA-LELO-PREMIYOT:', yitraData.tzviratChisachonChzuyaLeloPremiyot);
                                console.log('Type of totalChisachonMitztaberTzafuy:', typeof yitraData.totalChisachonMitztaberTzafuy);
                                console.log('Type of tzviratChisachonChzuyaLeloPremiyot:', typeof yitraData.tzviratChisachonChzuyaLeloPremiyot);
                            }
                            
                            // Calculate projections based on product type and Yitra block
                            if (sugMutzarDescription === 'קרן פנסיה ותיקה') {
                                if (hasYitraBlock && yitraData) {
                                    // Use data from YitraLefiGilPrisha block
                                    const totalChisachonMitztaberTzafuy = yitraData.totalChisachonMitztaberTzafuy || 0;
                                    const tzviratChisachonChzuyaLeloPremiyot = yitraData.tzviratChisachonChzuyaLeloPremiyot || 0;
                                    
                                    console.log('Using Yitra data for קרן פנסיה ותיקה:');
                                    console.log('totalChisachonMitztaberTzafuy:', totalChisachonMitztaberTzafuy);
                                    console.log('tzviratChisachonChzuyaLeloPremiyot:', tzviratChisachonChzuyaLeloPremiyot);
                                    
                                    productGroups[sugMutzarDescription].projectedWithContributions += totalChisachonMitztaberTzafuy;
                                    productGroups[sugMutzarDescription].projectedWithoutContributions += tzviratChisachonChzuyaLeloPremiyot;
                                    
                                    // Get pension data from Kupot
                                    if (yitraData.kupot && yitraData.kupot.length > 0) {
                                        for (const kupa of yitraData.kupot) {
                                            const schumKitzvatZikna = kupa.schumKitzvatZikna || 0;
                                            const kitzvatHodshitTzfuya = kupa.kitzvatHodshitTzfuya || 0;
                                            
                                            productGroups[sugMutzarDescription].monthlyPensionWithContributions += schumKitzvatZikna;
                                            productGroups[sugMutzarDescription].monthlyPensionWithoutContributions += kitzvatHodshitTzfuya;
                                        }
                                    }
                                } else {
                                    // No Yitra block - use default calculation
                                    productGroups[sugMutzarDescription].projectedWithoutContributions += accountBalance;
                                    productGroups[sugMutzarDescription].monthlyPensionWithoutContributions += accountBalance * 0.001; // 0.1% monthly
                                }
                            } else if (sugMutzarDescription === 'קרן פנסיה חדשה') {
                                if (hasYitraBlock && yitraData) {
                                    // Use data from YitraLefiGilPrisha block
                                    const totalChisachonMitztaberTzafuy = yitraData.totalChisachonMitztaberTzafuy || 0;
                                    const tzviratChisachonChzuyaLeloPremiyot = yitraData.tzviratChisachonChzuyaLeloPremiyot || 0;
                                    
                                    console.log('Using Yitra data for קרן פנסיה חדשה:');
                                    console.log('totalChisachonMitztaberTzafuy:', totalChisachonMitztaberTzafuy);
                                    console.log('tzviratChisachonChzuyaLeloPremiyot:', tzviratChisachonChzuyaLeloPremiyot);
                                    
                                    productGroups[sugMutzarDescription].projectedWithContributions += totalChisachonMitztaberTzafuy;
                                    productGroups[sugMutzarDescription].projectedWithoutContributions += tzviratChisachonChzuyaLeloPremiyot;
                                    
                                    // Get pension data from Kupot
                                    if (yitraData.kupot && yitraData.kupot.length > 0) {
                                        for (const kupa of yitraData.kupot) {
                                            const schumKitzvatZikna = kupa.schumKitzvatZikna || 0;
                                            const kitzvatHodshitTzfuya = kupa.kitzvatHodshitTzfuya || 0;
                                            
                                            productGroups[sugMutzarDescription].monthlyPensionWithContributions += schumKitzvatZikna;
                                            productGroups[sugMutzarDescription].monthlyPensionWithoutContributions += kitzvatHodshitTzfuya;
                                        }
                                    }
                                } else {
                                    // No Yitra block - use default calculation
                                    const annualReturn = 0.06; // 6% annual return
                                    const monthlyContribution = 1500; // Estimated monthly contribution
                                    const annualContribution = monthlyContribution * 12;
                                    
                                    let projectedBalance = accountBalance;
                                    for (let i = 0; i < yearsToRetirement; i++) {
                                        projectedBalance = projectedBalance * (1 + annualReturn) + annualContribution;
                                    }
                                    
                                    productGroups[sugMutzarDescription].projectedWithContributions += projectedBalance;
                                    productGroups[sugMutzarDescription].monthlyPensionWithContributions += projectedBalance * 0.004; // 4% withdrawal rate
                                    
                                    // Also add without contributions
                                    productGroups[sugMutzarDescription].projectedWithoutContributions += accountBalance;
                                    productGroups[sugMutzarDescription].monthlyPensionWithoutContributions += accountBalance * 0.004;
                                }
                            } else if (sugMutzarDescription === 'קופת גמל' || sugMutzarDescription === 'קופת גמל להשקעה') {
                                // קופות גמל
                                if (hasYitraBlock && yitraData) {
                                    // Has Yitra block - use existing data
                                    const totalChisachonMitztaberTzafuy = yitraData.totalChisachonMitztaberTzafuy || 0;
                                    const tzviratChisachonChzuyaLeloPremiyot = yitraData.tzviratChisachonChzuyaLeloPremiyot || 0;
                                    
                                    productGroups[sugMutzarDescription].projectedWithContributions += totalChisachonMitztaberTzafuy;
                                    productGroups[sugMutzarDescription].projectedWithoutContributions += tzviratChisachonChzuyaLeloPremiyot;
                                } else {
                                    // No Yitra block - use current balance
                                    productGroups[sugMutzarDescription].projectedWithoutContributions += accountBalance;
                                    productGroups[sugMutzarDescription].projectedWithContributions += accountBalance;
                                }
                                productGroups[sugMutzarDescription].pensionRelevant = false; // Not relevant for pensions
                            } else if (sugMutzarDescription === 'קרן השתלמות') {
                                // קרן השתלמות
                                if (hasYitraBlock && yitraData) {
                                    // Has Yitra block - use existing data
                                    const totalChisachonMitztaberTzafuy = yitraData.totalChisachonMitztaberTzafuy || 0;
                                    const tzviratChisachonChzuyaLeloPremiyot = yitraData.tzviratChisachonChzuyaLeloPremiyot || 0;
                                    
                                    productGroups[sugMutzarDescription].projectedWithContributions += totalChisachonMitztaberTzafuy;
                                    productGroups[sugMutzarDescription].projectedWithoutContributions += tzviratChisachonChzuyaLeloPremiyot;
                                } else {
                                    // No Yitra block - use current balance
                                    productGroups[sugMutzarDescription].projectedWithoutContributions += accountBalance;
                                    productGroups[sugMutzarDescription].projectedWithContributions += accountBalance;
                                }
                                productGroups[sugMutzarDescription].pensionRelevant = false; // Not relevant for pensions
                            } else {
                                // Other products (insurance companies) - with contributions
                                const annualReturn = 0.05;
                                const monthlyContribution = 1000;
                                const annualContribution = monthlyContribution * 12;
                                
                                let projectedBalance = accountBalance;
                                for (let i = 0; i < yearsToRetirement; i++) {
                                    projectedBalance = projectedBalance * (1 + annualReturn) + annualContribution;
                                }
                                
                                productGroups[sugMutzarDescription].projectedWithContributions += projectedBalance;
                                productGroups[sugMutzarDescription].monthlyPensionWithContributions += projectedBalance * 0.004;
                                
                                productGroups[sugMutzarDescription].projectedWithoutContributions += accountBalance;
                                productGroups[sugMutzarDescription].monthlyPensionWithoutContributions += accountBalance * 0.004;
                            }
                        }
                    } else {
                        console.log('No accounts found in file:', fileData.fileName);
                    }
                }
                
                // Convert to array
                productDetails = Object.values(productGroups);
                
                // Calculate totals
                for (const product of productDetails) {
                    projectedBalanceWithContributions += product.projectedWithContributions;
                    projectedBalanceWithoutContributions += product.projectedWithoutContributions;
                    monthlyPensionWithContributions += product.monthlyPensionWithContributions;
                    monthlyPensionWithoutContributions += product.monthlyPensionWithoutContributions;
                }
                
            } else {
                console.log('No data found for retirement calculation');
            }
            
            console.log('Projected balance with contributions:', projectedBalanceWithContributions);
            console.log('Projected balance without contributions:', projectedBalanceWithoutContributions);
            console.log('Monthly pension with contributions:', monthlyPensionWithContributions);
            console.log('Monthly pension without contributions:', monthlyPensionWithoutContributions);
            
            // Use the higher value (with contributions) as the main projection
            const projectedBalance = Math.max(projectedBalanceWithContributions, projectedBalanceWithoutContributions);
            const monthlyPension = Math.max(monthlyPensionWithContributions, monthlyPensionWithoutContributions);
            const annualPension = monthlyPension * 12;
            
            // Calculate replacement rate (assuming current income)
            const currentIncome = 15000; // Default assumption
            const pensionReplacementRate = (monthlyPension / currentIncome) * 100;

            return {
                currentAge,
                retirementAge,
                yearsToRetirement,
                currentBalance,
                projectedBalance,
                projectedBalanceWithContributions,
                projectedBalanceWithoutContributions,
                monthlyPension,
                monthlyPensionWithContributions,
                monthlyPensionWithoutContributions,
                annualPension,
                pensionReplacementRate,
                productDetails,
                monthlyContribution: 1500, // Default assumption
                annualContribution: 1500 * 12
            };
        }

        function displayRetirementAccumulation(data) {
            const container = document.getElementById('retirementAccumulation');
            console.log('Retirement accumulation data:', data);
            
            let html = '<div class="retirement-summary">';
            html += '<h4>סיכום כללי</h4>';
            html += `<div class="retirement-item">
                <span class="retirement-label">יתרה נוכחית:</span>
                <span class="retirement-value"><span class="currency-value">${new Intl.NumberFormat('he-IL', {style: 'currency', currency: 'ILS'}).format(data.currentBalance).replace('₪', '₪ ').trim()}</span></span>
            </div>`;
            html += `<div class="retirement-item">
                <span class="retirement-label">שנים עד פרישה:</span>
                <span class="retirement-value">${data.yearsToRetirement} שנים</span>
            </div>`;
            html += '</div>';

            html += '<div class="retirement-details">';
            html += '<h4>פירוט לפי סוג מוצר</h4>';
            html += '<table class="data-table" dir="rtl">';
            html += '<thead><tr><th>סוג מוצר</th><th>יתרה נוכחית</th><th>צבירה צפויה (ללא הפקדות)</th><th>צבירה צפויה (עם הפקדות)</th></tr></thead>';
            html += '<tbody>';

            if (data.productDetails) {
                for (const product of data.productDetails) {
                    const currentBalanceFormatted = new Intl.NumberFormat('he-IL', {style: 'currency', currency: 'ILS'}).format(product.currentBalance).replace('₪', '₪ ').trim();
                    const projectedWithoutFormatted = new Intl.NumberFormat('he-IL', {style: 'currency', currency: 'ILS'}).format(product.projectedWithoutContributions).replace('₪', '₪ ').trim();
                    const projectedWithFormatted = new Intl.NumberFormat('he-IL', {style: 'currency', currency: 'ILS'}).format(product.projectedWithContributions).replace('₪', '₪ ').trim();
                    
                    html += `<tr>
                        <td><span class="product-type">${product.productType}</span></td>
                        <td><span class="currency-value">${currentBalanceFormatted}</span></td>
                        <td><span class="currency-value">${projectedWithoutFormatted}</span></td>
                        <td><span class="currency-value">${projectedWithFormatted}</span></td>
                    </tr>`;
                }
            }

            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        function displayRetirementPensions(data) {
            const container = document.getElementById('retirementPensions');
            
            let html = '<div class="retirement-summary">';
            html += '<h4>סיכום קצבאות</h4>';
            html += `<div class="retirement-item">
                <span class="retirement-label">קצבה חודשית (עם הפקדות):</span>
                <span class="retirement-value"><span class="currency-value">${new Intl.NumberFormat('he-IL', {style: 'currency', currency: 'ILS'}).format(data.monthlyPensionWithContributions).replace('₪', '₪ ').trim()}</span></span>
            </div>`;
            html += `<div class="retirement-item">
                <span class="retirement-label">קצבה חודשית (ללא הפקדות):</span>
                <span class="retirement-value"><span class="currency-value">${new Intl.NumberFormat('he-IL', {style: 'currency', currency: 'ILS'}).format(data.monthlyPensionWithoutContributions).replace('₪', '₪ ').trim()}</span></span>
            </div>`;
            html += '</div>';

            html += '<div class="retirement-details">';
            html += '<h4>פירוט קצבאות לפי סוג מוצר</h4>';
            html += '<table class="data-table" dir="rtl">';
            html += '<thead><tr><th>סוג מוצר</th><th>קצבה חודשית (ללא הפקדות)</th><th>קצבה חודשית (עם הפקדות)</th><th>הערות</th></tr></thead>';
            html += '<tbody>';

            if (data.productDetails) {
                for (const product of data.productDetails) {
                    const monthlyPensionWithout = product.monthlyPensionWithoutContributions || 0;
                    const monthlyPensionWith = product.monthlyPensionWithContributions || 0;
                    const notes = product.pensionRelevant ? '' : 'לא רלוונטי';
                    
                    const pensionWithoutFormatted = monthlyPensionWithout > 0 ? 
                        new Intl.NumberFormat('he-IL', {style: 'currency', currency: 'ILS'}).format(monthlyPensionWithout).replace('₪', '₪ ').trim() : 
                        `<span class="not-relevant">${notes}</span>`;
                    
                    const pensionWithFormatted = monthlyPensionWith > 0 ? 
                        new Intl.NumberFormat('he-IL', {style: 'currency', currency: 'ILS'}).format(monthlyPensionWith).replace('₪', '₪ ').trim() : 
                        `<span class="not-relevant">${notes}</span>`;
                    
                    html += `<tr>
                        <td><span class="product-type">${product.productType}</span></td>
                        <td>${monthlyPensionWithout > 0 ? `<span class="currency-value">${pensionWithoutFormatted}</span>` : pensionWithoutFormatted}</td>
                        <td>${monthlyPensionWith > 0 ? `<span class="currency-value">${pensionWithFormatted}</span>` : pensionWithFormatted}</td>
                        <td><span class="not-relevant">${notes}</span></td>
                    </tr>`;
                }
            }

            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        function displayRetirementAgeCalculation(data) {
            const container = document.getElementById('retirementAgeCalculation');
            
            container.innerHTML = `
                <div class="retirement-item">
                    <span class="retirement-label">גיל נוכחי:</span>
                    <span class="retirement-value">${data.currentAge} שנים</span>
                </div>
                <div class="retirement-item">
                    <span class="retirement-label">גיל פרישה:</span>
                    <span class="retirement-value">${data.retirementAge} שנים</span>
                </div>
                <div class="retirement-item">
                    <span class="retirement-label">שנים עד פרישה:</span>
                    <span class="retirement-value">${data.yearsToRetirement} שנים</span>
                </div>
                <div class="retirement-item">
                    <span class="retirement-label">תאריך פרישה משוער:</span>
                    <span class="retirement-value">${new Date().getFullYear() + data.yearsToRetirement}</span>
                </div>
            `;
        }

        function displayRetirementRecommendations(data) {
            const container = document.getElementById('retirementRecommendations');
            
            let recommendations = [];
            
            if (data.pensionReplacementRate < 70) {
                recommendations.push('מומלץ להגדיל את ההפקדות החודשיות');
            }
            
            if (data.yearsToRetirement < 10) {
                recommendations.push('יש להתחיל לתכנן את הפרישה בקרוב');
            }
            
            if (data.currentBalance < 500000) {
                recommendations.push('מומלץ לבדוק אפשרויות השקעה נוספות');
            }
            
            if (recommendations.length === 0) {
                recommendations.push('התיק שלך מאוזן היטב לפרישה');
            }
            
            container.innerHTML = `
                <div class="recommendations">
                    ${recommendations.map(rec => `<p>• ${rec}</p>`).join('')}
                </div>
            `;
        }

        function generateSummary() {
            const summaryData = calculateOverallSummary();
            displayOverallScore(summaryData);
            displayMainRecommendations(summaryData);
        }

        function calculateReturnsAnalysis() {
            // Mock data for demonstration - replace with real calculations
            return {
                productReturns: {
                    'קרן פנסיה': 6.2,
                    'קופת גמל': 5.8,
                    'קרן השתלמות': 4.5
                },
                marketAverage: 5.5,
                benchmark: 5.8
            };
        }

        function calculateFeesAnalysis() {
            return {
                annualFees: {
                    'קרן פנסיה': 1.2,
                    'קופת גמל': 0.8,
                    'קרן השתלמות': 0.6
                },
                impactOnReturns: {
                    'קרן פנסיה': -0.8,
                    'קופת גמל': -0.5,
                    'קרן השתלמות': -0.3
                }
            };
        }

        function calculateLiquidityAnalysis() {
            return {
                liquid: 35,
                semiLiquid: 45,
                illiquid: 20,
                availability: {
                    'מיידי': 15,
                    '30 יום': 20,
                    '90 יום': 30,
                    'שנה+': 35
                }
            };
        }

        function calculatePathwaysAnalysis() {
            return {
                pathways: {
                    'שמרני': 25,
                    'מאוזן': 45,
                    'אגרסיבי': 30
                },
                recommendations: [
                    'הגדלת החלק האגרסיבי ל-40%',
                    'הפחתת דמי ניהול',
                    'פיזור טוב יותר בין המוצרים'
                ]
            };
        }

        function calculateOverallSummary() {
            return {
                score: 78,
                recommendations: [
                    'התיק שלך מאוזן היטב',
                    'יש מקום לשיפור בתשואות',
                    'דמי הניהול סבירים',
                    'מומלץ לבדוק מסלולים נוספים'
                ]
            };
        }

        function displayReturnsChart(data) {
            const container = document.getElementById('returnsChart');
            container.innerHTML = '<canvas id="returnsChartCanvas"></canvas>';
            
            const ctx = document.getElementById('returnsChartCanvas').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(data.productReturns),
                    datasets: [{
                        label: 'תשואה שנתית (%)',
                        data: Object.values(data.productReturns),
                        backgroundColor: chartColors.slice(0, Object.keys(data.productReturns).length)
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        function displayMarketComparison(data) {
            const container = document.getElementById('marketComparison');
            let tableHTML = '<table class="data-table"><tr><th>מוצר</th><th>תשואה שלך</th><th>ממוצע שוק</th><th>הפרש</th></tr>';
            
            Object.entries(data.productReturns).forEach(([product, returnValue]) => {
                const isHigher = returnValue > data.marketAverage;
                const difference = (returnValue - data.marketAverage).toFixed(1);
                const color = isHigher ? 'green' : 'red';
                const sign = isHigher ? '+' : '';
                
                tableHTML += `<tr>
                    <td>${product}</td>
                    <td>${returnValue}%</td>
                    <td>${data.marketAverage}%</td>
                    <td style="color: ${color}">${sign}${difference}%</td>
                </tr>`;
            });
            
            tableHTML += '</table>';
            container.innerHTML = tableHTML;
        }

        function displayFeesChart(data) {
            const container = document.getElementById('feesChart');
            container.innerHTML = '<canvas id="feesChartCanvas"></canvas>';
            
            const ctx = document.getElementById('feesChartCanvas').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(data.annualFees),
                    datasets: [{
                        data: Object.values(data.annualFees),
                        backgroundColor: chartColors.slice(0, Object.keys(data.annualFees).length)
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        function displayFeesImpact(data) {
            const container = document.getElementById('feesImpact');
            let html = '<div class="recommendations"><h5>השפעת דמי ניהול על התשואה:</h5>';
            
            Object.entries(data.impactOnReturns).forEach(([product, impact]) => {
                html += `<p><strong>${product}:</strong> ${impact}% פחות תשואה שנתית</p>`;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function displayLiquidityChart(data) {
            const container = document.getElementById('liquidityChart');
            container.innerHTML = '<canvas id="liquidityChartCanvas"></canvas>';
            
            const ctx = document.getElementById('liquidityChartCanvas').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['נזיל', 'חצי נזיל', 'לא נזיל'],
                    datasets: [{
                        data: [data.liquid, data.semiLiquid, data.illiquid],
                        backgroundColor: ['#28a745', '#ffc107', '#dc3545']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        function displayAvailabilityTable(data) {
            const container = document.getElementById('availabilityTable');
            let tableHTML = '<table class="data-table"><tr><th>זמינות</th><th>אחוז</th><th>סכום משוער</th></tr>';
            
            Object.entries(data.availability).forEach(([period, percentage]) => {
                const amount = (dataMislaka.summary.totalBalance * percentage / 100).toLocaleString();
                tableHTML += `<tr>
                    <td>${period}</td>
                    <td>${percentage}%</td>
                    <td>₪ ${amount}</td>
                </tr>`;
            });
            
            tableHTML += '</table>';
            container.innerHTML = tableHTML;
        }

        function displayPathwaysChart(data) {
            const container = document.getElementById('pathwaysChart');
            container.innerHTML = '<canvas id="pathwaysChartCanvas"></canvas>';
            
            const ctx = document.getElementById('pathwaysChartCanvas').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(data.pathways),
                    datasets: [{
                        label: 'אחוז מהתיק',
                        data: Object.values(data.pathways),
                        backgroundColor: ['#28a745', '#ffc107', '#dc3545']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        function displayOptimizationRecommendations(data) {
            const container = document.getElementById('optimizationRecommendations');
            let html = '<div class="recommendations"><h5>המלצות אופטימיזציה:</h5>';
            
            data.recommendations.forEach(rec => {
                html += `<p>• ${rec}</p>`;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function displayOverallScore(data) {
            const container = document.getElementById('overallScore');
            container.innerHTML = `
                <div class="score-display">${data.score}</div>
                <p>ציון כללי מתוך 100</p>
            `;
        }

        function displayMainRecommendations(data) {
            const container = document.getElementById('mainRecommendations');
            let html = '<div class="recommendations-list">';
            
            data.recommendations.forEach(rec => {
                html += `<p>• ${rec}</p>`;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function switchTab(tabName) {
            // Remove active class from all tabs and panels
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
            
            // Add active class to selected tab and panel
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        function exportAnalysisData() {
            if (!dataMislaka) {
                alert('אין נתונים לייצוא');
                return;
            }
            
            const exportData = {
                ...dataMislaka,
                analysis: {
                    returns: calculateReturnsAnalysis(),
                    fees: calculateFeesAnalysis(),
                    liquidity: calculateLiquidityAnalysis(),
                    pathways: calculatePathwaysAnalysis(),
                    summary: calculateOverallSummary()
                },
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `pension_analysis_${dataMislaka.idNumber}_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function generatePDFReport() {
            alert('פונקציית יצירת דוח PDF תהיה זמינה בקרוב');
        }
        
        // Global functions to access dataMislaka
        window.getDataMislaka = function() {
            return dataMislaka;
        };
        
        window.hasDataMislaka = function() {
            return dataMislaka !== null;
        };
        
        window.clearDataMislaka = function() {
            dataMislaka = null;
            console.log('נתוני המסלקה נוקו ידנית');
        };

        // פונקציות לטופס ייעוץ פנסיוני
        function openConsultationForm() {
            const modal = document.getElementById('consultationFormModal');
            modal.classList.add('show');
            document.body.style.overflow = 'hidden'; // מונע גלילה ברקע
        }

        function closeConsultationForm() {
            const modal = document.getElementById('consultationFormModal');
            modal.classList.remove('show');
            document.body.style.overflow = 'auto'; // מחזיר גלילה
            // ניקוי הטופס
            document.getElementById('consultationForm').reset();
        }
        
        // פונקציות להצגת והסתרת Modal ההשוואה
        function showComparisonModal() {
            const modal = document.getElementById('comparisonModal');
            modal.classList.add('show');
            document.body.style.overflow = 'hidden'; // מונע גלילה ברקע
            
            // טעינת נתוני המסלולים המובילים
            loadTopPerformers();
        }
        
        function loadTopPerformers() {
            // המתנה לטעינת הנתונים
            if (typeof datanetunimKlaliXM === 'undefined' || !datanetunimKlaliXM) {
                setTimeout(loadTopPerformers, 500);
                return;
            }
            
            // סינון רק קופות גמל להשקעה
            const gemelData = datanetunimKlaliXM.filter(item => 
                item.mozar === 'קופת גמל להשקעה' &&
                item.tesuam !== undefined &&
                item.tesuam !== null &&
                !isNaN(item.tesuam)
            );
            
            // מיון לפי תשואה שנתית (tesuam) - מהגבוה לנמוך
            gemelData.sort((a, b) => b.tesuam - a.tesuam);
            
            // לקיחת 5 הראשונים
            const top5 = gemelData.slice(0, 5);
            
            // יצירת HTML לטבלה
            let tableHTML = `
                <table class="performers-table" dir="rtl">
                    <thead>
                        <tr>
                            <th>דירוג</th>
                            <th class="mh-column">מ"ה</th>
                            <th>שם המסלול</th>
                            <th>חברה מנהלת</th>
                            <th>תשואה שנתית</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            top5.forEach((item, index) => {
                const rank = index + 1;
                const returnPercentage = item.tesuam.toFixed(2);
                
                tableHTML += `
                    <tr>
                        <td class="rank-cell">${rank}</td>
                        <td class="mh-column">${item.mh}</td>
                        <td class="name-cell">${item.shemkupa}</td>
                        <td class="company-cell">${item.menahelet}</td>
                        <td class="return-cell">${returnPercentage}%</td>
                    </tr>
                `;
            });
            
            tableHTML += `
                    </tbody>
                </table>
                <p style="text-align: center; margin-top: 1rem; color: #666; font-size: 0.9rem;">
                    * נתונים מבוססים על תשואה ל-12 חודשים אחרונים
                </p>
            `;
            
            // הצגת הטבלה
            document.getElementById('topPerformersContainer').innerHTML = tableHTML;
        }
        
        function closeComparisonModal() {
            const modal = document.getElementById('comparisonModal');
            modal.classList.remove('show');
            document.body.style.overflow = 'auto'; // מחזיר גלילה
        }
        
        // סגירת ה-modal בלחיצה על הרקע
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('comparisonModal');
            if (e.target === modal) {
                closeComparisonModal();
            }
        });

        // טיפול בשליחת הטופס
        document.addEventListener('DOMContentLoaded', function() {
            const consultationForm = document.getElementById('consultationForm');
            if (consultationForm) {
                consultationForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const fullName = document.getElementById('fullName').value;
                    const phoneNumber = document.getElementById('phoneNumber').value;
                    const email = document.getElementById('email').value;
                    const message = document.getElementById('message').value;
                    
                    // כאן תוכל להוסיף לוגיקה לשליחת הנתונים לשרת
                    console.log('פרטי ייעוץ פנסיוני:', {
                        fullName: fullName,
                        phoneNumber: phoneNumber,
                        email: email,
                        message: message,
                        timestamp: new Date().toISOString()
                    });
                    
                    // הודעת הצלחה
                    alert('תודה! פרטיך נשלחו בהצלחה. נחזור אליך תוך 24 שעות.');
                    
                    // סגירת הטופס
                    closeConsultationForm();
                });
            }
            
            // סגירת הטופס בלחיצה על הרקע
            const modal = document.getElementById('consultationFormModal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeConsultationForm();
                    }
                });
            }
        });
       
        // פונקציה להצגת הנתונים על המסך
        function displayDataOnScreen(pratimIshim, sumSugMutzar, pathwaySummary, statusData, pitzuimData) {
            // הצגת הפרטים האישיים
            const personalInfoDiv = document.getElementById('personalInfo');
            personalInfoDiv.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <strong>👤 שם פרטי:</strong> ${pratimIshim.shemPrati || 'לא זמין'}
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>👥 שם משפחה:</strong> ${pratimIshim.shemMishpacha || 'לא זמין'}
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>🆔 מספר זיהוי:</strong> ${pratimIshim.misparZihuyLakoach || 'לא זמין'}
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>🎂 גיל:</strong> ${pratimIshim.gil || 'לא זמין'}
                </div>

                <div style="margin-bottom: 15px;">
                    <strong>📱 מספר סלולרי:</strong> ${pratimIshim.misparCellulari || 'לא זמין'}
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>📧 כתובת דו"אל:</strong> ${pratimIshim.eMail || 'לא זמין'}
                </div>
            `;

            // הוספת אלמנט שיווקי לקבלת ייעוץ פנסיוני
            personalInfoDiv.innerHTML += `
                <div style="margin-top: 35px; padding: 20px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 15px; text-align: center;
                 color: white; box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);">
                    <div style="font-size: 2.5rem; margin-bottom: 15px;">💼</div>
                    <h4 style="font-size: 1.3rem; margin-bottom: 10px; font-weight: bold;">רוצה ייעוץ פנסיוני מקצועי?</h4>
                    <p style="font-size: 1rem; margin-bottom: 20px; opacity: 0.9; line-height: 1.5;">
                        קבל ייעוץ אישי מותאם לפרופיל הפיננסי שלך<br>
                        ובדוק אם אתה מנצל את כל הזכויות שלך
                    </p>
                    <button onclick="openConsultationForm()" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid rgba(255,255,255,0.3); padding: 12px 30px; border-radius: 25px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; backdrop-filter: blur(10px);">
                        📞 קבל ייעוץ פנסיוני
                    </button>
                </div>
            `;

            // יצירת גרף עוגה תלת מימד
            createPieChart(sumSugMutzar);

            // יצירת טבלה מפורטת
            createDetailedTable(sumSugMutzar);

            // יצירת טבלת סיכום לפי מסלול ומוצר
            createPathwaySummaryTable(pathwaySummary);

            // יצירת טבלת פיצויים
            createPitzuimTable(pitzuimData);

            // יצירת טבלת סטטוס שעבוד, עיקול, הלוואה ותביעה
             createStatusTable(statusData);
            

            

            // הצגת התצוגה
            document.getElementById('dataDisplayContainer').style.display = 'block';
            
            // הפעלת כפתור ניתוח מתקדם לאחר טעינת הנתונים
            const advBtns = document.querySelectorAll('#advancedAnalysisBtnMain2, #advancedAnalysisBtn');
            advBtns.forEach(btn => {
                if (btn) {
                    btn.disabled = false;
                    btn.style.opacity = '1';
                    btn.style.cursor = 'pointer';
                }
            });
            console.log('✅ כפתור ניתוח מתקדם הופעל');
        }

        // פונקציה ליצירת גרף עוגה תלת מימד
        function createPieChart(sumSugMutzar) {
            const ctx = document.getElementById('pieChart').getContext('2d');
            
            // הכנת נתונים לגרף
            const chartData = [];
            const chartLabels = [];
            const colors = [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
                '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0', '#FF6384'
            ];

            const shemTochnit = {
                '1': 'פוליסת ביטוח חיים משולב חיסכון',
                '2': 'קרן פנסיה',
                '2_1': 'קרן פנסיה ותיקה - ותיקה',
                '2_2': 'קרן פנסיה ותיקה - חדשה',
                '3': 'קופת גמל',
                '4': 'קרן השתלמות',
                '5': 'פוליסת חיסכון טהור',
                '6': 'פוליסת סיכון טהור',
                '7': 'ביטוח חיים משכנתא',
                '8': 'פוליסת סיכון טהור קולקטיב',
                '9': 'קופת גמל להשקעה',
                '10': 'חיסכון לכל ילד'
            };

            let colorIndex = 0;
            for (let key in sumSugMutzar) {
                // בדיקה אם זה מערך או ערך יחיד
                let value = 0;
                if (Array.isArray(sumSugMutzar[key])) {
                    value = sumSugMutzar[key][0] || 0;
                } else {
                    value = sumSugMutzar[key] || 0;
                }
                
                // המרה מפורמט מחרוזת למספר אם נדרש
                if (typeof value === 'string') {
                    // הסרת תווים לא מספריים
                    const numericValue = parseFloat(value.replace(/[^\d.-]/g, ''));
                    value = isNaN(numericValue) ? 0 : numericValue;
                }
                
               
                
                if (value > 0) {
                    chartLabels.push(shemTochnit[key] || 'לא ידוע');
                    chartData.push(value);
                    colorIndex++;
                }
            }

            

            // בדיקה אם יש נתונים להצגה
            if (chartData.length === 0) {
                ctx.fillStyle = '#666';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('אין נתונים להצגה', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }

            // יצירת הגרף
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        data: chartData,
                        backgroundColor: colors.slice(0, chartData.length),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false // נסתיר את המקרא הרגיל
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${context.label}: ₪${value.toLocaleString('he-IL')} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateRotate: true,
                        animateScale: true,
                        duration: 2000
                    }
                }
            });

            // יצירת מקרא מותאם אישית
            createCustomLegend(chartLabels, chartData, colors);
        }

        // פונקציה ליצירת מקרא מותאם אישית
        function createCustomLegend(labels, data, colors) {
            const total = data.reduce((a, b) => a + b, 0);
            const chartContainer = document.getElementById('pieChart').parentElement;
            
            // הוספת הסכום הכולל מתחת למקרא
            const chartCanvas = document.getElementById('pieChart');
            const totalDiv = document.createElement('div');
            
            if(window.innerWidth > 768){
                totalDiv.style.cssText = `
                    position: relative;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 15px;
                    margin-top: 20px;
                    text-align: center;
                    padding: 15px 20px;
                    background: linear-gradient(135deg, #f5f7fa 0%, #e8eef5 100%);
                    border-radius: 12px;
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
                `;
                totalDiv.innerHTML = `
                    <span style="font-size: 1.1rem; color: #667eea; font-weight: bold;">סכום כולל:</span>
                    <span style="font-size: 1.5rem; color: #667eea; font-weight: bold;">₪${total.toLocaleString('he-IL')}</span>
                `;
            }else{
                totalDiv.style.cssText = `
                    position: relative;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 10px;
                    margin-top: 15px;
                    margin-bottom: 10px;
                    text-align: center;
                    padding: 10px;
                    background: linear-gradient(135deg, #f5f7fa 0%, #e8eef5 100%);
                    border-radius: 10px;
                `;
                totalDiv.innerHTML = `
                <span style="font-size: 14px; color: #667eea; font-weight: bold;">סכום כולל:</span>
                <span style="font-size: 16px; color: #667eea; font-weight: bold;">₪${total.toLocaleString('he-IL')}</span>
            `;
            }

            // יצירת אלמנט למקרא
            const legendDiv = document.createElement('div');
            legendDiv.style.cssText = `
                margin-top: 20px;
                text-align: right;
                direction: rtl;
            `;

            // יצירת פריטי המקרא
            labels.forEach((label, index) => {
                const percentage = ((data[index] / total) * 100).toFixed(1);
                const legendItem = document.createElement('div');
                legendItem.style.cssText = `
                    display: flex;
                    align-items: center;
                    justify-content: flex-end;
                    margin-bottom: 8px;
                    padding: 5px 0;
                `;

                const colorBox = document.createElement('div');
                colorBox.style.cssText = `
                    width: 20px;
                    height: 20px;
                    background-color: ${colors[index]};
                    border-radius: 3px;
                    margin-left: 10px;
                    border: 2px solid #fff;
                    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
                `;

                const labelText = document.createElement('span');
                labelText.style.cssText = `
                    font-size: 0.9rem;
                    color: #333;
                    font-weight: 500;
                `;
                labelText.textContent = `${label} (${percentage}%)`;

                legendItem.appendChild(labelText);
                legendItem.appendChild(colorBox);
                legendDiv.appendChild(legendItem);
            });

            chartContainer.appendChild(legendDiv);
            
            // הוספת הסכום הכולל מתחת למקרא
            chartContainer.appendChild(totalDiv);
        }

        // פונקציה ליצירת טבלה מפורטת
        function createDetailedTable(sumSugMutzar) {
            const tableDiv = document.getElementById('detailedSummary');
            
            const shemTochnit = {
                '1': 'פוליסת ביטוח חיים משולב חיסכון',
                '2': 'קרן פנסיה',
                '2_1': 'קרן פנסיה ותיקה - ותיקה',
                '2_2': 'קרן פנסיה ותיקה - חדשה',
                '3': 'קופת גמל',
                '4': 'קרן השתלמות',
                '5': 'פוליסת חיסכון טהור',
                '6': 'פוליסת סיכון טהור',
                '7': 'ביטוח חיים משכנתא',
                '8': 'פוליסת סיכון טהור קולקטיב',
                '9': 'קופת גמל להשקעה',
                '10': 'חיסכון לכל ילד'
            };

            const isMobile = window.innerWidth <= 768;
            let tableHTML = '';

            if (isMobile) {
                // תצוגת כרטיסיות למובייל
                tableHTML = '<div class="cards-container-mobile">';
                
                for (let key in sumSugMutzar) {
                    if (sumSugMutzar[key][0] > 0) {
                        const originalTotalValue = sumSugMutzar[key][0];
                        
                        for (let i = 0; i < sumSugMutzar[key].length; i++) {
                            if (sumSugMutzar[key][i] === 0) {
                                if(i===1){
                                    let years;
                                    const birthYear = parseInt(taarichLeyda.slice(0,4));
                                    const retirementAge = 67;
                                    const currentYear = new Date().getFullYear();
                                    years = retirementAge - (currentYear - birthYear);
                                    
                                    const calculatedValue = Math.pow(1.04, years) * originalTotalValue;
                                    
                                    sumSugMutzar[key][i] = calculatedValue.toLocaleString('he-IL')+" "+'₪'
                                }
                                else {
                                    sumSugMutzar[key][i]='לא רלבנטי'
                                }
                            }
                            else{
                                sumSugMutzar[key][i]=sumSugMutzar[key][i].toLocaleString('he-IL')+" "+'₪'
                            }
                        }
                        
                        tableHTML += `
                            <div class="product-card-mobile">
                                <h4 style="color: #667eea; margin-bottom: 15px; font-size: 1.1rem; font-weight: bold; text-align: center; border-bottom: 2px solid #667eea; padding-bottom: 8px;">
                                    ${shemTochnit[key]}
                                </h4>
                                <div class="card-row">
                                    <span class="card-label">סכום כולל:</span>
                                    <span class="card-value" style="color: #2c3e50;">${sumSugMutzar[key][0]}</span>
                                </div>
                                <div class="card-row">
                                    <span style="font-weight: bold;" class="card-label">יתרות לגיל פרישה:</span>
                                </div>

                        `;
                        
                        if (sumSugMutzar[key][1] !== 'לא רלבנטי') {
                            tableHTML += `
                                <div class="card-row">
                                    <span class="card-label">צבירה ללא פרמיות:</span>
                                    <span class="card-value" style="color: #27ae60;">${sumSugMutzar[key][1]}</span>
                                </div>
                            `;
                        }
                        
                        if (sumSugMutzar[key][2] !== 'לא רלבנטי') {
                            tableHTML += `
                                <div class="card-row">
                                    <span class="card-label">צבירה עם פרמיות:</span>
                                    <span class="card-value" style="color: #3498db;">${sumSugMutzar[key][2]}</span>
                                </div>
                            `;
                        }
                        
                        if (sumSugMutzar[key][3] !== 'לא רלבנטי') {
                            tableHTML += `
                                <div class="card-row">
                                    <span class="card-label">קצבה ללא פרמיות:</span>
                                    <span class="card-value" style="color: #e74c3c;">${sumSugMutzar[key][3]}</span>
                                </div>
                            `;
                        }
                        
                        if (sumSugMutzar[key][4] !== 'לא רלבנטי') {
                            tableHTML += `
                                <div class="card-row">
                                    <span class="card-label">קצבה עם פרמיות:</span>
                                    <span class="card-value" style="color: #f39c12;">${sumSugMutzar[key][4]}</span>
                                </div>
                            `;
                        }
                        
                        tableHTML += '</div>';
                    }
                }
                
                tableHTML += '</div>';
                tableHTML += `
                    <div style="margin-top: 20px; padding: 15px; background: rgba(102, 126, 234, 0.1); border-radius: 10px; border-right: 4px solid #667eea;">
                        <p style="color: #555; font-size: 0.85rem; margin: 0; text-align: right; line-height: 1.5;">
                            <strong>הערה:</strong> בקופות גמל, קרנות השתלמות וקרן ותיקה החישוב מבוצע לפי 4% שנתי עד גיל 67
                        </p>
                    </div>
                `;
            } else {
                // תצוגת טבלה למסכים גדולים
                tableHTML = `
                    <table id="detailedTable" dir="rtl" style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                        <thead>
                            <tr style="background: linear-gradient(45deg, #667eea, #764ba2); color: white;">
                                 <th style="padding: 10px; text-align: right; border: 1px solid #ddd; border-bottom: none; white-space: nowrap;"></th>
                                 <th style="padding: 10px; text-align: right; border: 1px solid #ddd; border-bottom: none; white-space: nowrap;"></th>
                                <th colspan="4" style="padding: 10px; text-align: center; border: 1px solid #ddd; white-space: nowrap;">יתרות לגיל פרישה</th>
                            </tr>
                            <tr style="background: linear-gradient(45deg, #667eea, #764ba2); color: white;">
                                <th style="padding: 10px; text-align: center; border: 1px solid #ddd;border-top: none; white-space: nowrap;">סוג מוצר</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #ddd;border-top: none; white-space: nowrap;">סכום כולל</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #ddd; white-space: nowrap;">צבירה ללא פרמיות</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #ddd; white-space: nowrap;">צבירה עם פרמיות</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #ddd; white-space: nowrap;">קצבה ללא פרמיות</th>
                                <th style="padding: 10px; text-align: center; border: 1px solid #ddd; white-space: nowrap;">קצבה עם פרמיות</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                for (let key in sumSugMutzar) {
                    if (sumSugMutzar[key][0] > 0) {
                        const originalTotalValue = sumSugMutzar[key][0];
                        
                        for (let i = 0; i < sumSugMutzar[key].length; i++) {
                            if (sumSugMutzar[key][i] === 0) {
                                if(i===1){
                                    let years;
                                    const birthYear = parseInt(taarichLeyda.slice(0,4));
                                    const retirementAge = 67;
                                    const currentYear = new Date().getFullYear();
                                    years = retirementAge - (currentYear - birthYear);
                                    
                                    const calculatedValue = Math.pow(1.04, years) * originalTotalValue;
                                    
                                    sumSugMutzar[key][i] = calculatedValue.toLocaleString('he-IL')+" "+'₪'
                                }
                                else {
                                    sumSugMutzar[key][i]='לא רלבנטי'
                                }
                            }
                            else{
                                sumSugMutzar[key][i]=sumSugMutzar[key][i].toLocaleString('he-IL')+" "+'₪'
                            }
                        }
                        tableHTML += `
                            <tr style="background: rgba(102, 126, 234, 0.1);">
                                <td style="padding: 12px; border: 1px solid #ddd; font-weight: bold; white-space: nowrap;">${shemTochnit[key]}</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: right; color: #2c3e50; white-space: nowrap;">${sumSugMutzar[key][0]}</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: right; color: #27ae60; white-space: nowrap;">${sumSugMutzar[key][1]}</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: right; color: #3498db; white-space: nowrap;">${sumSugMutzar[key][2]}</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: right; color: #e74c3c; white-space: nowrap;">${sumSugMutzar[key][3]}</td>
                                <td style="padding: 12px; border: 1px solid #ddd; text-align: right; color: #f39c12; white-space: nowrap;">${sumSugMutzar[key][4]}</td>
                            </tr>
                        `;
                    }
                }

                tableHTML += `
                        </tbody>
                    </table>
                    <div style="margin-top: 20px; padding: 15px; background: rgba(102, 126, 234, 0.1); border-radius: 10px; border-right: 4px solid #667eea;">
                        <p id="detailedTableNote" style="color: #555; font-size: 0.9rem; margin: 0; text-align: right; line-height: 1.5;">
                            <strong>הערה:</strong> בקופות גמל, קרנות השתלמות וקרן ותיקה החישוב מבוצע לפי 4% שנתי עד גיל 67
                        </p>
                    </div>
                `;
            }

            tableDiv.innerHTML = tableHTML;
            
            // חישוב סכומים לניתוח מתקדם
            setTimeout(() => {
                let sumHon = 0;
                let sumKitzva = 0;
                
                // מוצרים הוניים - מילות מפתח
                const equityKeywords = ['השתלמות', 'חיסכון טהור', 'גמל להשקעה', 'חיסכון לכל ילד'];
                // מוצרי קצבה - מילות מפתח
                const pensionKeywords = ['ביטוח חיים', 'פנסיה', 'קופת גמל'];
                
                // בדיקה אם זה מובייל (כרטיסיות) או דסקטופ (טבלה)
                const isMobile = window.innerWidth <= 768;
                
                if (isMobile) {
                    // קריאה מכרטיסיות במובייל
                    const cards = tableDiv.querySelectorAll('.product-card-mobile');
                    console.log(`📱 מצב מובייל - ${cards.length} כרטיסים`);
                    
                    cards.forEach((card, index) => {
                        const productName = card.querySelector('h4').textContent.trim();
                        const amountElement = card.querySelector('.card-row .card-value');
                        if (!amountElement) return;
                        
                        const amountText = amountElement.textContent.trim();
                        const amount = parseFloat(amountText.replace(/[₪,\s]/g, '')) || 0;
                        
                        // סיווג לפי מילות מפתח
                        const isEquity = equityKeywords.some(keyword => productName.includes(keyword));
                        const isPension = pensionKeywords.some(keyword => productName.includes(keyword));
                        
                        if (isEquity) {
                            sumHon += amount;
                            console.log(`  ✅ ${productName}: ₪${amount.toLocaleString('he-IL')} → הוני`);
                        } else if (isPension) {
                            sumKitzva += amount;
                            console.log(`  ✅ ${productName}: ₪${amount.toLocaleString('he-IL')} → קצבה`);
                        }
                    });
                } else {
                    // קריאה מטבלה בדסקטופ
                    const table = tableDiv.querySelector('table tbody');
                    if (!table) {
                        console.warn('⚠️ לא נמצאה טבלה');
                        return;
                    }
                    
                    const rows = table.querySelectorAll('tr');
                    //console.log(`💻 מצב דסקטופ - ${rows.length} שורות`);
                    
                    for (let i = 0; i < rows.length; i++) {
                        const cells = rows[i].children;
                        if (cells.length < 2) continue;
                        
                        const productName = cells[0].textContent.trim();
                        const amountText = cells[1].textContent.trim();
                        
                        // דלג על כותרת
                        if (!productName || productName === 'סוג מוצר' || !amountText) {
                            continue;
                        }
                        
                        const amount = parseFloat(amountText.replace(/[₪,\s]/g, '')) || 0;
                        
                        // סיווג לפי מילות מפתח
                        const isEquity = equityKeywords.some(keyword => productName.includes(keyword));
                        const isPension = pensionKeywords.some(keyword => productName.includes(keyword));
                        
                        if (isEquity) {
                            sumHon += amount;
                           // console.log(`  ✅ ${productName}: ₪${amount.toLocaleString('he-IL')} → הוני`);
                        } else if (isPension) {
                            sumKitzva += amount;
                           // console.log(`  ✅ ${productName}: ₪${amount.toLocaleString('he-IL')} → קצבה`);
                        }
                    }
                }
                
                //console.log('━━━━━━━━━━━━━━━━━━━━━━');
                //console.log(`💰 סך הוני: ₪${sumHon.toLocaleString('he-IL')}`);
                //console.log(`🏦 סך קצבה: ₪${sumKitzva.toLocaleString('he-IL')}`);
                
                // שמירת סכומים בסיסיים
                sessionStorage.setItem('sumHonForAdvancedAnalysis', sumHon);
                sessionStorage.setItem('sumKitzvaForAdvancedAnalysis', sumKitzva);
                
                // שמירת נתונים מפורטים לניתוח מתקדם
                const advancedAnalysisData = {
                    sumSugMutzar: sumSugMutzar,          // פירוט לפי מוצר
                    pirteiHeshbon: pirteiHeshbon || [],   // פרטי חשבונות
                    masluleiHashkaa: masluleiHashkaa || [], // מסלולי השקעה
                    yitrotLefiMutzar: yitrotLefiMutzar || {}, // יתרות לפי מוצר
                    pratimIshim: pratimIshim || {}        // פרטים אישיים
                };
                
                sessionStorage.setItem('advancedAnalysisData', JSON.stringify(advancedAnalysisData));
                console.log('💾 כל הנתונים לניתוח מתקדם נשמרו ב-sessionStorage');
            }, 100);
        }

        // פונקציה ליצירת טבלת סיכום לפי מסלול ומוצר
        function createPathwaySummaryTable(pathwaySummary) {
            if (!pathwaySummary || pathwaySummary.length === 0) {
                return;
            }

            // יצירת אלמנט חדש לטבלה
            const pathwayTableDiv = document.createElement('div');
            pathwayTableDiv.className = 'data-card';
            pathwayTableDiv.style.marginTop = '30px';

            const isMobile = window.innerWidth <= 768;
            let tableHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #333; margin: 0; font-size: 1.5rem; border-bottom: 3px solid #667eea; padding-bottom: 10px; text-align: right;">📊 סיכום לפי מסלול ומוצר</h3>
                    <button style="max-width: 50px;" type="button" class="tbl-button" id="closePathwayTable" onclick="closePathwayTableDisplay()">סגור</button>
                </div>
                <div id="pathwayTableContent">
            `;

            // מיון הנתונים לפי סוג מוצר ואז לפי סכום צבירה
            pathwaySummary.sort((a, b) => {
                if (a.sugMutzar !== b.sugMutzar) {
                    return a.sugMutzar.localeCompare(b.sugMutzar);
                }
                return b.totalSchumTzvira - a.totalSchumTzvira;
            });

            let totalSum = 0;

            if (isMobile) {
                // תצוגת כרטיסיות למובייל
                tableHTML += '<div class="cards-container-mobile">';
                
                pathwaySummary.forEach(item => {
                    const formattedAmount = new Intl.NumberFormat('he-IL', {
                        style: 'currency',
                        currency: 'ILS'
                    }).format(item.totalSchumTzvira).replace('₪', '₪ ').trim();
                    
                    totalSum += item.totalSchumTzvira;

                    tableHTML += `
                        <div class="product-card-mobile">
                            <h4 style="color: #667eea; margin-bottom: 12px; font-size: 1rem; font-weight: bold; text-align: center; border-bottom: 2px solid #667eea; padding-bottom: 8px;">
                                ${item.sugMutzar}
                            </h4>
                            <div class="card-row">
                                <span class="card-label">שם מסלול:</span>
                                <span class="card-value" style="color: #2c3e50;">${item.shemMaslulHashkaa}</span>
                            </div>
                            <div class="card-row">
                                <span class="card-label">סכום צבירה:</span>
                                <span class="card-value" style="color: #27ae60;">${formattedAmount}</span>
                            </div>
                        </div>
                    `;
                });
                
                // הוספת כרטיס סך הכל
                const formattedTotalSum = new Intl.NumberFormat('he-IL', {
                    style: 'currency',
                    currency: 'ILS'
                }).format(totalSum).replace('₪', '₪ ').trim();
                
                tableHTML += `
                    <div class="product-card-mobile" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); border: 2px solid #667eea;">
                        <div class="card-row" style="border-bottom: none;">
                            <span class="card-label" style="font-size: 1.1rem; color: #667eea;">סך הכל:</span>
                            <span class="card-value" style="font-size: 1.2rem; color: #667eea;">${formattedTotalSum}</span>
                        </div>
                    </div>
                `;
                
                tableHTML += '</div>';
            } else {
                // תצוגת טבלה למסכים גדולים
                tableHTML += `
                    <table id="pathwayTable" dir="rtl" style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                        <thead>
                            <tr style="background: linear-gradient(45deg, #667eea, #764ba2); color: white;">
                                <th style="padding: 15px; text-align: right; border: 1px solid #ddd; white-space: nowrap;">סוג מוצר</th>
                                <th style="padding: 15px; text-align: right; border: 1px solid #ddd; white-space: nowrap;">שם מסלול</th>
                                <th style="padding: 15px; text-align: center; border: 1px solid #ddd; white-space: nowrap;">סכום צבירה</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                pathwaySummary.forEach(item => {
                    const formattedAmount = new Intl.NumberFormat('he-IL', {
                        style: 'currency',
                        currency: 'ILS'
                    }).format(item.totalSchumTzvira).replace('₪', '₪ ').trim();
                    
                    totalSum += item.totalSchumTzvira;

                    tableHTML += `
                        <tr style="background: rgba(102, 126, 234, 0.1);">
                            <td style="padding: 12px; border: 1px solid #ddd; font-weight: bold; white-space: nowrap;">${item.sugMutzar}</td>
                            <td style="padding: 12px; border: 1px solid #ddd; white-space: nowrap;">${item.shemMaslulHashkaa}</td>
                            <td style="padding: 12px; border: 1px solid #ddd; text-align: center; color: #2c3e50; white-space: nowrap;">${formattedAmount}</td>
                        </tr>
                    `;
                });
                
                // הוספת שורת סך הכל
                const formattedTotalSum = new Intl.NumberFormat('he-IL', {
                    style: 'currency',
                    currency: 'ILS'
                }).format(totalSum).replace('₪', '₪ ').trim();
                
                tableHTML += `
                    <tr style="background: linear-gradient(45deg, #667eea, #764ba2); color: white; font-weight: bold;">
                        <td style="padding: 15px; border: 1px solid #ddd; text-align: right; font-size: 1.1rem;" colspan="2">סך הכל</td>
                        <td style="padding: 15px; border: 1px solid #ddd; text-align: center; font-size: 1.1rem;">${formattedTotalSum}</td>
                    </tr>
                `;

                tableHTML += `
                        </tbody>
                    </table>
                `;
            }

            tableHTML += `
                </div>
                <div style="margin-top: 20px; padding: 15px; background: rgba(102, 126, 234, 0.1); border-radius: 10px; border-right: 4px solid #667eea;">
                    <p style="color: #555; font-size: 0.9rem; margin: 0; text-align: right; line-height: 1.5;">
                        <strong>הערה:</strong> טבלה זו מציגה את הסכומים המצטברים לפי מסלול השקעה בכל מוצר פיננסי (לא כולל קרן ותיקה)
                    </p>
                </div>
            `;

            pathwayTableDiv.innerHTML = tableHTML;

            // הוספת הטבלה החדשה לקונטיינר הראשי
            const dataDisplayContainer = document.getElementById('dataDisplayContainer');
            dataDisplayContainer.appendChild(pathwayTableDiv);
        }
        function closeTableDisplay() {
            const table = document.getElementById('statusTable');
            const button = document.getElementById('closeTable');
            const note = document.getElementById('statusTableNote');
            if (table && button && note) {
                if (table.style.display === 'none') {
                    table.style.display = 'table';
                    button.textContent = 'סגור טבלה';
                    note.style.display = 'block';
                } else {
                    table.style.display = 'none';
                    button.textContent = 'פתח טבלה';
                    note.style.display = 'none';
                }
            }
        }
        
        function closeDetailedTableDisplay() {
            const detailedSummary = document.getElementById('detailedSummary');
            const button = document.getElementById('closeDetailedTable');
            
            if (detailedSummary && button) {
                if (detailedSummary.style.display === 'none') {
                    detailedSummary.style.display = 'block';
                    button.textContent = 'סגור';
                } else {
                    detailedSummary.style.display = 'none';
                    button.textContent = 'פתח';
                }
            }
        }
        
        function closePathwayTableDisplay() {
            const content = document.getElementById('pathwayTableContent');
            const button = document.getElementById('closePathwayTable');
            
            if (content && button) {
                if (content.style.display === 'none') {
                    content.style.display = 'block';
                    button.textContent = 'סגור';
                } else {
                    content.style.display = 'none';
                    button.textContent = 'פתח';
                }
            }
        }

        // פונקציה ליצירת טבלת פיצויים
        function createPitzuimTable(pitzuimData) {
            if (!pitzuimData || pitzuimData.length === 0) {
                return;
            }

            // סינון רק רשומות עם סכומים גדולים מ-0
            const filteredData = pitzuimData.filter(item => {
                return item.pitzuimPturimMaavidimKodmim > 0 ||
                       item.erechPidionPitzuimLeKitzbaMaavidimKodmim > 0 ||
                       item.tzviratPitzuimMaavidimKodmimBeretzefKitzba > 0 ||
                       item.tzviratPitzuimMaavidimKodmimBeretzefZechuyot > 0 ||
                       item.tzviratPitzuim31121999LeKitzba > 0 ||
                       item.erechPidionPitzuimMaasikNochechi > 0 ||
                       item.erechPidionMarkivPitzuimLemasNochechi > 0 ||
                       item.erechPidionPitzuimMaavidimKodmimRetzefZehuyut > 0 ||
                       item.erechPidionPitzuimLeHonMaavidimKodmim > 0 ||
                       item.yitratPitzuimLeLoHitchashbenot > 0             
            });

            if (filteredData.length === 0) {
                return;
            }
            
            // בדיקה אילו עמודות יש בהן סכומים
            const hasData = {
                pitzuimPturimMaavidimKodmim: filteredData.some(item => item.pitzuimPturimMaavidimKodmim > 0),
                erechPidionPitzuimLeKitzbaMaavidimKodmim: filteredData.some(item => item.erechPidionPitzuimLeKitzbaMaavidimKodmim > 0),
                tzviratPitzuimMaavidimKodmimBeretzefKitzba: filteredData.some(item => item.tzviratPitzuimMaavidimKodmimBeretzefKitzba > 0),
                tzviratPitzuimMaavidimKodmimBeretzefZechuyot: filteredData.some(item => item.tzviratPitzuimMaavidimKodmimBeretzefZechuyot > 0),
                tzviratPitzuim31121999LeKitzba: filteredData.some(item => item.tzviratPitzuim31121999LeKitzba > 0),
                erechPidionPitzuimMaasikNochechi: filteredData.some(item => item.erechPidionPitzuimMaasikNochechi > 0),
                erechPidionMarkivPitzuimLemasNochechi: filteredData.some(item => item.erechPidionMarkivPitzuimLemasNochechi > 0),
                erechPidionPitzuimMaavidimKodmimRetzefZehuyut: filteredData.some(item => item.erechPidionPitzuimMaavidimKodmimRetzefZehuyut > 0),
                erechPidionPitzuimLeHonMaavidimKodmim: filteredData.some(item => item.erechPidionPitzuimLeHonMaavidimKodmim > 0),
                yitratPitzuimLeLoHitchashbenot: filteredData.some(item => item.yitratPitzuimLeLoHitchashbenot > 0),
                kayamRetzefPitzuimKitzba: filteredData.some(item => item.kayamRetzefPitzuimKitzba <2),
                kayamRetzefPitzuimZechuyot: filteredData.some(item => item.kayamRetzefPitzuimZechuyot <2)
            };
            
            const pitzuimTableDiv = document.createElement('div');
            pitzuimTableDiv.className = 'data-card';
            pitzuimTableDiv.style.marginTop = '30px';

            const shemTochnit = {
                '1': 'פוליסת ביטוח חיים משולב חיסכון',
                '2': 'קרן פנסיה',
                '2_1': 'קרן פנסיה ותיקה - ותיקה',
                '2_2': 'קרן פנסיה ותיקה - חדשה',
                '3': 'קופת גמל',
                '4': 'קרן השתלמות',
                '5': 'פוליסת חיסכון טהור',
                '6': 'פוליסת סיכון טהור',
                '7': 'ביטוח חיים משכנתא',
                '8': 'פוליסת סיכון טהור קולקטיב',
                '9': 'קופת גמל להשקעה',
                '10': 'חיסכון לכל ילד'
            };
            
            const fieldLabels = {
                pitzuimPturimMaavidimKodmim: 'צבירת מעבידים קודמים',
                erechPidionPitzuimLeKitzbaMaavidimKodmim: 'ערך פדיון לקצבה מעבידים קודמים',
                tzviratPitzuimMaavidimKodmimBeretzefKitzba: 'צבירת פיצויים מעבידים קודמים לקצבה',
                tzviratPitzuimMaavidimKodmimBeretzefZechuyot: 'צבירת פיצויים מעובדים קודמים לזכויות',
                tzviratPitzuim31121999LeKitzba: 'צבירת פיצויים 31.12.1999 לקצבה',
                erechPidionPitzuimMaasikNochechi: 'ערך פדיון מעביד נוכחי',
                erechPidionMarkivPitzuimLemasNochechi: 'ערך פדיון מרכיב פיצויים למעביד נוכחי',
                erechPidionPitzuimMaavidimKodmimRetzefZehuyut: 'ערך פדיון מעבידים קודמים רצף זכויות',
                erechPidionPitzuimLeHonMaavidimKodmim: 'ערך פדיון להון מעבידים קודמים',
                yitratPitzuimLeLoHitchashbenot: 'יתרת פיצויים ללא התחשבות',
                kayamRetzefPitzuimKitzba: 'רצף פיצויים קצבה',
                kayamRetzefPitzuimZechuyot: 'רצף זכויות פיצויים'
            };

            const isMobile = window.innerWidth <= 768;

            let tableHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #333; margin: 0; font-size: 1.5rem; border-bottom: 3px solid #667eea; padding-bottom: 10px; text-align: right;">💰 ערכי פדיון פיצויים</h3>
                    <button style="max-width: 50px;" type="button" class="tbl-button" id="closePitzuimTable" onclick="closePitzuimTableDisplay()">סגור</button>
                </div>
                <div id="pitzuimTableContent">
            `;

            filteredData.sort((a, b) => {
                if (a.sugMutzar !== b.sugMutzar) {
                    return a.sugMutzar.localeCompare(b.sugMutzar);
                }
                return a.misparPolisaOHeshbon.localeCompare(b.misparPolisaOHeshbon);
            });

            if (isMobile) {
                // תצוגת כרטיסיות למובייל
                tableHTML += '<div class="cards-container-mobile">';
                
                filteredData.forEach(item => {
                    const productName = shemTochnit[item.sugMutzar];
                    
                    tableHTML += `
                        <div class="product-card-mobile">
                            <h4 style="color: #667eea; margin-bottom: 12px; font-size: 1rem; font-weight: bold; text-align: center; border-bottom: 2px solid #667eea; padding-bottom: 8px;">
                                ${productName}
                            </h4>
                            <div class="card-row">
                                <span class="card-label">מספר חשבון/פוליסה:</span>
                                <span class="card-value" style="color: #2c3e50;">${item.misparPolisaOHeshbon}</span>
                            </div>
                    `;
                    
                    // הוספת שדות רק אם יש בהם ערכים
                    if (item.pitzuimPturimMaavidimKodmim > 0) {
                        tableHTML += `
                            <div class="card-row">
                                <span class="card-label">${fieldLabels.pitzuimPturimMaavidimKodmim}:</span>
                                <span class="card-value" style="color: #2c3e50;">₪${item.pitzuimPturimMaavidimKodmim.toLocaleString('he-IL')}</span>
                            </div>
                        `;
                    }
                    
                    if (item.erechPidionPitzuimLeKitzbaMaavidimKodmim > 0) {
                        tableHTML += `
                            <div class="card-row">
                                <span class="card-label">${fieldLabels.erechPidionPitzuimLeKitzbaMaavidimKodmim}:</span>
                                <span class="card-value" style="color: #27ae60;">₪${item.erechPidionPitzuimLeKitzbaMaavidimKodmim.toLocaleString('he-IL')}</span>
                            </div>
                        `;
                    }
                    
                    if (item.tzviratPitzuimMaavidimKodmimBeretzefKitzba > 0) {
                        tableHTML += `
                            <div class="card-row">
                                <span class="card-label">${fieldLabels.tzviratPitzuimMaavidimKodmimBeretzefKitzba}:</span>
                                <span class="card-value" style="color: #3498db;">₪${item.tzviratPitzuimMaavidimKodmimBeretzefKitzba.toLocaleString('he-IL')}</span>
                            </div>
                        `;
                    }
                    
                    if (item.tzviratPitzuimMaavidimKodmimBeretzefZechuyot > 0) {
                        tableHTML += `
                            <div class="card-row">
                                <span class="card-label">${fieldLabels.tzviratPitzuimMaavidimKodmimBeretzefZechuyot}:</span>
                                <span class="card-value" style="color: #e74c3c;">₪${item.tzviratPitzuimMaavidimKodmimBeretzefZechuyot.toLocaleString('he-IL')}</span>
                            </div>
                        `;
                    }
                    
                    if (item.tzviratPitzuim31121999LeKitzba > 0) {
                        tableHTML += `
                            <div class="card-row">
                                <span class="card-label">${fieldLabels.tzviratPitzuim31121999LeKitzba}:</span>
                                <span class="card-value" style="color: #f39c12;">₪${item.tzviratPitzuim31121999LeKitzba.toLocaleString('he-IL')}</span>
                            </div>
                        `;
                    }
                    
                    if (item.erechPidionPitzuimMaasikNochechi > 0) {
                        tableHTML += `
                            <div class="card-row">
                                <span class="card-label">${fieldLabels.erechPidionPitzuimMaasikNochechi}:</span>
                                <span class="card-value" style="color: #9b59b6;">₪${item.erechPidionPitzuimMaasikNochechi.toLocaleString('he-IL')}</span>
                            </div>
                        `;
                    }
                    
                    if (item.erechPidionMarkivPitzuimLemasNochechi > 0) {
                        tableHTML += `
                            <div class="card-row">
                                <span class="card-label">${fieldLabels.erechPidionMarkivPitzuimLemasNochechi}:</span>
                                <span class="card-value" style="color: #1abc9c;">₪${item.erechPidionMarkivPitzuimLemasNochechi.toLocaleString('he-IL')}</span>
                            </div>
                        `;
                    }
                    
                    if (item.erechPidionPitzuimMaavidimKodmimRetzefZehuyut > 0) {
                        tableHTML += `
                            <div class="card-row">
                                <span class="card-label">${fieldLabels.erechPidionPitzuimMaavidimKodmimRetzefZehuyut}:</span>
                                <span class="card-value" style="color: #34495e;">₪${item.erechPidionPitzuimMaavidimKodmimRetzefZehuyut.toLocaleString('he-IL')}</span>
                            </div>
                        `;
                    }
                    
                    if (item.erechPidionPitzuimLeHonMaavidimKodmim > 0) {
                        tableHTML += `
                            <div class="card-row">
                                <span class="card-label">${fieldLabels.erechPidionPitzuimLeHonMaavidimKodmim}:</span>
                                <span class="card-value" style="color: #e67e22;">₪${item.erechPidionPitzuimLeHonMaavidimKodmim.toLocaleString('he-IL')}</span>
                            </div>
                        `;
                    }
                    
                    if (item.yitratPitzuimLeLoHitchashbenot > 0) {
                        tableHTML += `
                            <div class="card-row">
                                <span class="card-label">${fieldLabels.yitratPitzuimLeLoHitchashbenot}:</span>
                                <span class="card-value" style="color: #95a5a6;">₪${item.yitratPitzuimLeLoHitchashbenot.toLocaleString('he-IL')}</span>
                            </div>
                        `;
                    }
                    
                    if (item.kayamRetzefPitzuimKitzba && item.kayamRetzefPitzuimKitzba < 2) {
                        tableHTML += `
                            <div class="card-row">
                                <span class="card-label">${fieldLabels.kayamRetzefPitzuimKitzba}:</span>
                                <span class="card-value" style="color: #16a085;">${item.kayamRetzefPitzuimKitzba > 0 ? 'כן' : 'לא'}</span>
                            </div>
                        `;
                    }
                    
                    if (item.kayamRetzefPitzuimZechuyot && item.kayamRetzefPitzuimZechuyot < 2) {
                        tableHTML += `
                            <div class="card-row">
                                <span class="card-label">${fieldLabels.kayamRetzefPitzuimZechuyot}:</span>
                                <span class="card-value" style="color: #8e44ad;">${item.kayamRetzefPitzuimZechuyot > 0 ? 'כן' : 'לא'}</span>
                            </div>
                        `;
                    }
                    
                    tableHTML += '</div>';
                });
                
                tableHTML += '</div>';
            } else {
                // תצוגת טבלה למסכים גדולים
                tableHTML += `
                    <div style="overflow-x: auto; margin-top: 20px;">
                        <table id="pitzuimTable" dir="rtl" style="min-width: 1200px; border-collapse: collapse;">
                            <thead>
                                <tr style="background: linear-gradient(45deg, #667eea, #764ba2); color: white;">
                                    <th style="padding: 5px; text-align: right; border: 1px solid #ddd; font-size: 0.8rem; min-width: 80px;">סוג מוצר</th>
                                    <th style="padding: 5px; text-align: right; border: 1px solid #ddd; font-size: 0.8rem; min-width: 100px;">מספר חשבון/פוליסה</th>
                                    ${hasData.pitzuimPturimMaavidimKodmim ? '<th style="padding: 5px; text-align: center; border: 1px solid #ddd; font-size: 0.85rem; min-width: 120px; line-height: 1.2;">צבירת מעבידים קודמים</th>' : ''}
                                    ${hasData.erechPidionPitzuimLeKitzbaMaavidimKodmim ? '<th style="padding: 5px; text-align: center; border: 1px solid #ddd; font-size: 0.85rem; min-width: 120px; line-height: 1.2;">ערך פדיון פיצויים לקצבה מעבידים קודמים</th>' : ''}
                                    ${hasData.tzviratPitzuimMaavidimKodmimBeretzefKitzba ? '<th style="padding: 5px; text-align: center; border: 1px solid #ddd; font-size: 0.85rem; min-width: 120px; line-height: 1.2;">צבירת פיצויים מעבידים קודמים לקצבה</th>' : ''}
                                    ${hasData.tzviratPitzuimMaavidimKodmimBeretzefZechuyot ? '<th style="padding: 5px; text-align: center; border: 1px solid #ddd; font-size: 0.85rem; min-width: 120px; line-height: 1.2;">צבירת פיצויים מעובדים קודמים לזכויות</th>' : ''}
                                    ${hasData.tzviratPitzuim31121999LeKitzba ? '<th style="padding: 5px; text-align: center; border: 1px solid #ddd; font-size: 0.85rem; min-width: 120px; line-height: 1.2;">צבירת פיצויים 31.12.1999 לקצבה</th>' : ''}
                                    ${hasData.erechPidionPitzuimMaasikNochechi ? '<th style="padding: 5px; text-align: center; border: 1px solid #ddd; font-size: 0.85rem; min-width: 120px; line-height: 1.2;">ערך פדיון פיצויים מעביד נוכחי</th>' : ''}
                                    ${hasData.erechPidionMarkivPitzuimLemasNochechi ? '<th style="padding: 5px; text-align: center; border: 1px solid #ddd; font-size: 0.85rem; min-width: 120px; line-height: 1.2;">ערך פדיון מרכיב פיצויים למעביד נוכחי</th>' : ''}
                                    ${hasData.erechPidionPitzuimMaavidimKodmimRetzefZehuyut ? '<th style="padding: 5px; text-align: center; border: 1px solid #ddd; font-size: 0.85rem; min-width: 120px; line-height: 1.2;">ערך פדיון פיצויים מעבידים קודמים רצף זכויות</th>' : ''}
                                    ${hasData.erechPidionPitzuimLeHonMaavidimKodmim ? '<th style="padding: 5px; text-align: center; border: 1px solid #ddd; font-size: 0.85rem; min-width: 120px; line-height: 1.2;">ערך פדיון פיצויים להון מעבידים קודמים</th>' : ''}
                                    ${hasData.yitratPitzuimLeLoHitchashbenot ? '<th style="padding: 5px; text-align: center; border: 1px solid #ddd; font-size: 0.85rem; min-width: 120px; line-height: 1.2;">יתרת פיצויים ללא התחשבות</th>' : ''}
                                    ${hasData.kayamRetzefPitzuimKitzba ? '<th style="padding: 5px; text-align: center; border: 1px solid #ddd; font-size: 0.85rem; min-width: 100px; line-height: 1.2;">קיים רצף פיצויים קצבה</th>' : ''}
                                    ${hasData.kayamRetzefPitzuimZechuyot ? '<th style="padding: 5px; text-align: center; border: 1px solid #ddd; font-size: 0.85rem; min-width: 100px; line-height: 1.2;">קיים רצף זכויות פיצויים</th>' : ''}
                                </tr>
                            </thead>
                        <tbody>
                `;
                
                filteredData.forEach(item => {
                    const productName = shemTochnit[item.sugMutzar];
                    tableHTML += `
                        <tr style="background: rgba(102, 126, 234, 0.1);">
                            <td style="padding: 5px; border: 1px solid #ddd; font-weight: bold;  font-size: 0.8rem;">${productName}</td>
                            <td style="padding: 5px; border: 1px solid #ddd;  font-size: 0.8rem;">${item.misparPolisaOHeshbon}</td>
                            ${hasData.pitzuimPturimMaavidimKodmim ? `<td style="padding: 5px; border: 1px solid #ddd; text-align: center; color: #2c3e50; white-space: nowrap; font-size: 0.85rem;">${item.pitzuimPturimMaavidimKodmim > 0 ? '₪' + item.pitzuimPturimMaavidimKodmim.toLocaleString('he-IL') : '-'}</td>` : ''}
                            ${hasData.erechPidionPitzuimLeKitzbaMaavidimKodmim ? `<td style="padding: 5px; border: 1px solid #ddd; text-align: center; color: #27ae60; white-space: nowrap; font-size: 0.85rem;">${item.erechPidionPitzuimLeKitzbaMaavidimKodmim > 0 ? '₪' + item.erechPidionPitzuimLeKitzbaMaavidimKodmim.toLocaleString('he-IL') : '-'}</td>` : ''}
                            ${hasData.tzviratPitzuimMaavidimKodmimBeretzefKitzba ? `<td style="padding: 5px; border: 1px solid #ddd; text-align: center; color: #3498db; white-space: nowrap; font-size: 0.85rem;">${item.tzviratPitzuimMaavidimKodmimBeretzefKitzba > 0 ? '₪' + item.tzviratPitzuimMaavidimKodmimBeretzefKitzba.toLocaleString('he-IL') : '-'}</td>` : ''}
                            ${hasData.tzviratPitzuimMaavidimKodmimBeretzefZechuyot ? `<td style="padding: 5px; border: 1px solid #ddd; text-align: center; color: #e74c3c; white-space: nowrap; font-size: 0.85rem;">${item.tzviratPitzuimMaavidimKodmimBeretzefZechuyot > 0 ? '₪' + item.tzviratPitzuimMaavidimKodmimBeretzefZechuyot.toLocaleString('he-IL') : '-'}</td>` : ''}
                            ${hasData.tzviratPitzuim31121999LeKitzba ? `<td style="padding: 5px; border: 1px solid #ddd; text-align: center; color: #f39c12; white-space: nowrap; font-size: 0.85rem;">${item.tzviratPitzuim31121999LeKitzba > 0 ? '₪' + item.tzviratPitzuim31121999LeKitzba.toLocaleString('he-IL') : '-'}</td>` : ''}
                            ${hasData.erechPidionPitzuimMaasikNochechi ? `<td style="padding: 5px; border: 1px solid #ddd; text-align: center; color: #9b59b6; white-space: nowrap; font-size: 0.85rem;">${item.erechPidionPitzuimMaasikNochechi > 0 ? '₪' + item.erechPidionPitzuimMaasikNochechi.toLocaleString('he-IL') : '-'}</td>` : ''}
                            ${hasData.erechPidionMarkivPitzuimLemasNochechi ? `<td style="padding: 5px; border: 1px solid #ddd; text-align: center; color: #1abc9c; white-space: nowrap; font-size: 0.85rem;">${item.erechPidionMarkivPitzuimLemasNochechi > 0 ? '₪' + item.erechPidionMarkivPitzuimLemasNochechi.toLocaleString('he-IL') : '-'}</td>` : ''}
                            ${hasData.erechPidionPitzuimMaavidimKodmimRetzefZehuyut ? `<td style="padding: 5px; border: 1px solid #ddd; text-align: center; color: #34495e; white-space: nowrap; font-size: 0.85rem;">${item.erechPidionPitzuimMaavidimKodmimRetzefZehuyut > 0 ? '₪' + item.erechPidionPitzuimMaavidimKodmimRetzefZehuyut.toLocaleString('he-IL') : '-'}</td>` : ''}
                            ${hasData.erechPidionPitzuimLeHonMaavidimKodmim ? `<td style="padding: 5px; border: 1px solid #ddd; text-align: center; color: #e67e22; white-space: nowrap; font-size: 0.85rem;">${item.erechPidionPitzuimLeHonMaavidimKodmim > 0 ? '₪' + item.erechPidionPitzuimLeHonMaavidimKodmim.toLocaleString('he-IL') : '-'}</td>` : ''}
                            ${hasData.yitratPitzuimLeLoHitchashbenot ? `<td style="padding: 5px; border: 1px solid #ddd; text-align: center; color: #95a5a6; white-space: nowrap; font-size: 0.85rem;">${item.yitratPitzuimLeLoHitchashbenot > 0 ? '₪' + item.yitratPitzuimLeLoHitchashbenot.toLocaleString('he-IL') : '-'}</td>` : ''}
                            ${hasData.kayamRetzefPitzuimKitzba ? `<td style="padding: 5px; border: 1px solid #ddd; text-align: center; color: #16a085; white-space: nowrap; font-size: 0.85rem;">${item.kayamRetzefPitzuimKitzba > 0 ? 'כן' : 'לא'}</td>` : ''}
                            ${hasData.kayamRetzefPitzuimZechuyot ? `<td style="padding: 5px; border: 1px solid #ddd; text-align: center; color: #8e44ad; white-space: nowrap; font-size: 0.85rem;">${item.kayamRetzefPitzuimZechuyot > 0 ? 'כן' : 'לא'}</td>` : ''}
                        </tr>
                    `;
                });

                tableHTML += `
                        </tbody>
                    </table>
                    </div>
                `;
            }

            tableHTML += `
                </div>
                <div style="margin-top: 20px; padding: 15px; background: rgba(102, 126, 234, 0.1); border-radius: 10px; border-right: 4px solid #667eea;">
                    <p style="color: #555; font-size: 0.9rem; margin: 0; text-align: right; line-height: 1.5;">
                        <strong>הערה:</strong> מוצגות רק רשומות עם סכומי פיצויים גדולים מ-0. סכומים בשקלים חדשים.
                    </p>
                </div>
            `;

            pitzuimTableDiv.innerHTML = tableHTML;
            const dataDisplayContainer = document.getElementById('dataDisplayContainer');
            dataDisplayContainer.appendChild(pitzuimTableDiv);
        }

        function closePitzuimTableDisplay() {
            const content = document.getElementById('pitzuimTableContent');
            const button = document.getElementById('closePitzuimTable');
            
            if (content && button) {
                if (content.style.display === 'none') {
                    content.style.display = 'block';
                    button.textContent = 'סגור';
                } else {
                    content.style.display = 'none';
                    button.textContent = 'פתח';
                }
            }
        }

        // פונקציה ליצירת טבלת סטטוס שעבוד, עיקול, הלוואה ותביעה
        function createStatusTable(statusData) {
            if (!statusData || statusData.length === 0) {
                return;
            }

            // סינון רק חשבונות עם בעיות (שעבוד/עיקול/הלוואה/תביעה)
            
            
            const filteredStatusData = statusData.filter(item => 
                // בדיקה יותר גמישה - כל ערך שאינו '2' או 2 נחשב כבעיה
                Number(item.hutalSHiabud) !== 2 || Number(item.hutalIkul) !== 2 || 
                Number(item.yeshHalvaaBamutzar) !== 2 || Number(item.yeshTvia) !== 2)
              
                console.log(filteredStatusData)
               
            
            

            // יצירת אלמנט חדש לטבלה
            const statusTableDiv = document.createElement('div');
            statusTableDiv.style.cssText = `
                background: rgba(255,255,255,0.95);
                padding: 25px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                margin-top: 30px;
            `;

            // אם אין נתונים עם בעיות - הצג הודעה יפה
            if (filteredStatusData.length === 0) {
                statusTableDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: #333; margin: 0; font-size: 1.5rem; border-bottom: 3px solid #667eea; padding-bottom: 10px; text-align: right;">🔒 סטטוס שעבוד, עיקול, הלוואה ותביעה</h3>
                    </div>
                    <div style="text-align: center; padding: 40px; background: linear-gradient(135deg, #27ae60, #2ecc71); border-radius: 15px; color: white;">
                        <div style="font-size: 3rem; margin-bottom: 20px;">✅</div>
                        <h4 style="font-size: 1.5rem; margin-bottom: 15px; font-weight: bold;">מצוין!</h4>
                        <p style="font-size: 1.1rem; margin: 0; line-height: 1.6;">
                            לא קיימים עיקולים, שעבודים, תביעות או הלוואות<br>
                            בכל החשבונות הפיננסיים שלך
                        </p>
                    </div>
                `;
                const dataDisplayContainer = document.getElementById('dataDisplayContainer');
                dataDisplayContainer.appendChild(statusTableDiv);
                return;
            }

            // מיפוי שמות מוצרים
            const shemTochnit = {
                '1': 'פוליסת ביטוח חיים משולב חיסכון',
                '2': 'קרן פנסיה',
                '2_1': 'קרן פנסיה ותיקה - ותיקה',
                '2_2': 'קרן פנסיה ותיקה - חדשה',
                '3': 'קופת גמל',
                '4': 'קרן השתלמות',
                '5': 'פוליסת חיסכון טהור',
                '6': 'פוליסת סיכון טהור',
                '7': 'ביטוח חיים משכנתא',
                '8': 'פוליסת סיכון טהור קולקטיב',
                '9': 'קופת גמל להשקעה',
                '10': 'חיסכון לכל ילד'
            };
           
            // פונקציה לקבלת סמל לפי ערך
            function getStatusIcon(value) {
                if (value === '2' || value === 2) {
                    return '<span style="color: #27ae60; font-size: 1.2em;">✅</span>'; // אין בעיה
                } else if (value === '1' || value === 1) {
                    flag=true;
                    return '<span style="color: #e74c3c; font-size: 1.2em;">⚠️</span>'; // יש בעיה
                } else {
                    flag=true;
                    return '<span style="color: #95a5a6; font-size: 1.2em;">❓</span>'; // לא ידוע
                }
            }

            // פונקציה לקבלת טקסט לפי ערך
            function getStatusText(value) {
                if (value === '2' || value === 2) {
                    return 'אין';
                } else if (value === '1' || value === 1) {
                    return 'יש';
                } else {
                    return 'לא ידוע';
                }
            }
            
           
             
            // מיון הנתונים לפי סוג מוצר ואז לפי מספר חשבון
            filteredStatusData.sort((a, b) => {
                if (a.sugMutzar !== b.sugMutzar) {
                    return a.sugMutzar.localeCompare(b.sugMutzar);
                }
                return a.misparPolisaOHeshbon.localeCompare(b.misparPolisaOHeshbon);
            });
            let tableHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #333; margin: 0; font-size: 1.5rem; border-bottom: 3px solid #667eea; padding-bottom: 10px; text-align: right;">🔒 סטטוס שעבוד, עיקול, הלוואה ותביעה</h3>
                    <button type="button" class="tbl-button" id="closeTable" onclick="closeTableDisplay()">סגור טבלה</button>
                </div>
                <table id="statusTable" dir="rtl" style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                    <thead>
                        <tr style="background: linear-gradient(45deg, #667eea, #764ba2); color: white;">
                            <th style="padding: 15px; text-align: right; border: 1px solid #ddd; white-space: nowrap;">סוג מוצר</th>
                            <th style="padding: 15px; text-align: right; border: 1px solid #ddd; white-space: nowrap;">מספר חשבון/פוליסה</th>
                            <th style="padding: 15px; text-align: center; border: 1px solid #ddd; white-space: nowrap;">שעבוד</th>
                            <th style="padding: 15px; text-align: center; border: 1px solid #ddd; white-space: nowrap;">עיקול</th>
                            <th style="padding: 15px; text-align: center; border: 1px solid #ddd; white-space: nowrap;">הלוואה</th>
                            <th style="padding: 15px; text-align: center; border: 1px solid #ddd; white-space: nowrap;">תביעה</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            filteredStatusData.forEach(item => {
                const productName = shemTochnit[item.sugMutzar] || `מוצר ${item.sugMutzar}`;
                const pensiaType = item.pensiaVatikaOHadasha ? ` (${item.pensiaVatikaOHadasha})` : '';

                tableHTML += `
                    <tr style="background: rgba(102, 126, 234, 0.1);">
                        <td style="padding: 12px; border: 1px solid #ddd; font-weight: bold; white-space: nowrap;">${productName}${pensiaType}</td>
                        <td style="padding: 12px; border: 1px solid #ddd; white-space: nowrap;">${item.misparPolisaOHeshbon}</td>
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">
                            ${getStatusIcon(item.hutalSHiabud)} ${getStatusText(item.hutalSHiabud)}
                        </td>
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">
                            ${getStatusIcon(item.hutalIkul)} ${getStatusText(item.hutalIkul)}
                        </td>
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">
                            ${getStatusIcon(item.yeshHalvaaBamutzar)} ${getStatusText(item.yeshHalvaaBamutzar)}
                        </td>
                        <td style="padding: 12px; border: 1px solid #ddd; text-align: center; white-space: nowrap;">
                            ${getStatusIcon(item.yeshTvia)} ${getStatusText(item.yeshTvia)}
                        </td>
                    </tr>
                `;
            });
            tableHTML += `
                    </tbody>
                </table>
                <div style="margin-top: 20px; padding: 15px; background: rgba(102, 126, 234, 0.1); border-radius: 10px; border-right: 4px solid #667eea;">
                    <p id="statusTableNote" style="color: #555; font-size: 0.9rem; margin: 0; text-align: right; line-height: 1.5;">
                        <strong>הסבר:</strong><br>
                        ✅ <strong>אין</strong> - לא קיים שעבוד/עיקול/הלוואה/תביעה<br>
                        ⚠️ <strong>יש</strong> - קיים שעבוד/עיקול/הלוואה/תביעה<br>
                        ❓ <strong>לא ידוע</strong> - המידע לא זמין
                    </p>
                </div>
            `;
            statusTableDiv.innerHTML = tableHTML;

            // הוספת הטבלה החדשה לקונטיינר הראשי
            const dataDisplayContainer = document.getElementById('dataDisplayContainer');
            dataDisplayContainer.appendChild(statusTableDiv);
        }

        // פונקציה לסגירת התצוגה

        // ========================================
        // Navigate to Home Page Function
        // ========================================
        function navigateToHome() {
            // אם אנחנו כבר בדף הבית - פשוט נגלול למעלה
            if (window.location.pathname.endsWith('index.html') || window.location.pathname === '/') {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                // אנחנו בדף אחר - נעבור לדף הבית
                window.location.href = 'index.html';
            }
        }
    </script>

    <!-- Modal Container -->
    <div id="modals-container"></div>

    <!-- External Modal Scripts -->
    <script src="about-modal.js"></script>
    <script src="consultation-form.js"></script>
    <script src="terms-modal.js"></script>
    <script src="risk-quest-modal.js"></script>
    <script src="terms-consent.js"></script>
    <script>
        // Load Modal HTML files
        fetch('about-modal.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('modals-container').innerHTML += html;
            })
            .catch(err => console.error('Error loading about modal:', err));
        
        fetch('consultation-form.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('modals-container').innerHTML += html;
            })
            .catch(err => console.error('Error loading consultation form:', err));
        
        fetch('risk-quest-modal.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('modals-container').innerHTML += html;
            })
            .catch(err => console.error('Error loading risk quest modal:', err));
        
        fetch('terms-modal.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('modals-container').innerHTML += html;
            })
            .catch(err => console.error('Error loading terms modal:', err));
        
        fetch('terms-consent.html')
            .then(response => response.text())
            .then(html => {
                document.body.insertAdjacentHTML('afterbegin', html);
            })
            .catch(err => console.error('Error loading terms consent:', err));
        
        // Load Footer
        fetch('footer.html')
            .then(response => response.text())
            .then(html => {
                document.body.insertAdjacentHTML('beforeend', html);
            })
            .catch(err => console.error('Error loading footer:', err));
    </script>

    <!-- Accessibility Menu Script -->
    <script src="accessibility.js"></script>

<script>
    // Scroll to Top functionality
    function scrollToTop() {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    }
    
    // Show/Hide scroll to top button on scroll (mobile only)
    function updateScrollButton() {
        const scrollBtn = document.getElementById('scrollToTopBtn');
        if (scrollBtn && window.innerWidth <= 768) {
            if (window.pageYOffset > 300) {
                scrollBtn.classList.add('show');
            } else {
                scrollBtn.classList.remove('show');
            }
        } else if (scrollBtn) {
            scrollBtn.classList.remove('show');
        }
    }
    
    window.addEventListener('scroll', updateScrollButton);
    window.addEventListener('resize', updateScrollButton);
    
    // Initialize on load
    setTimeout(updateScrollButton, 100);
</script>

</body>
</html>


