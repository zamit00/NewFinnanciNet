<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  
    <title>סימולטור הלוואות</title>
    <style>
        :root {
            --primary: #667eea;
            --primary-light: #5a6fd8;
            --primary-dark: #4c5cd1;
            --secondary: #764ba2;
            --secondary-light: #8b5fbf;
            --secondary-dark: #6a4190;
            --accent: #9b59b6;
            --text-dark: #333;
            --text-light: #666;
            --background: white;
            --white: #fff;
            --card-bg: #f8f9fa;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
            --border: rgba(0, 0, 0, 0.1);
        }

        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;700&display=swap');
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Heebo', sans-serif;
        }

        body {
            background-color: var(--background);
            color: var(--text-dark);
            min-height: 100vh;
            width: 100%;
            max-width: 100%;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 16px;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .brand h1 {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .home-icon {
            font-size: 24px !important;
            color: #667eea !important;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .home-icon:hover {
            transform: scale(1.1);
        }

        .subtitle {
            font-size: 14px;
            color: var(--text-light);
            margin-top: 4px;
        }

        .adkani {
            font-size: 12px;
            color: green;
            font-weight: 500;
            margin-top: 2px;
        }

        .main-title {
            color: var(--primary-dark);
            margin-bottom: 10px;
            font-size: 2.5rem;
        }

        h2 {
            color: var(--secondary-dark);
            margin-bottom: 15px;
            font-size: 1.8rem;
        }

        .simulator-wrapper {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }

        .inputs-section {
            flex: 1;
            min-width: 270px;
            background-color: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 25px;
            box-shadow: var(--shadow);
        }

        .results-section {
            flex: 1;
            min-width: 270px;
            background-color: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 25px;
            box-shadow: var(--shadow);
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--text-dark);
        }

        input[type="number"], 
        input[type="text"] {
            width: 100%;
            padding: 14px;
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            background: var(--white);
            color: var(--text-dark);
            font-size: 16px;
            transition: border-color 0.2s, box-shadow 0.2s;
            outline: none;
        }

        input[type="range"] {
            width: 100%;
            margin-top: 8px;
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.25);
        }

        .range-values {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-light);
            margin-top: 5px;
        }

        .result-item {
            margin-bottom: 15px;
            padding: 18px;
            background-color: var(--white);
            border: 1px solid var(--border);
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .result-label {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--primary-dark);
        }

        .result-value {
            font-size: 1.5rem;
            color: var(--secondary-dark);
            font-weight: bold;
        }

        .chart-container {
            width: 100%;
            height:50vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
        }

        .donut-chart {
            position: relative;
            width: 250px;
            height: 250px;
        }

        .chart-legend {
            display: flex;
            justify-content: center;
            margin-top: 15px;
            gap: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }

        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
        }

        .principal-color {
            background-color: #667eea;
        }

        .interest-color {
            background-color: #764ba2;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.1s ease, box-shadow 0.2s;
            box-shadow: 0 8px 18px rgba(102, 126, 234, 0.2);
            margin-top: 20px;
            display: block;
            width: 100%;
            font-size: 16px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        button:active {
            transform: translateY(1px);
        }

        .amortization-container {
            margin-top: 30px;
            background-color: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 25px;
            box-shadow: var(--shadow);
            display: none;
            width: 100%;
            max-width: 100%;
            overflow-x: auto;
        }

        .table-wrapper {
            overflow-x: auto;
            width: 100%;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        th, td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid #ddd;
            white-space: nowrap;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: sticky;
            top: 0;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #f1f1f1;
        }

        #amortization-table td, #amortization-table th, tbody th{
            text-align: center;
        }
       
        @media (max-width: 768px) {
            label {
                text-align: center;
            }
            .results-section {height: auto;}
            .simulator-wrapper {
                align-items: center;
                flex-direction: column;
            }

            h1 {
                font-size: 2rem;
            }

            h2 {
                font-size: 1.5rem;
            }

            .inputs-section, .results-section {
                width: 100%;
            }

            .donut-chart {
                width: 200px;
                height: 200px;
            }

            .amortization-container {
                padding: 15px;
            }

            th, td {
                padding: 8px;
                font-size: 12px;
            }
            #amortization-table td, #amortization-table th, tbody th{
                white-space: normal;
                max-width: 16.6vw;
                font-size: 11px;
                overflow: hidden;
                text-align: center;
            }
        }
        .containerHal {
            max-width: 100%;
            background: var(--card-bg);
            border: 1px solid var(--border);
            padding: 25px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            margin-top: 30px;
        }
	    
	.containerHal h2 {
            color: var(--primary);
            font-weight: 700;
        }
 	.containerHal p {
            text-align: right;
            line-height: 1.6;
        }
       .containerHal ul {
            text-align: right;
            padding-right: 20px;
        }
        .closewindow{color:black;margin-top: 10px;margin-right: 30px;}

        /* Navigation Styles */
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1000;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logoimg{
            width: 200px;
            height: auto;
        }

        .nav-menu {
            list-style: none;
            display: flex;
            gap: 2rem;
            align-items: center;
            margin: 0;
            padding: 0;
        }

        .nav-menu a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s ease;
            position: relative;
            padding: 0.5rem 0;
        }

        .nav-menu a:hover {
            color: #667eea;
        }

        .nav-menu a::after {
            content: '';
            position: absolute;
            bottom: -5px;
            right: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        .nav-menu a:hover::after {
            width: 100%;
        }

        /* Navigation Dropdown */
        .nav-dropdown {
            position: relative;
        }

        .nav-dropdown .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            min-width: 220px;
            z-index: 1001;
        }

        .nav-dropdown .dropdown-content a {
            color: #333;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            transition: background-color 0.3s ease;
            font-size: 14px;
            border-bottom: 1px solid #eee;
        }

        .nav-dropdown .dropdown-content a:hover {
            background-color: #f5f5f5;
            color: #667eea;
        }

        .nav-dropdown .dropdown-content a:last-child {
            border-bottom: none;
        }

        .nav-dropdown .dropdown-content.show {
            display: block;
        }
        
        /* Desktop hover behavior */
        @media (min-width: 769px) {
            .nav-dropdown:hover .dropdown-content {
                display: block;
            }
        }

        .hamburger {
            display: none;
            flex-direction: column;
            cursor: pointer;
            gap: 4px;
        }

        .hamburger span {
            width: 25px;
            height: 3px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: 0.3s;
            border-radius: 3px;
        }

        .hamburger.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }

        .hamburger.active span:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }

        /* Mobile Navigation */
        @media (max-width: 768px) {
            .nav-container {
                padding: 0 1rem;
            }

            .logoimg{
                width: 150px;
                height: auto;
            }

            .nav-menu {
                display: none;
                position: fixed;
                top: 80px;
                right: -100%;
                width: 100%;
                height: calc(100vh - 80px);
                background: white;
                flex-direction: column;
                justify-content: flex-start;
                align-items: center;
                padding-top: 2rem;
                transition: right 0.3s ease;
                box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            }

            .nav-menu.active {
                display: flex;
                right: 0;
            }

            .hamburger {
                display: flex;
            }

            .nav-menu li {
                margin: 1rem 0;
            }

            .nav-menu a {
                font-size: 1.2rem;
            }

            /* Mobile dropdown adjustments */
            .nav-dropdown .dropdown-content {
                position: relative;
                display: none;
                min-width: auto;
                width: 100%;
                box-shadow: none;
                border: none;
                background: white;
                margin-top: 10px;
            }

            /* Mobile dropdown adjustments */
            .nav-dropdown .dropdown-content {
                position: relative;
                display: none;
                min-width: auto;
                width: 100%;
                box-shadow: none;
                border: none;
                background: transparent;
                margin-top: 0;
                top: auto;
                border-radius: 0;
                padding: 0;
            }

            .nav-dropdown .dropdown-content a {
                padding: 8px 16px;
                border-bottom: 1px solid #eee;
                font-size: 1rem;
            }

            .nav-dropdown .dropdown-content.show {
                display: block;
                margin-top: 15px;
            }
        }
    </style>
    
    <!-- External Modal Styles -->
    <link rel="stylesheet" href="about-modal.css">
    <link rel="stylesheet" href="terms-modal.css">
    <link rel="stylesheet" href="mainStyle.css">
    <link rel="stylesheet" href="footer.css">
</head>
<body>
  <div class="nav-container">
    <nav class="nav-menu" id="navMenu">
      <li><a href="index.html"><i class="fa fa-home" style="font-size:2rem"></i></a></li>
      <li class="nav-dropdown">
        <a href="#" onclick="toggleLoanProductsDropdown(event)">מוצרים ותשואות ▼</a>
        <div class="dropdown-content" id="loanProductsDropdown">
          <a href="index.html#products">קרנות השתלמות</a>
          <a href="index.html#products">קופות גמל</a>
          <a href="index.html#products">קופות גמל להשקעה</a>
          <a href="index.html#products">חסכון לילד</a>
          <a href="index.html#products">פוליסות חסכון</a>
          <a href="index.html#products">קרנות פנסיה חדשות</a>
        </div>
      </li>
      <li class="nav-dropdown">
        <a href="#" onclick="toggleLoanCalculatorDropdown(event)">מחשבונים ▼</a>
        <div class="dropdown-content" id="loanCalculatorDropdown">
          <a href="prisatMaanak.html">פריסת מענק פרישה</a>
          <a href="ribitderibit.html">חישוב ערך עתידי</a>
          <a href="loan.html">סימולטור הלוואה</a>
          <a href="hafkada.html">מחשבון הפקדה לסכום מטרה</a>
          <a href="hashDmeyNihul.html">השוואת דמי ניהול</a>
        </div>
      </li>
      <li class="nav-dropdown">
        <a href="#" onclick="toggleLoanToolsDropdown(event)">כלי השוואה ▼</a>
        <div class="dropdown-content" id="loanToolsDropdown">
          <a href="hashMenahalot.html">השוואת חברות מנהלות</a>
          <a href="hasifotMeshulav.html">מחולל חשיפות</a>
          <a href="#">השוואת תיק משולב מסלולים</a>
          
          <a href="#">ציון משקל תשואה לשארפ</a>
        </div>
      </li>
      <li><a href="#" onclick="openAboutModal(); return false;">אודות</a></li>
      <li><a href="index.html#contact">צור קשר</a></li>
      <li class="whatsapp-desktop"><a href="https://wa.me/972545287184?text=שלום, אני מעוניין בייעוץ פנסיוני" target="_blank" title="צור קשר בוואטסאפ"><i class="fab fa-whatsapp" style="font-size:2rem; color:#25D366;"></i></a></li>
    </nav>
    <div class="whatsapp-mobile">
        <a href="https://wa.me/972545287184?text=שלום, אני מעוניין בייעוץ פנסיוני" target="_blank" title="צור קשר בוואטסאפ">
            <i class="fab fa-whatsapp" style="font-size:2rem; color:#25D366;"></i>
        </a>
    </div>
    <div class="logo"> <img class="logoimg" src="logoxnew.png" onclick="window.location.href='index.html'" style="cursor: pointer;"/></div>
    <div class="hamburger" id="hamburger" style="padding: 10px;">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>

    <div class='closewindow' onclick='window.parent.showMachshevonim();'>
    </div>
    <div class="container">
       
        <header>
            <div class="brand">
                <div>
                    <h1 style="font-size: 24px; font-weight: 700; color: #667eea; margin: 0;  
                      width: 100%;text-align: center;">סימולטור הלוואות</h1>
                    <div class="subtitle">חישוב תשלום חודשי והחזר סה"כ לפי ריבית ומשך הלוואה</div>
                </div>
            </div>
        </header>

        <div class="simulator-wrapper">
            <div id="hechzer" style="width:clamp(200px,60vw,200px);height:70px;border:1px solid blue;
                position:absolute;z-index: 10000;
                background-color: azure;text-align: center;margin: 5vh auto;
                display:none"></div>
            <section class="inputs-section">
                <h2 style="text-align: center;">פרטי ההלוואה</h2>
                
                <div class="input-group">
                    <label for="loan-amount">סכום הלוואה</label>
                    <input type="number" id="loan-amount" min="0" step="5000" placeholder="הכנס סכום">
                    <input type="range" id="loan-amount-range" min="0" max="1000000" step="5000">
                    <div class="range-values">
                        <span>0 ₪</span>
                        <span>1,000,000 ₪</span>
                    </div>
                </div>

                <div class="input-group">
                    <label for="loan-term">תקופת החזר (בחודשים)</label>
                    <input type="number" id="loan-term" min="0" max="240" step="1" placeholder="הכנס מספר חודשים">
                    <input type="range" id="loan-term-range" min="0" max="240" step="1">
                    <div class="range-values">
                        <span>0</span>
                        <span>240 חודשים</span>
                    </div>
                </div>

                <div class="input-group">
                    <label for="interest-rate">ריבית שנתית (%)</label>
                    <input type="number" id="interest-rate" min="0" max="15" step="0.1" placeholder="הכנס אחוז ריבית">
                    <input type="range" id="interest-rate-range" min="0" max="15" step="0.1">
                    <div class="range-values">
                        <span>0%</span>
                        <span>15%</span>
                    </div>
                </div>

                <div class="input-group">
                    <label for="payment-delay">תקופת דחיית תשלום ראשון (חודשים)</label>
                    <input type="number" id="payment-delay" min="0" max="24" step="1" placeholder="הכנס מספר חודשים לדחיה">
                    <input type="range" id="payment-delay-range" min="0" max="24" step="1">
                    <div class="range-values">
                        <span>0 חודשים</span>
                        <span>24 חודשים</span>
                    </div>
                </div>
            </section>

            <section class="results-section">
                <h2 style="text-align: center;">תוצאות החישוב</h2>
                
                <div class="result-item">
                    <div class="result-label">החזר חודשי קבוע</div>
                    <div class="result-value" id="monthly-payment">- - -</div>
                </div>

                <div class="result-item">
                    <div class="result-label">סה"כ לתשלום</div>
                    <div class="result-value" id="total-payment">- - -</div>
                </div>

                <div class="result-item">
                    <div class="result-label">סה"כ ריבית</div>
                    <div class="result-value" id="total-interest">- - -</div>
                </div>

                <div class="chart-container" style="display: flex;flex-direction: column ;
                align-items: center;">
                    <div class="donut-chart" style="display: flex;flex-direction: column ;
                align-items: center;">
                        <canvas id="loan-chart" width="250" height="250"></canvas>
                    </div>
                </div>

                <button id="toggle-amortization" style="margin-top: 30px;">הצג לוח סילוקין</button>
                
            </section>
            
        </div>

        <div class="amortization-container" id="amortization-table-container">
            <h2 style='text-align:center'>לוח סילוקין</h2>
            <div class="table-wrapper">
                <table id="amortization-table">
                    <thead>
                        <tr>
                            <th style='max-width:12vw' > מס׳</th>
                            <th>תשלום</th>
                            <th>קרן</th>
                            <th>ריבית</th>
                            <th>יתרת קרן</th>
                        </tr>
                    </thead>
                    <tbody id="amortization-body">
                        <!-- יתמלא בג'אווה סקריפט -->
                    </tbody>
                </table>
            </div>
        </div>
        <div class="containerHal">
            <h2>מהו מחשבון הלוואות?</h2>
            <p>מחשבון הלוואות הוא כלי פיננסי מקוון המסייע לאנשים לחשב את ההחזרים החודשיים של הלוואות שונות בהתבסס <br>על סכום ההלוואה, הריבית ותקופת ההחזר. 
            הוא משמש ככלי עזר להבנת יכולת ההחזר של הלווה לפני קבלת ההחלטה<br>  על נטילת הלוואה.</p>
            <p>תכונות עיקריות של מחשבון הלוואות:</p>
            <ul>
                <li>חישוב החזר חודשי בהתבסס על סכום ההלוואה, הריבית ומשך ההלוואה.</li>
                <li>אפשרות להזין פרמטרים שונים ולראות כיצד הם משפיעים על ההחזרים.</li>
                <li>שימוש קל ונגיש ללא צורך בידע פיננסי מתקדם.</li>
            </ul><h2>כיצד מחושב ההחזר החודשי?</h2>
            <p>ההחזר החודשי מחושב באמצעות נוסחה כלכלית המתבססת על ריבית, סכום הקרן ומשך ההלוואה. הנוסחה הנפוצה ביותר היא:</p>
            <p><strong>M = P[r(1+r)^n] / [(1+r)^n – 1]</strong></p>
            <ul>
            <li><strong>M</strong> – ההחזר החודשי.</li>
            <li><strong>P</strong> – סכום ההלוואה (קרן).</li>
            <li><strong>r</strong> – הריבית החודשית (ריבית שנתית מחולקת ב-12).</li>
            <li><strong>n</strong> – מספר חודשי ההלוואה.</li>
            </ul>
            <p>באמצעות הנוסחה הזו ניתן לראות כיצד שינוי בריבית או במשך ההלוואה משפיע על גובה ההחזר החודשי.</p>
        
            <h2>למי מיועד השימוש במחשבון?</h2>
            <p>מחשבון הלוואות מתאים לכל מי שמעוניין לקחת הלוואה ורוצה להבין את ההשלכות הפיננסיות של ההחלטה. הוא שימושי עבור:</p>
            <ul>
            <li><strong>אנשים פרטיים:</strong> המעוניינים לקחת משכנתא, הלוואה לרכב או הלוואה אישית.</li>
            <li><strong>בעלי עסקים:</strong> שרוצים לבדוק את תנאי החזר ההלוואה לפני נטילת מימון עסקי.</li>
            <li><strong>סטודנטים:</strong> השוקלים לקחת הלוואת לימודים ורוצים להבין את ההתחייבויות הכספיות שלהם.</li>
            <li><strong>משקיעים:</strong> הרוצים לבדוק כיצד הלוואות יכולות להשפיע על ההחזר הכלכלי שלהם.</li>
            </ul>
            <p>באמצעות המחשבון ניתן לבצע תכנון פיננסי נכון ולמנוע מצבים של התחייבות גבוהה מדי להחזר חודשי.</p>
      </div>
    </div>

    <script>
        // אתחול הדף
        document.addEventListener('DOMContentLoaded', function() {
            // חיבור האירועים לכל שדות הקלט
            initInputSync('loan-amount', 'loan-amount-range');
            initInputSync('loan-term', 'loan-term-range');
            initInputSync('interest-rate', 'interest-rate-range');
            initInputSync('payment-delay', 'payment-delay-range');

            // אירועים לחישוב מחדש של המשכנתא
            const inputElements = document.querySelectorAll('input');
            inputElements.forEach(input => {
                input.addEventListener('input', calculateLoan);
            });

            // אירוע לכפתור לוח הסילוקין
            document.getElementById('toggle-amortization').addEventListener('click', toggleAmortizationTable);

            // אתחול הגרף
            initChart();
            
            // חישוב התוצאות בעת טעינת הדף (אם יש נתונים מוגדרים מראש)
            calculateLoan();
        });

        // סינכרון בין שדות טקסט למחוונים
        function initInputSync(textId, rangeId) {
            const textInput = document.getElementById(textId);
            const rangeInput = document.getElementById(rangeId);

            // סינכרון משדה טקסט למחוון
            textInput.addEventListener('input', function() {
                if (parseFloat(this.value) > rangeInput.max) {
                    this.value = rangeInput.max;
                }
                if (parseFloat(this.value) < rangeInput.min) {
                    this.value = "";
                }
                rangeInput.value = this.value;
            });

            // סינכרון ממחוון לשדה טקסט
            rangeInput.addEventListener('input', function() {
                textInput.value = this.value;
            });
        }

        // חישוב המשכנתא
        function calculateLoan() {
            // קבלת הערכים מהמשתמש
            const loanAmount = parseFloat(document.getElementById('loan-amount').value) || 0;
            const loanTerm = parseFloat(document.getElementById('loan-term').value) || 0;
            const interestRate = parseFloat(document.getElementById('interest-rate').value) || 0;
            const paymentDelay = parseInt(document.getElementById('payment-delay').value) || 0;

            // חישוב רק אם יש את כל הנתונים הנדרשים
            if (loanAmount > 0 && loanTerm > 0 && interestRate >= 0) {
                const monthlyInterest = interestRate / 100 / 12;
                const totalPayments = loanTerm * 1;
                
                // חישוב של ההחזר החודשי
                let monthlyPayment;
                
                // אם יש דחיית תשלומים, הריבית נצברת בתקופה זו
                let adjustedLoanAmount = loanAmount;
                
                if (paymentDelay > 0 && interestRate > 0) {
                    // חישוב ריבית נצברת בתקופת הדחיה
                    for (let i = 0; i < paymentDelay; i++) {
                        adjustedLoanAmount += adjustedLoanAmount * monthlyInterest;
                    }
                }
                
                if (interestRate === 0) {
                    // אם אין ריבית, ההחזר החודשי הוא פשוט חלוקה של סכום ההלוואה בתקופת ההחזר
                    monthlyPayment = adjustedLoanAmount / totalPayments;
                } else {
                    // נוסחת שפיצר לחישוב החזר חודשי
                    monthlyPayment = (adjustedLoanAmount * monthlyInterest * Math.pow(1 + monthlyInterest, totalPayments)) / 
                                     (Math.pow(1 + monthlyInterest, totalPayments) - 1);
                }
                
                const totalPayment = monthlyPayment * totalPayments;
                const totalInterest = totalPayment - loanAmount;
                
                // עדכון התוצאות בממשק
                document.getElementById('monthly-payment').textContent = formatCurrency(monthlyPayment);
                document.getElementById('total-payment').textContent = formatCurrency(totalPayment);
                document.getElementById('total-interest').textContent = formatCurrency(totalInterest);
               
                if(window.innerWidth<400){
                    document.getElementById("hechzer").style.display="block";
                    document.getElementById("hechzer").innerText=`החזר חודשי: ${monthlyPayment.toLocaleString('he-IL', { style: 'currency', currency: 'ILS' })}`;
                    document.getElementById("hechzer").style.fontSize="20px";
                    setTimeout(function() {
                        document.getElementById("hechzer").style.display="none";
                    }, 1500);
                }

                // עדכון הגרף
                updateChart(loanAmount, totalInterest);
                
                // יצירת לוח סילוקין
                createAmortizationSchedule(adjustedLoanAmount, monthlyPayment, monthlyInterest, totalPayments);
            } else {
                // אם אין נתונים מספיקים, מאפס את התצוגה
                document.getElementById('monthly-payment').textContent = "- - -";
                document.getElementById('total-payment').textContent = "- - -";
                document.getElementById('total-interest').textContent = "- - -";
                
                // מאפס את הגרף
                updateChart(0, 0);
                
                // מאפס את לוח הסילוקין
                document.getElementById('amortization-body').innerHTML = '';
            }
        }

        // אתחול הגרף
        function initChart() {
            const canvas = document.getElementById('loan-chart');
            const ctx = canvas.getContext('2d');
            
            // ציור רקע לגרף
            ctx.fillStyle = "#f5f5f5";
            ctx.beginPath();
            ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2, 0, 2 * Math.PI);
            ctx.fill();
        }

        // עדכון הגרף
        function updateChart(principal, interest) {
            const canvas = document.getElementById('loan-chart');
            const ctx = canvas.getContext('2d');
            
            // נקה את הקנבס
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ציור רקע
            ctx.fillStyle = "#f5f5f5";
            ctx.beginPath();
            ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2, 0, 2 * Math.PI);
            ctx.fill();
            
            // כסף שווה לקרן + ריבית
            const total = principal + interest;
            
            if (total > 0) {
                // מידות הגרף
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const radius = canvas.width * 0.4; // 80% מרוחב הקנבס
                const innerRadius = canvas.width * 0.2; // 40% מרוחב הקנבס לחור הפנימי
                
                // צייר את החלק של הקרן
                const principalRatio = principal / total;
                const principalEndAngle = principalRatio * 2 * Math.PI;
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, -Math.PI / 2, -Math.PI / 2 + principalEndAngle);
                
                // חור באמצע
                ctx.arc(centerX, centerY, innerRadius, -Math.PI / 2 + principalEndAngle, -Math.PI / 2, true);
                ctx.closePath();
                
                ctx.fillStyle = '#667eea'; // כחול לקרן
                ctx.fill();
                
                // צייר את החלק של הריבית
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, -Math.PI / 2 + principalEndAngle, -Math.PI / 2 + 2 * Math.PI);
                
                // חור באמצע
                ctx.arc(centerX, centerY, innerRadius, -Math.PI / 2 + 2 * Math.PI, -Math.PI / 2 + principalEndAngle, true);
                ctx.closePath();
                
                ctx.fillStyle = '#764ba2'; // סגול לריבית
                ctx.fill();
                
                // הוסף אחוזים למרכז הגרף
                ctx.fillStyle = '#333';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                const principalPercent = Math.round(principalRatio * 100);
                const interestPercent = 100 - principalPercent;
                ctx.fillText(`קרן: ${principalPercent}%`, centerX, centerY - 10);
                ctx.fillText(`ריבית: ${interestPercent}%`, centerX, centerY + 10);
            }
        }

        // יצירת לוח סילוקין
        function createAmortizationSchedule(loanAmount, monthlyPayment, monthlyInterest, totalPayments) {
            const tableBody = document.getElementById('amortization-body');
            tableBody.innerHTML = '';
            
            let balance = loanAmount;
            const today = new Date();
            
            for (let i = 1; i <= totalPayments; i++) {
                // חישוב תאריך התשלום
                const paymentDate = new Date(today);
                paymentDate.setMonth(today.getMonth() + i);
                
                // חישוב הריבית לתשלום הנוכחי
                const interestPayment = balance * monthlyInterest;
                
                // חישוב הקרן לתשלום הנוכחי
                const principalPayment = monthlyPayment - interestPayment;
                
                // עדכון היתרה
                balance -= principalPayment;
                
                // יצירת שורה חדשה בטבלה
                const row = document.createElement('tr');
                
                // תאריך התשלום בפורמט עברי
                const dateString = paymentDate.toLocaleDateString('he-IL', {
                    year: 'numeric',
                    month: 'numeric',
                    day: 'numeric'
                });
                
                // מילוי השורה בנתונים
                row.innerHTML = `
                    <td style='max-width:12vw'>${i}</td>
                    <td>${formatCurrency(monthlyPayment)}</td>
                    <td>${formatCurrency(principalPayment)}</td>
                    <td>${formatCurrency(interestPayment)}</td>
                    <td>${formatCurrency(Math.max(0, balance))}</td>
                `;
                
                tableBody.appendChild(row);
            }
        }

        // פורמט של מספר למטבע בפורמט עברי
        function formatCurrency(number) {
            return new Intl.NumberFormat('he-IL', {
                style: 'currency',
                currency: 'ILS',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(number);
        }

        // הצגה/הסתרה של לוח הסילוקין
        function toggleAmortizationTable() {
            const table = document.getElementById('amortization-table-container');
            const button = document.getElementById('toggle-amortization');
            
            if (table.style.display === 'none' || table.style.display === '') {
                table.style.display = 'block';
                button.textContent = 'הסתר לוח סילוקין';
                // גלילה אל הטבלה
                table.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else {
                table.style.display = 'none';
                button.textContent = 'הצג לוח סילוקין';
            }
        }

        // Hamburger menu functionality
        document.addEventListener('DOMContentLoaded', function() {
            const hamburger = document.getElementById('hamburger');
            const navMenu = document.getElementById('navMenu');
            
            if (hamburger && navMenu) {
                hamburger.addEventListener('click', function() {
                    this.classList.toggle('active');
                    navMenu.classList.toggle('active');
                });

                // Close menu when clicking on a link
                document.querySelectorAll('.nav-menu a').forEach(link => {
                    link.addEventListener('click', function(e) {
                        // Don't close if clicking on calculator dropdown toggle
                        if (this.getAttribute('onclick') && this.getAttribute('onclick').includes('toggleLoanCalculatorDropdown')) {
                            return;
                        }
                        
                        hamburger.classList.remove('active');
                        navMenu.classList.remove('active');
                    });
                });

                // Close menu when clicking outside
                document.addEventListener('click', function(e) {
                    if (!navMenu.contains(e.target) && !hamburger.contains(e.target)) {
                        hamburger.classList.remove('active');
                        navMenu.classList.remove('active');
                    }
                });
            }
        });

        // Products dropdown functionality
        function toggleLoanProductsDropdown(event) {
            event.preventDefault();
            event.stopPropagation();
            if (window.innerWidth > 768) {return;}
            const dropdown = document.getElementById('loanProductsDropdown');
            const link = event.target;
            
            document.querySelectorAll('.dropdown-content.show').forEach(d => {
                if (d !== dropdown) {
                    d.classList.remove('show');
                    // Reset text for other dropdowns
                    const parentLi = d.parentElement;
                    if (parentLi) {
                        const dropdownLink = parentLi.querySelector('a');
                        if (dropdownLink && dropdownLink.textContent.includes('מחשבונים')) {
                            dropdownLink.innerHTML = 'מחשבונים ▼';
                        } else if (dropdownLink && dropdownLink.textContent.includes('כלי השוואה')) {
                            dropdownLink.innerHTML = 'כלי השוואה ▼';
                        }
                    }
                }
            });
            
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
                link.innerHTML = 'מוצרים ותשואות ▼';
            } else {
                dropdown.classList.add('show');
                link.innerHTML = 'מוצרים ותשואות ▲';
            }
        }

        // Calculator dropdown functionality
        // פונקציה לפתיחה/סגירה של הרשימה הנפתחת בתפריט הניווט - מחשבונים
        function toggleLoanCalculatorDropdown(event) {
            event.preventDefault();
            event.stopPropagation();
            if (window.innerWidth > 768) {return;}
            const dropdown = document.getElementById('loanCalculatorDropdown');
            const link = event.target;
            
            // Close other dropdowns first
            document.querySelectorAll('.dropdown-content.show').forEach(d => {
                if (d !== dropdown) {
                    d.classList.remove('show');
                }
            });
            
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
                link.innerHTML = 'מחשבונים ▼';
            } else {
                dropdown.classList.add('show');
                link.innerHTML = 'מחשבונים ▲';
            }
        }
        
        // פונקציה לפתיחה/סגירה של הרשימה הנפתחת בתפריט הניווט - כלי השוואה
        function toggleLoanToolsDropdown(event) {
            event.preventDefault();
            event.stopPropagation();
            if (window.innerWidth > 768) {return;}
            const dropdown = document.getElementById('loanToolsDropdown');
            const link = event.target;
            
            // Close other dropdowns first
            document.querySelectorAll('.dropdown-content.show').forEach(d => {
                if (d !== dropdown) {
                    d.classList.remove('show');
                }
            });
            
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
                link.innerHTML = 'כלי השוואה ▼';
            } else {
                dropdown.classList.add('show');
                link.innerHTML = 'כלי השוואה ▲';
            }
        }

        // Close calculator dropdown when clicking outside
        document.addEventListener('click', function(e) {
            const dropdown = document.getElementById('loanCalculatorDropdown');
            const dropdownLink = dropdown?.closest('.nav-dropdown')?.querySelector('a');
            
            if (dropdownLink && dropdown && !dropdownLink.contains(e.target) && !dropdown.contains(e.target)) {
                dropdown.classList.remove('show');
                dropdownLink.innerHTML = 'מחשבונים ▼';
            }
        });

        // Ensure dropdown links work properly
        document.querySelectorAll('#loanCalculatorDropdown a').forEach(link => {
            link.addEventListener('click', function(e) {
                // Don't prevent default - let the link work normally
                e.stopPropagation();
                
                // Close dropdown after a short delay to allow navigation
                setTimeout(() => {
                    const dropdown = document.getElementById('loanCalculatorDropdown');
                    const dropdownLink = dropdown?.closest('.nav-dropdown')?.querySelector('a');
                    
                    if (dropdown) {
                        dropdown.classList.remove('show');
                    }
                    if (dropdownLink) {
                        dropdownLink.innerHTML = 'מחשבונים ▼';
                    }
                    
                    // Close mobile menu after navigation
                    if (window.innerWidth <= 768) {
                        const hamburger = document.getElementById('hamburger');
                        const navMenu = document.getElementById('navMenu');
                        if (hamburger && navMenu) {
                            hamburger.classList.remove('active');
                            navMenu.classList.remove('active');
                        }
                    }
                }, 100);
            });
        });
    </script>

    <!-- Modal Container -->
    <div id="modals-container"></div>

    <!-- External Modal Scripts -->
    <script src="about-modal.js"></script>
    <script src="terms-modal.js"></script>
    <script src="accessibility.js"></script>
    <script>
        // Load Modal HTML files
        fetch('about-modal.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('modals-container').innerHTML += html;
            })
            .catch(err => console.error('Error loading about modal:', err));
        
        fetch('terms-modal.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('modals-container').innerHTML += html;
            })
            .catch(err => console.error('Error loading terms modal:', err));
        
        // Load Footer
        fetch('footer.html')
            .then(response => response.text())
            .then(html => {
                document.body.insertAdjacentHTML('beforeend', html);
            })
            .catch(err => console.error('Error loading footer:', err));
    </script>

</body>
</html>
